import { Preview } from '@storybook/addon-docs/dist/blocks';
import {
  PopoverPositionedByAnchorStory,
  PopoverPositionedByCoordsStory,
} from './Popover.stories.tsx';

# Popover

Поповер используется для позиционирования элементов, привязанных к координате или якорю.
Это логический компонент, у него нет стилей, поэтому он не является до конца самостоятельным.
Может быть полезен при создании [тултипов](?path=/docs/components-tooltip--tooltip-positioned-by-anchor-story),
выпадающих списков, контекстных меню и других похожих элементов.

Поповер отрисовывается внутри `body`, чтобы на него не влияли `overflow`-свойства других элементов.

- [Содержимое](#содержимое)
- [Способы позиционирования](#способы-позиционирования)
  - [По якорю](#по-элементу-якорю)
  - [По координатам](#по-координатам)
- [Направление разворачивания](#направление-разворачивания)
- [Отступы](#отступы)
- [Список свойств](#свойства)

## Содержимое

При формировании содержимого поповера в `children` можно передать как обычные элементы React (`React.ReactNode`), так и функцию-RenderProp, которая на вход получает направление разворота (`(direction: Direction) => React.ReactNode`).

Это может быть полезно в тех случаях, когда внешний вид содержимого зависит от направления разворота
(например, от этого зависит, куда смотрит стрелочка у тултипа).

## Способы позиционирования

### По элементу-якорю

Поповер прикрепляется к HTML-элементу (например, кнопке). Ссылка на этот элемент передается в свойстве `anchorRef`.

<Preview>
  <PopoverPositionedByAnchorStory />
</Preview>

```ts
<Button label="Нажми меня" type="button" ref={buttonRef} />
<Popover anchorRef={buttonRef}>
  Контент поповера
</Popover>
```

### По координатам

Поповер прикрепляется к точке на экране. Координаты точки передаются в свойстве `position`
и указываются относительно окна браузера (вьюпорта).

<Preview>
  <PopoverPositionedByCoordsStory />
</Preview>

```ts
<Popover position={{ x: 100, y: 200 }}>Контент поповера</Popover>
```

В этом случае вам нужно самостоятельно отслеживать ситуации, в которых следует
пересчитывать позицию тултипа. Это можно сделать с помощью хука `usePopoverReposition`,
который следит за прокруткой элементов и изменением размеров окна.

## Направление разворачивания

Как происходит разворачивание поповера:

1. Если поповер может развернуться в положение, указанное в свойстве `direction`, то разворачивается в него.
2. Если на экране недостаточно места, перебираются все направления, указанные в `possibleDirections`,
   и выбирается положение, при котором поповер поместится на экране. Направления выбираются по очереди.
3. Если ни в одном положении поповер не помещается, то он развернентся в направлении указаном в `spareDirection`,
   Если не указан то в направлении `downStartLeft`.

## Отступы

Вы можете указать отступ от элемента-якоря (при позиционировании по якорю)
или от курсора (при позиционировании по координатам) с помощью свойства `offset`.

Чтобы поправить отображение стрелочки в тултипе, используйте `arrowOffset`.

## Свойства

| Свойство                                             | Тип или варианты значения                                            | По умолчанию            | Описание                                                                                                    |
| ---------------------------------------------------- | -------------------------------------------------------------------- | ----------------------- | ----------------------------------------------------------------------------------------------------------- |
| [`anchorRef?`](#по-элементу-якорю)                   | `React.RefObject<HTMLElement>`                                       | —                       | Элемент, относительно которого будет позиционироваться поповер (обязателен, если не указано `position`)     |
| [`position?`](#по-координатам)                       | `{ x: number; y: number }` &#124; `undefined`                        | —                       | Координаты точки, к которой прикрепляется поповер (обязательны, если не заполнено `anchorRef`)              |
| [`children`](#содержимое)                            | `React.ReactNode` &#124; `(direction: Direction) => React.ReactNode` | —                       | Контент поповера                                                                                            |
| [`direction?`](#направление-разворачивания)          | [`Direction`](#direction)                                            | `'upCenter'`            | Основное направление для разворачивания поповера                                                            |
| [`possibleDirections?`](#направление-разворачивания) | [`Direction[]`](#direction)                                          | Все возможные Direction | Дополнительные направления, в которые может разворачиваться поповер                                         |
| [`spareDirection?`](#направление-разворачивания)     | [`Direction`](#direction)                                            | `'downStartLeft'`       | Дополнительное направление, в которое развернется поповер если не найдется ни одного возможного направления |
| `equalAnchorWidth`                                   | `boolean`                                                            | -                       | Ширина поповера равна ширине элемента указаного в `anchorRef`                                               |
| [`offset?`](#отступы)                                | `number`                                                             | `0`                     | Отступ от якоря или позиции                                                                                 |
| [`arrowOffset?`](#отступы)                           | `number`                                                             | —                       | Сдвиг в нецентральных позициях (используется для центровки стрелочки у тултипа)                             |
| `isInteractive?`                                     | `boolean`                                                            | `true`                  | Можно ли взаимодействовать с содержимым поповера                                                            |
| `onClickOutside?`                                    | `(event: MouseEvent) => void`                                        | —                       | Действие по клику за пределами поповера и его якоря (если есть)                                             |

### Direction

Возможные значения:

`'upLeft'`, `'upCenter'`, `'upRight'`,
`'downLeft'`, `'downCenter'`, `'downRight'`,
`'leftUp'`, `'leftCenter'`, `'leftDown'`,
`'rightUp'`, `'rightCenter'`, `'rightDown'`

## Примеры

### Позиционирование по якорю

```ts
<Button label="Открыть поповер" type="button" ref={buttonRef} />
<Popover anchorRef={buttonRef}>
  Контент поповера
</Popover>
```

### Позиционирование по координатам

```ts
<Popover position={{ x: 100, y: 200 }}>Контент поповера</Popover>
```
