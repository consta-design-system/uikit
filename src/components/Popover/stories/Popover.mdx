import { Preview } from '@storybook/addon-docs/dist/blocks';
import { PopoverPositionedByAnchorStory, PopoverPositionedByCoordsStory } from './Popover.stories.tsx'

# Popover

Поповер - компонент для позиционирования на экране элементов, привязанных к координате или якорю. Например, для тултипов и дропдаунов.

Поповер рендерится в портале внутри `body`, чтобы на него не влияли `overflow`-свойства элементов.

## Способы позиционирования

1. По якорю — поповер крепится к HTML-элементу (например, кнопке). Рефа элемента-якоря передаётся в пропе `anchorRef`.
<Preview>
  <PopoverPositionedByAnchorStory />
</Preview>
2. По координате — поповер крепится к точке на экране. Координаты точки должны быть относительно вьюпорта (можно получить с помощью метода getBoundingClientRect). Точка передаётся в пропе `position`.
<Preview>
  <PopoverPositionedByCoordsStory />
</Preview>

В случае позиционирования поповера по координате, вам нужно самостоятельно отслеживать ситуации, в которых следует пересчитать позицию тултипа. Для этого следует использовать специальный хук `usePopoverReposition`, который следит за скроллом элементов и изменением размера окна.

## Механизм выбора направления разворачивания

Определение направления для разворота поповера происходит в следующем порядке:
1. Если поповер может развернуться в переданное желаемое положение (свойство `direction`), то он разворачивается в него.
2. Если на экране недостаточно места, чтобы развернуться в желаемое положение, то пытаемся найти любое другое направление из списка разрешённых (свойство `possibleDirections`), при котором поповер поместится на экране.
3. Если по предыдущим шагам не удалось найти подходящее направление, то разворачиваем в желаемое (свойство `direction`) несмотря на то, что поповер на экране не поместится.

## Список свойств

Тип Direction:
`'upLeft'`, `'upCenter'`, `'upRight'`,
`'downLeft'`, `'downCenter'`, `'downRight'`,
`'leftUp'`, `'leftCenter'`, `'leftDown'`,
`'rightUp'`, `'rightCenter'`, `'rightDown'`

| Свойство            | Тип или варианты значения                                             | По умолчанию              | Описание  |
| ------------------- | --------------------------------------------------------------------- | ------------------------- | --------- |
| anchorRef           | `React.RefObject<HTMLElement>`                                        | -                         | Элемент, относительно которого будет позиционироваться поповер (обязателен, если не указан `position`) |
| position            | `{ x: number; y: number }` &#124; `undefined`                         | -                         | Координата на экране, к которой будет крепиться поповер (обязателен, если не указан `anchorRef`) |
| children            | `React.ReactNode` &#124; `(direction: Direction) => React.ReactNode`  | -                         | Контент поповера |
| direction?          | `Direction`                                                           | `'upCenter'`              | Желаемое положение |
| possibleDirections? | `Direction[]`                                                         | все возможные Direction   | Направления, в которые поповеру разрешено разворачиваться |
| offset?             | `number`                                                              | `0`                       | Отступ от якоря или позиции |
| arrowOffset?        | `number`                                                              | -                         | Сдвиг в нецентральных позициях (используется для центровки стрелочки у тултипа) |
| isInteractive?      | `boolean`                                                             | `true`                    | Можно ли взаимодействовать с содержимым поповера |
| onClickOutside?     | `(event: MouseEvent) => void`                                         | -                         | Эвент клика снаружи поповера и его якоря (если есть) |


## Пример использования

### Позиционирование по координате
```ts
<Popover position={{ x: 100, y: 200 }}>
  Контент поповера
</Popover>
```

### Позиционирование по якорю
```ts
<Button label="Открыть поповер" type="button" ref={buttonRef} />
<Popover anchorRef={buttonRef}>
  Контент поповера
</Popover>
```
