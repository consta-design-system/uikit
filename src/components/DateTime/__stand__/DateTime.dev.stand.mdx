import { MdxMenu, MdxInformer, MdxTabs } from '@consta/stand';

import {
  DateTimeExampleViewClassic,
  DateTimeExampleViewBook,
  DateTimeExampleViewSlider,
} from './examples/DateTimeExampleView/DateTimeExampleView';

import { DateTimeExampleCurrentVisibleDate } from './examples/DateTimeExampleCurrentVisibleDate/DateTimeExampleCurrentVisibleDate';

import {
  DateTimeExampleTypeYear,
  DateTimeExampleTypeMonth,
  DateTimeExampleTypeDate,
  DateTimeExampleTypeDateTime,
  DateTimeExampleTypeTime,
} from './examples/DateTimeExampleType/DateTimeExampleType';

import { DateTimeExampleDateMin } from './examples/DateTimeExampleDateMin/DateTimeExampleDateMin';

import { DateTimeExampleMultiplicity } from './examples/DateTimeExampleMultiplicity/DateTimeExampleMultiplicity';

import { DateTimeExamplePeriod } from './examples/DateTimeExamplePeriod/DateTimeExamplePeriod';

import { DateTimeExampleLocale } from './examples/DateTimeExampleLocale/DateTimeExampleLocale';

import { DateTimeExampleEvents } from './examples/DateTimeExampleEvents/DateTimeExampleEvents';

import { DateTimeExampleDisableDates } from './examples/DateTimeExampleDisableDates/DateTimeExampleDisableDates';

import { DateTimeExampleTimeOptions } from './examples/DateTimeExampleTimeOptions/DateTimeExampleTimeOptions';

<MdxMenu>

- [Обзор](#обзор)
- [Импорт](#импорт)
- [Свойства](#свойства)
- [Содержимое](#содержимое)
  - [Тип календаря](#тип-календаря)
  - [Выбор даты](#выбор-даты)
  - [Ограничение выбора](#ограничение-выбора)
  - [Какой месяц показывать](#какой-месяц-показывать)
  - [События на календаре](#события-на-календаре)
- [Внешний вид](#внешний-вид)
- [Поведение](#поведение)
  - [Выбор времени](#выбор-времени)
  - [Локализация](#локализация)
- [Пример использования](#пример-использования)

</MdxMenu>

## Обзор

Компонент `DateTime` предназначен для выбора даты, времени или их комбинации. Поддерживает выбор года, месяца, даты, времени или диапазона дат. Компонент можно настроить под различные сценарии, включая локализацию, ограничение выбора дат, настройку интервалов времени и отображение событий на календаре.

## Импорт

```tsx
import { DateTime } from '@consta/uikit/DateTime';
```

## Свойства

| Свойство                                         | Тип или варианты значения                              | По умолчанию | Описание                                                                   |
| ------------------------------------------------ | ------------------------------------------------------ | ------------ | -------------------------------------------------------------------------- |
| [`type?`](#тип-календаря)                        | `'date'`, `'month'`, `'year'`, `'time'`, `'date-time'` | `'date'`     | Тип календаря                                                              |
| [`value?`](#выбор-даты)                          | `DateTimePropValue`                                    | -            | Выбранная дата или диапазон дат                                            |
| [`disableDates?`](#ограничение-выбора)           | `DateTimePropDisableDates`                             | -            | Интервал или время, недоступное для выбора                                 |
| [`minDate?`](#ограничение-выбора)                | `Date`                                                 | -            | Ограничение выбора дат по минимальной дате                                 |
| [`maxDate?`](#ограничение-выбора)                | `Date`                                                 | -            | Ограничение выбора дат по максимальной дате                                |
| [`currentVisibleDate?`](#какой-месяц-показывать) | `Date`                                                 | `new Date()` | Дата, которая входит в страницу календаря, которую нужно показать          |
| [`events?`](#события-на-календаре)               | `Date[]`                                               | -            | События, отображаемые на календаре                                         |
| [`view?`](#внешний-вид)                          | `'classic'`, `'book'`, `'slider'`                      | `'classic'`  | Вид календаря                                                              |
| [`timeOptions?`](#выбор-времени)                 | `TimeOptions`                                          | -            | Настройка шагов, диапазонов или массива значений для часов, минут и секунд |
| [`multiplicityHours?`](#выбор-времени)           | `number`                                               | 1            | Интервал для вывода часов (1 — показать все часы, 0 — убрать часы)         |
| [`multiplicityMinutes?`](#выбор-времени)         | `number`                                               | 1            | Интервал для вывода минут (1 — показать все минуты, 0 — убрать минуты)     |
| [`multiplicitySeconds?`](#выбор-времени)         | `number`                                               | 1            | Интервал для вывода секунд (1 — показать все секунды, 0 — убрать секунды)  |
| [`locale?`](#локализация)                        | `DateTimePropLocale`                                   | `ruLocale`   | Локализация календаря                                                      |
| [`onChange?`](#выбор-даты)                       | `DateTimePropOnChange`                                 | -            | Обработчик событий выбора даты                                             |
| [`onChangeRange?`](#выбор-даты)                  | `DateTimePropOnChangeRange`                            | -            | Обработчик событий выбора диапазона дат                                    |
| `className?`                                     | `string`                                               | -            | Дополнительные CSS-классы                                                  |
| `ref?`                                           | `React.Ref<HTMLDivElement>`                            | -            | Ссылка на корневой DOM-элемент компонента                                  |

```tsx
import { Locale } from 'date-fns';
import ruLocale from 'date-fns/locale/ru';

type DateTimePropValue = Date | [Date?, Date?];

type CapableRangeType = 'date' | 'month' | 'year';

type DateTimePropValue<TYPE> = TYPE extends CapableRangeType
  ? Date | DateRange
  : Date;

type DateTimePropOnChange = (
  value: Date,
  props: {
    e: React.MouseEvent<HTMLButtonElement>;
  },
) => void;

type DateTimePropOnChangeRange<TYPE> = TYPE extends CapableRangeType
  ? (
      value: DateRange,
      props: {
        e: React.MouseEvent<HTMLButtonElement>;
      },
    ) => void
  : never;

type LocaleWords = {
  words?: {
    hours?: string;
    minutes?: string;
    seconds?: string;
  };
};

export type DateTimePropLocale = Locale & LocaleWords;
export type DateTimePropDisableDates = Array<Date | [Date, Date]>;

type TimeUnitOptions =
  | {
      step?: number;
      start?: number;
      stop?: number;
    }
  | number[];

type TimeOptions = {
  hours?: TimeUnitOptions;
  minutes?: TimeUnitOptions;
  seconds?: TimeUnitOptions;
};
```

## Содержимое

### Тип календаря

Свойство `type` определяет содержимое календаря. Возможные значения:

- `'year'` — выбор года:

<DateTimeExampleTypeYear />

- `'month'` — выбор месяца:

<DateTimeExampleTypeMonth />

- `'date'` — выбор даты:

<DateTimeExampleTypeDate />

- `'date-time'` — выбор даты и времени:

<DateTimeExampleTypeDateTime />

- `'time'` — выбор времени:

<DateTimeExampleTypeTime />

### Выбор даты

Свойство `value` задаёт выбранную дату или диапазон дат (для типов `'date'`, `'month'`, `'year'`). Для обработки выбора даты используйте `onChange`, для диапазона — `onChangeRange`.

<MdxInformer status="normal">

Свойство `value` определено в `DateTimePropValue`. События выбора даты определены в `DateTimePropOnChange` и `DateTimePropOnChangeRange`.

</MdxInformer>

#### Пример с выбором периода

<MdxTabs>

<DateTimeExamplePeriod />

```tsx
const [rangeValue, setRangeValue] = useState<[Date?, Date?]>([]);
return (
  <DateTime
    value={rangeValue}
    onChangeRange={({ value }) => setRangeValue(value)}
    view="slider"
  />
);
```

</MdxTabs>

### Ограничение выбора

Ограничьте диапазон доступных дат с помощью свойств `minDate` (минимальная дата) и `maxDate` (максимальная дата). Для отключения конкретных дат или интервалов используйте `disableDates`.

#### Диапазон дат

<MdxTabs>

<DateTimeExampleDateMin />

```tsx
import { startOfWeek } from 'date-fns';
import ruLocale from 'date-fns/locale/ru';

const minDate = startOfWeek(new Date(), { locale: ruLocale });
const maxDate = new Date();
const [value, setValue] = useState<Date | undefined>();

return (
  <DateTime
    type="date-time"
    minDate={minDate}
    maxDate={maxDate}
    value={value}
    onChange={setValue}
  />
);
```

</MdxTabs>

#### Отключённые интервалы

<MdxTabs>

<DateTimeExampleDisableDates />

```tsx
const getDisableDates = () => {
  const date = new Date();
  const year = date.getFullYear();
  const month = date.getMonth();
  const day = date.getDate();
  return [
    [
      new Date(year, month, day, 12, 34, 20),
      new Date(year, month, day, 16, 10, 41),
    ],
  ];
};

const [value, setValue] = useState<Date | undefined>();

return (
  <DateTime
    type="date-time"
    value={value}
    disableDates={getDisableDates()}
    onChange={setValue}
  />
);
```

</MdxTabs>

### Какой месяц показывать

Свойство `currentVisibleDate` определяет, какой месяц отобразится при открытии календаря.

<MdxTabs>

<DateTimeExampleCurrentVisibleDate />

```tsx
<DateTime currentVisibleDate={new Date(2000, 1, 1)} />
```

</MdxTabs>

### События на календаре

Свойство `events` позволяет отображать запланированные события на календаре, передавая массив дат.

<MdxTabs>

<DateTimeExampleEvents />

```tsx
import { addDays, startOfWeek } from 'date-fns';

const events = [
  startOfWeek(new Date(), { locale: ruLocale }),
  new Date(),
  addDays(new Date(), 2),
];

<DateTime events={events} />;
```

</MdxTabs>

## Внешний вид

Свойство `view` определяет внешний вид календаря. Варианты:

- `'classic'` — одна страница календаря (по умолчанию):

<DateTimeExampleViewClassic />

- `'book'` — две страницы календаря:

<DateTimeExampleViewBook />

- `'slider'` — две страницы со слайдером:

<DateTimeExampleViewSlider />

## Поведение

### Выбор времени

<MdxInformer status="alert">
  Пропсы <code>multiplicityHours</code>, <code>multiplicityMinutes</code> и{' '}
  <code>multiplicitySeconds</code> устарели и в будущем будут удалены.
  Используйте <code>timeOptions</code>.
</MdxInformer>

Для режимов `type="time"` или `type="date-time"` можно настроить отображение часов, минут и секунд с помощью свойств:

- `timeOptions` - позволяет гибко задавать шаги, диапазоны или конкретные значения для часов, минут и секунд.
- `multiplicityHours` — интервал для часов (например, `2` для чётных часов, `0` — убрать часы).
- `multiplicityMinutes` — интервал для минут (например, `15` для четвертей часа, `0` — убрать минуты).
- `multiplicitySeconds` — интервал для секунд (например, `0` — убрать секунды).

Комментарии по поведению timeOptions:

- Если `step = 0` или кастомные значения - пустой массив ([]), то соответствующие значения не будут отображаться.
- Если поле `hours`, `minutes` или `seconds` не указано, используется весь диапазон по умолчанию (0–23 для часов, 0–59 для минут и секунд).

<MdxTabs>

<DateTimeExampleTimeOptions />

```tsx
// Пример 1
<DateTime
  type="time"
  timeOptions={
    hours: { start: 9, step: 2, stop: 18 },    // 9, 11, 13, 15, 17
    minutes: [0, 15, 45],                      // конкретные значения минут
    // seconds не указаны — будут все значения по умолчанию (0–59)
  }
/>

// Пример 2
<DateTime
  type="time"
  timeOptions={
    hours: { step: 1 },        // все часы
    minutes: [],               // пустой массив — минуты не показываются
    seconds: { step: 0 },      // секунды не показываются
  }
/>

// Пример 3
<DateTime
  type="time"
  timeOptions={
    hours: { step: 1 },       // все часы
    minutes: { step: 15 },    // каждые 15 минут
    seconds: { step: 15 },    // каждые 15 секунд
  }
/>

// Пример 4
<DateTime
  type="time"
  timeOptions={
    hours: [8, 12, 16],
    minutes: [10, 40],
    seconds: [],              // пустой массив — секунды не показываются
  }
/>
```

</MdxTabs>

<MdxTabs>

<DateTimeExampleMultiplicity />

```tsx
<DateTime
  type="time"
  multiplicityHours={2}
  multiplicityMinutes={5}
  multiplicitySeconds={0}
/>
```

</MdxTabs>

### Локализация

Свойство `locale` позволяет настроить язык календаря с использованием библиотеки [date-fns](https://date-fns.org/). По умолчанию используется русская локализация (`ruLocale`).

<MdxTabs>

<DateTimeExampleLocale />

```tsx
import frLocale from 'date-fns/locale/fr';

const dateTimeLocale = {
  ...frLocale,
  words: {
    hours: 'H',
    minutes: 'Min',
    seconds: 'S',
  },
};

return <DateTime type="date-time" locale={dateTimeLocale} />;
```

</MdxTabs>

## Пример использования

```tsx
const [value, setValue] = useState<Date | undefined>();

return (
  <DateTime type="date" view="classic" value={value} onChange={setValue} />
);
```
