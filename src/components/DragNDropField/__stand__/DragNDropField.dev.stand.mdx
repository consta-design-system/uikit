import { MdxMenu, MdxTabs } from '@consta/stand';

import {
  DragNDropFieldExampleAcceptImage,
  DragNDropFieldExampleAcceptDoc,
  DragNDropFieldExampleAcceptError,
} from './examples/DragNDropFieldExampleAccept/DragNDropFieldExampleAccept';
import {
  DragNDropFieldExampleChildren,
  DragNDropFieldExampleRenderProps,
  DragNDropFieldExampleEmpty,
} from './examples/DragNDropFieldExampleChildren/DragNDropFieldExampleChildren';
import {
  DragNDropFieldExampleMaxSize,
  DragNDropFieldExampleMaxSizeError,
} from './examples/DragNDropFieldExampleMaxSize/DragNDropFieldExampleMaxSize';
import {
  DragNDropFieldExampleMultiple,
  DragNDropFieldExampleSingle,
  DragNDropFieldExampleMultipleError,
} from './examples/DragNDropFieldExampleMultiple/DragNDropFieldExampleMultiple';
import { DragNDropFieldExampleOnDropFiles } from './examples/DragNDropFieldExampleOnDropFiles/DragNDropFieldExampleOnDropFiles';
import { DragNDropFieldExampleErrorMessages } from './examples/DragNDropFieldExampleErrorMessages/DragNDropFieldExampleErrorMessages';

<MdxMenu>

- [Обзор](#обзор)
- [Импорт](#импорт)
- [Свойства](#свойства)
- [Содержимое](#содержимое)
  - [Использование Render Props](#использование-render-props)
  - [Пустое содержимое](#пустое-содержимое)
  - [Количество файлов](#количество-файлов)
  - [Типы файлов](#типы-файлов)
  - [Размер файла](#размер-файла)
- [Поведение](#поведение)
  - [Обработка загруженных файлов](#обработка-загруженных-файлов)
  - [Обработка ошибок](#обработка-ошибок)
- [Локализация](#локализация)
- [Пример использования](#пример-использования)

</MdxMenu>

## Обзор

`DragNDropField` — это компонент-контейнер для загрузки файлов. Он позволяет пользователю загружать файлы перетаскиванием или через диалоговое окно выбора файлов. Вы можете настроить типы файлов, их размер, количество и локализацию сообщений об ошибках.

## Импорт

```tsx
import { DragNDropField } from '@consta/uikit/DragNDropField';
```

## Свойства

| Свойство                                       | Тип                                                                               | По умолчанию | Описание                                                                                                                                         |
| ---------------------------------------------- | --------------------------------------------------------------------------------- | ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| [`multiple?`](#количество-файлов)              | `boolean`                                                                         | `false`      | Разрешает загрузку нескольких файлов одновременно. См. [MDN](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file#attr-multiple) |
| [`accept?`](#типы-файлов)                      | `string` \| `string[]`                                                            | -            | Список разрешённых типов файлов. См. [MDN](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file#unique_file_type_specifiers)     |
| [`maxSize?`](#размер-файла)                    | `number`                                                                          | -            | Максимальный размер файла в байтах.                                                                                                              |
| [`minSize?`](#размер-файла)                    | `number`                                                                          | -            | Минимальный размер файла в байтах.                                                                                                               |
| [`onDropFiles`](#обработка-загруженных-файлов) | `(files: File[]) => void`                                                         | -            | Обработчик события выбора файлов.                                                                                                                |
| [`children?`](#содержимое)                     | `React.ReactNode` \| `(props: { openFileDialog: () => void }) => React.ReactNode` | -            | Содержимое, отображаемое внутри компонента.                                                                                                      |
| [`locale?`](#локализация)                      | `Locale`                                                                          | -            | Настройки локализации для текстов и сообщений об ошибках.                                                                                        |
| `disabled?`                                    | `boolean`                                                                         | -            | Отключает взаимодействие с компонентом.                                                                                                          |
| `className?`                                   | `string`                                                                          | -            | Дополнительные CSS-классы для компонента.                                                                                                        |
| `ref?`                                         | `React.Ref<HTMLDivElement>`                                                       | -            | Ссылка на корневой DOM-элемент компонента.                                                                                                       |

```tsx
export type FileError = {
  message: string;
  code:
    | 'file-too-large'
    | 'file-too-small'
    | 'too-many-files'
    | 'file-invalid-type'
    | string;
};

export type DragNDropFieldPropErrorMessages = Partial<
  Record<
    FileError['code'],
    string | ((file: File | undefined, error?: FileError) => string)
  >
>;

type LocaleError =
  | string
  | ((props: { file: File; sizes: FileSizes }) => string);
type LocaleLabel = string | ((props: { fileText: string }) => string);

export type Locale = {
  'file-invalid-type'?: LocaleError; // принимает string
  'file-too-large'?: LocaleError; // принимает string
  'file-too-small'?: LocaleError; // принимает string
  'too-many-files'?: string;
  'general-error'?: string;
  'fit-files'?: string;
  'file'?: string;
  'files'?: string;
  'before'?: string;
  'gigabyte'?: string;
  'megabyte'?: string;
  'kilobyte'?: string;
  'byte'?: string;
  'max'?: string;
  'call-to-action'?: LocaleLabel; // принимает string
  'action-button'?: LocaleLabel; // принимает string
};
```

## Содержимое

Компонент `DragNDropField` отображает внутри себя всё, что вы в него добавите. Это может быть текст, кнопки или другие элементы.

<MdxTabs>

<DragNDropFieldExampleChildren />

```tsx
<DragNDropField>
  <Text>Здесь просто текст</Text>
</DragNDropField>
```

</MdxTabs>

### Использование Render Props

Вы можете передать функцию в качестве дочернего элемента, чтобы получить доступ к `openFileDialog` для открытия окна выбора файлов.

<MdxTabs>

<DragNDropFieldExampleRenderProps />

```tsx
<DragNDropField>
  {({ openFileDialog }) => (
    <>
      <Text>
        Пример с Render Props, открывает окно для выбора файла из дочернего
        блока
      </Text>
      <br />
      <Button onClick={openFileDialog} label="Выбрать файл" />
    </>
  )}
</DragNDropField>
```

</MdxTabs>

### Пустое содержимое

Если не передать дочерние элементы, компонент отобразит текст и кнопку по умолчанию.

<MdxTabs>

<DragNDropFieldExampleEmpty />

```tsx
<DragNDropField onDropFiles={(files) => console.log(files)} />
```

</MdxTabs>

### Количество файлов

Свойство `multiple` определяет, можно ли загружать несколько файлов одновременно. По умолчанию (`multiple={false}`) разрешается загрузка только одного файла.

<DragNDropFieldExampleMultiple />

<DragNDropFieldExampleSingle />

Если `multiple={false}`, а пользователь попытается загрузить несколько файлов, компонент покажет ошибку.

<DragNDropFieldExampleMultipleError />

### Типы файлов

Свойство `accept` позволяет ограничить типы файлов, которые можно загрузить. Поддерживаются:

- Расширения файлов (например, `.jpg`, `.docx`).
- MIME-типы (например, `application/xml`).
- Группы типов: `image/*`, `audio/*`, `video/*`.

См. [Подробнее о типах файлов](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file#unique_file_type_specifiers).

<MdxTabs>

<DragNDropFieldExampleAcceptImage />

```tsx
<DragNDropField accept="image/*" onDropFiles={(files) => console.log(files)}>
  <Text>Сюда можно перетаскивать только картинки, зато любые (ну почти)</Text>
  <Text view="ghost" font="mono">
    image/*
  </Text>
</DragNDropField>
```

</MdxTabs>

<MdxTabs>

<DragNDropFieldExampleAcceptDoc />

```tsx
<DragNDropField accept={['.doc', '.docx']}>
  <Text>Сюда можно перетаскивать только DOC и DOCX</Text>
  <Text view="ghost" font="mono">
    .doc, .docx
  </Text>
</DragNDropField>
```

</MdxTabs>

Если пользователь загрузит файл неподходящего типа, компонент покажет ошибку.

<DragNDropFieldExampleAcceptError />

### Размер файла

Свойства `maxSize` и `minSize` задают максимальный и минимальный размер файла в байтах.

<MdxTabs>

<DragNDropFieldExampleMaxSize />

```tsx
<DragNDropField maxSize={1 * 1024 * 1024}>
  <Text>Сюда можно перетаскивать файлы размером 1 Мб или меньше</Text>
</DragNDropField>
```

</MdxTabs>

Если файл превышает `maxSize` или меньше `minSize`, компонент покажет ошибку.

<DragNDropFieldExampleMaxSizeError />

## Поведение

### Обработка загруженных файлов

Свойство `onDropFiles` позволяет обработать загруженные файлы, например, отобразить их имена и расширения.

<MdxTabs>

<DragNDropFieldExampleOnDropFiles />

```tsx
const [files, setFiles] = React.useState<File[]>([]);
return (
  <>
    <DragNDropField multiple onDropFiles={setFiles}>
      <Text>Перетяните файлы сюда</Text>
    </DragNDropField>
    {files.map((file) => (
      <Attachment
        key={file.name}
        fileName={file.name}
        fileExtension={file.name.match(/\.(?!.*\.)(\w*)/)?.[1]}
        fileDescription={file.type}
      />
    ))}
  </>
);
```

</MdxTabs>

### Обработка ошибок

Компонент автоматически показывает ошибки, если:

- Файл превышает `maxSize` или меньше `minSize` ([Размер файла](#размер-файла)).
- Файл имеет неподходящий тип ([Типы файлов](#типы-файлов)).
- Загружено несколько файлов при `multiple={false}` ([Количество файлов](#количество-файлов)).

## Локализация

Свойство `locale` позволяет переопределить тексты кнопок, сообщений и ошибок.

| Свойство            | Тип и значения            | По умолчанию                                                                               | Описание                                                                |
| ------------------- | ------------------------- | ------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------- |
| `call-to-action`    | `LocaleLabel` \| `string` | `Перетащите файл сюда или загрузите по кнопке`                                             | Основной текст в окне компонента.                                       |
| `action-button`     | `LocaleLabel` \| `string` | `Выбрать файл`                                                                             | Текст кнопки в окне компонента.                                         |
| `file`              | `string`                  | `файл`                                                                                     | Используется в `call-to-action` и `action-button` при `multiple=false`. |
| `files`             | `string`                  | `файлы`                                                                                    | Используется в `call-to-action` и `action-button` при `multiple=true`.  |
| `fit-files`         | `string`                  | `Подходят файлы {from + размер + единица измерения + before + размер + единица измерения}` | Показывается при ограничениях по размеру или типу.                      |
| `from`              | `string`                  | `от`                                                                                       | Используется в `fit-files` при ограничении `minSize`.                   |
| `before`            | `string`                  | `до`                                                                                       | Используется в `fit-files` при ограничении `maxSize`.                   |
| `file-invalid-type` | `string`                  | `{имя файла}: формат файла не подходит ({тип файла})`                                      | Ошибка при неподходящем формате файла.                                  |
| `file-too-large`    | `string`                  | `{имя файла}: файл слишком большой (максимум {размер + единица измерения})`                | Ошибка при превышении `maxSize`.                                        |
| `file-too-small`    | `string`                  | `{имя файла}: файл слишком маленький (минимум {размер + единица измерения})`               | Ошибка при размере меньше `minSize`.                                    |
| `too-many-files`    | `string`                  | `Вы перетащили несколько файлов. Выберите один, пожалуйста`                                | Ошибка при загрузке нескольких файлов с `multiple=false`.               |
| `general-error`     | `string`                  | `{имя файла}: не получилось добавить файл`                                                 | Общая ошибка загрузки.                                                  |
| `gigabyte`          | `string`                  | `Гб`                                                                                       | Единица измерения для гигабайт.                                         |
| `megabyte`          | `string`                  | `Мб`                                                                                       | Единица измерения для мегабайт.                                         |
| `kilobyte`          | `string`                  | `Кб`                                                                                       | Единица измерения для килобайт.                                         |
| `byte`              | `string`                  | `байт`                                                                                     | Единица измерения для байт.                                             |

Пример с переопределением текста ошибки:

<MdxTabs>

<DragNDropFieldExampleErrorMessages />

```tsx
<DragNDropField
  onDropFiles={(files) => console.log(files)}
  maxSize={10}
  locale={{
    'file-too-large': ({ file }) => `Ой! Похоже ${file.name} слишком большой`,
  }}
/>
```

</MdxTabs>

## Пример использования

Базовый пример загрузки файлов с отображением их названий:

```tsx
const [files, setFiles] = React.useState<File[]>([]);
return (
  <>
    <DragNDropField multiple onDropFiles={setFiles}>
      <Text>Перетащите файлы сюда</Text>
    </DragNDropField>
    {files.map((file) => (
      <Attachment
        key={file.name}
        fileName={file.name}
        fileExtension={file.name.match(/\.(?!.*\.)(\w*)/)?.[1]}
        fileDescription={file.type}
      />
    ))}
  </>
);
```
