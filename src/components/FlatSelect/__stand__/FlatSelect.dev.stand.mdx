import { MdxMenu, MdxTabs } from '@consta/stand';
import { FlatSelectExampleItems } from './examples/FlatSelectExampleItems/FlatSelectExampleItems';
import { FlatSelectExampleDisabledItem } from './examples/FlatSelectExampleDisabledItem/FlatSelectExampleDisabledItem';
import { FlatSelectExampleMultiple } from './examples/FlatSelectExampleMultiple/FlatSelectExampleMultiple';
import { FlatSelectExampleGroups } from './examples/FlatSelectExampleGroups/FlatSelectExampleGroups';
import { FlatSelectExampleClearButton } from './examples/FlatSelectExampleClearButton/FlatSelectExampleClearButton';
import {
  FlatSelectExampleInput,
  FlatSelectExampleUseSearch,
} from './examples/FlatSelectExampleInput/FlatSelectExampleInput';

<MdxMenu>

- [Обзор](#обзор)
- [Импорт](#импорт)
- [Свойства](#свойства)
- [Содержимое](#содержимое)
  - [Элементы списка](#элементы-списка)
  - [Выбранное значение](#выбранное-значение)
  - [Поле ввода](#поле-ввода)
  - [Неактивный элемент списка](#неактивный-элемент-списка)
  - [Множественный выбор](#множественный-выбор)
  - [Группы](#группы)
  - [Кнопка очистки поля](#кнопка-очистки-поля)
- [Внешний вид](#внешний-вид)
  - [Размер](#размер)
  - [Стиль](#стиль)
  - [Форма](#форма)
  - [Статус](#статус)
- [Поведение](#поведение)
  - [Неактивный компонент](#неактивный-компонент)
  - [Поиск](#поиск)
  - [Создание новых вариантов](#создание-новых-вариантов)
  - [Виртуализация списка](#виртуализация-списка)
  - [Индикация загрузки](#индикация-загрузки)
  - [Выбор всех элементов](#выбор-всех-элементов)
  - [Управление состоянием выпадающего списка](#управление-состоянием-выпадающего-списка)
- [Кастомизация](#кастомизация)
  - [Кастомный элемент списка](#кастомный-элемент-списка)
  - [Кастомное выбранное значение](#кастомное-выбранное-значение)
  - [Кастомные типы данных](#кастомные-типы-данных)

</MdxMenu>

# Обзор

Компонент `FlatSelect` предоставляет список для выбора одного или нескольких вариантов. Поддерживает кастомизацию, группировку, поиск, виртуализацию и другие функции.

# Импорт

```js
import { FlatSelect } from '@consta/uikit/FlatSelect';
```

# Свойства

```ts
type FlatSelectPropOnChange<ITEM, MULTIPLE extends boolean> = (
  value: (MULTIPLE extends true ? ITEM[] : ITEM) | null,
  props: {
    e: React.SyntheticEvent;
  },
) => void;

type RenderItemProps<ITEM> = {
  item: ITEM;
  active: boolean;
  hovered: boolean;
  onClick: (e: React.MouseEvent) => void;
  onMouseEnter: (e: React.MouseEvent) => void;
  ref: React.Ref<HTMLDivElement>;
};

type FlatSelectPropRenderItem<ITEM> = (
  props: RenderItemProps<ITEM>,
) => React.ReactNode | null;

type FlatSelectPropOnCreate = (
  label: string,
  props: { e: React.SyntheticEvent },
) => void;

type FlatSelectPropValue<ITEM, MULTIPLE extends boolean> =
  | (MULTIPLE extends true ? ITEM[] : ITEM)
  | null
  | undefined;
```

| Свойство                | Тип или варианты значения                                              | По умолчанию              | Описание                                                                                                                                                                     |
| ----------------------- | ---------------------------------------------------------------------- | ------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| items                   | `ITEM[]`                                                               | -                         | Массив элементов, отображаемых в списке выбора.                                                                                                                              |
| onChange                | `FlatSelectPropOnChange<ITEM, MULTIPLE>`                               | -                         | Функция обратного вызова, срабатывающая при изменении выбора.                                                                                                                |
| disabled                | `boolean`                                                              | -                         | Указывает, отключен ли компонент.                                                                                                                                            |
| form                    | `'default'` \| `'brick'` \| `'round'`                                  | `'default'`               | Вариант стиля компонента.                                                                                                                                                    |
| placeholder             | `string`                                                               | -                         | Текст-заполнитель для поля ввода.                                                                                                                                            |
| size                    | `'m'` \| `'xs'` \| `'s'` \| `'l'`                                      | -                         | Размер компонента.                                                                                                                                                           |
| isLoading               | `boolean`                                                              | -                         | Указывает, находится ли компонент в состоянии загрузки.                                                                                                                      |
| listRef                 | `React.Ref<HTMLDivElement>`                                            | -                         | Ref для контейнера выпадающего списка.                                                                                                                                       |
| renderItem              | `FlatSelectPropRenderItem<ITEM>`                                       | -                         | Пользовательская функция отрисовки элементов.                                                                                                                                |
| onInputFocus            | `React.FocusEventHandler<HTMLInputElement>`                            | -                         | Функция обратного вызова, срабатывающая при фокусе на поле ввода.                                                                                                            |
| onInputBlur             | `React.FocusEventHandler<HTMLInputElement>`                            | -                         | Функция обратного вызова, срабатывающая при потере фокуса поля ввода.                                                                                                        |
| onCreate                | `FlatSelectPropOnCreate`                                               | -                         | Функция обратного вызова, срабатывающая при создании нового элемента.                                                                                                        |
| inputRef                | `React.Ref<HTMLInputElement>`                                          | -                         | Ref для поля ввода.                                                                                                                                                          |
| input                   | `boolean`                                                              | -                         | Указывает, включено ли поле ввода.                                                                                                                                           |
| inputValue              | `string`                                                               | -                         | Контролируемое значение поля ввода.                                                                                                                                          |
| inputDefaultValue       | `string`                                                               | -                         | Значение поля ввода по умолчанию.                                                                                                                                            |
| onInput                 | `(value: string) => void`                                              | -                         | Функция обратного вызова, срабатывающая при изменении значения ввода.                                                                                                        |
| labelForCreate          | `((label: string \| undefined) => React.ReactNode) \| React.ReactNode` | `'+'`                     | Метка или функция отрисовки для опции создания.                                                                                                                              |
| labelForEmptyItems      | `string`                                                               | `'Список пуст'`           | Метка, отображаемая, когда нет элементов.                                                                                                                                    |
| multiple                | `boolean`                                                              | `false`                   | Указывает, включен ли множественный выбор.                                                                                                                                   |
| value                   | `FlatSelectPropValue<ITEM, MULTIPLE>`                                  | -                         | Текущее выбранное значение(я).                                                                                                                                               |
| groups                  | `GROUP[]`                                                              | -                         | Массив групп для элементов.                                                                                                                                                  |
| getItemLabel            | `(item: ITEM) => string`                                               | `(item) => item.label`    | Функция для получения метки элемента.                                                                                                                                        |
| getItemKey              | `(item: ITEM) => string \| number`                                     | `(item) => item.id`       | Функция для получения уникального ключа элемента.                                                                                                                            |
| getItemGroupKey         | `(item: ITEM) => string \| number \| undefined`                        | `(item) => item.groupId`  | Функция для получения ключа группы элемента.                                                                                                                                 |
| getItemDisabled         | `(item: ITEM) => boolean \| undefined`                                 | `(item) => item.disabled` | Функция для проверки, отключен ли элемент.                                                                                                                                   |
| getGroupLabel           | `(group: GROUP) => string`                                             | `(group) => group.label`  | Функция для получения метки группы.                                                                                                                                          |
| getGroupKey             | `(group: GROUP) => string \| number`                                   | `(group) => group.id`     | Функция для получения уникального ключа группы.                                                                                                                              |
| virtualScroll           | `boolean`                                                              | -                         | Указывает, включена ли виртуальная прокрутка.                                                                                                                                |
| onScrollToBottom        | `(length: number) => void`                                             | -                         | Функция обратного вызова, срабатывающая при прокрутке до конца списка.                                                                                                       |
| onOpen                  | `(isOpen: boolean) => void`                                            | -                         | Функция обратного вызова, срабатывающая при открытии или закрытии списка.                                                                                                    |
| open                    | `boolean`                                                              | -                         | Контролирует состояние открытия выпадающего списка.                                                                                                                          |
| listClassName           | `string`                                                               | -                         | Дополнительный CSS-класс для выпадающего списка.                                                                                                                             |
| ignoreOutsideClicksRefs | `ReadonlyArray<React.RefObject<HTMLElement>>`                          | -                         | Массив рефов, игнорируемых при определении кликов вне области.                                                                                                               |
| clearButton             | `boolean`                                                              | -                         | Указывает, включена ли кнопка очистки.                                                                                                                                       |
| iconClear               | `IconComponent`                                                        | -                         | Компонент иконки для кнопки очистки.                                                                                                                                         |
| iconLeft                | `IconComponent`                                                        | -                         | Компонент иконки, отображаемой слева от поля ввода.                                                                                                                          |
| selectAll               | `boolean`                                                              | -                         | Указывает, включена ли опция "выбрать все" (только при множественном выборе).                                                                                                |
| selectAllLabel          | `string`                                                               | 'Выбрать все'             | Метка для опции "выбрать все".                                                                                                                                               |
| footer                  | `React.ReactNode`                                                      | -                         | Содержимое футера выпадающего списка.                                                                                                                                        |
| view                    | `'default'` \| `'clear'`                                               | `'default'`               | Стиль отображения компонента.                                                                                                                                                |
| bordered                | `boolean`                                                              | -                         | Указывает, есть ли у компонента граница.                                                                                                                                     |
| anchorRef               | `React.RefObject<HTMLElement>`                                         | -                         | Ref для элемента-якоря, используемого для позиционирования списка.                                                                                                           |
| direction               | `Direction`                                                            | -                         | Предпочтительное направление для выпадающего списка. (см. [Popover](##LIBS.LIB.STAND.TAB/lib:uikit/stand:components-popover-stable/tab:dev/hash:направление-разворачивания)) |
| spareDirection          | `Direction`                                                            | -                         | Резервное направление для выпадающего списка. (см. [Popover](##LIBS.LIB.STAND.TAB/lib:uikit/stand:components-popover-stable/tab:dev/hash:направление-разворачивания))        |
| possibleDirections      | `Direction[]`                                                          | -                         | Массив возможных направлений для выпадающего списка. (см. [Popover](##LIBS.LIB.STAND.TAB/lib:uikit/stand:components-popover-stable/tab:dev/hash:направление-разворачивания)) |
| className               | `string`                                                               | -                         | Дополнительный CSS-класс                                                                                                                                                     |
| ref                     | `React.Ref<HTMLDivElement>`                                            | -                         | Ссылка на корневой DOM-элемент компонента                                                                                                                                    |

# Содержимое

## Элементы списка

Свойство items задаёт массив элементов выпадающего списка. Тип по умолчанию — `FlatSelectItemDefault`:

```tsx
type FlatSelectItemDefault = {
  label: string; // название элемента (пишите с заглавной буквы, без точки).
  id: string | number; // уникальный ключ элемента.
  groupId?: string | number; // идентификатор группы (если используются группы).
  disabled?: boolean; // флаг неактивного элемента.
};
```

## Выбранное значение

Свойство `value` задаёт текущее выбранное значение (один элемент или массив при `multiple`). Для обработки выбора используйте `onChange`, который возвращает выбранное значение и событие. Выбор срабатывает по клику или нажатию `Enter`.

<MdxTabs>

<FlatSelectExampleItems />

```tsx
const items: FlatSelectItemDefault[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const FlatSelectExampleItems = () => {
  const [value, setValue] = useState<FlatSelectItemDefault | null>();
  return <FlatSelect items={items} value={value} onChange={setValue} />;
};
```

</MdxTabs>

## Поле ввода

Свойство `input` включает поле ввода для поиска по элементам. Логика поиска не реализована внутри компонента но вы можете использовать свойство `onInput` для реализации поиска.

<MdxTabs>

<FlatSelectExampleInput />

```tsx
import { useSearch } from '@consta/uikit/SelectCanary';
import { useDebounce } from '@consta/uikit/useDebounce';
import { FlatSelect } from '@consta/uikit/FlatSelect';

const items: FlatSelectItemDefault[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const search = (item: FlatSelectItemDefault, input: string) => {
  return item.label.toLowerCase().includes(input.toLowerCase());
};

const FlatSelectExampleInput = () => {
  const [value, setValue] = useState<FlatSelectItemDefault | null>();
  const [inputState, setInputState] = useState('');

  const filteredItems = useMemo(() => {
    if (!inputState) return items;
    return items.filter((item) => search(item, inputState));
  }, [inputState]);

  return (
    <FlatSelect
      items={filteredItems}
      input
      placeholder="Поиск"
      onInput={useDebounce(setInputState, 300)}
      value={value}
      onChange={setValue}
    />
  );
};
```

</MdxTabs>

Также можете взять хук `useSearch` из `@consta/uikit/SelectCanary` для реализации поиска.

<MdxTabs>

<FlatSelectExampleUseSearch />

```tsx
import { useSearch } from '@consta/uikit/SelectCanary';
import { FlatSelect } from '@consta/uikit/FlatSelect';

const items: FlatSelectItemDefault[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const FlatSelectExampleUseSearch = () => {
  const [value, setValue] = useState<FlatSelectItemDefault | null>();
  return (
    <FlatSelect
      {...useSearch({ items })}
      placeholder="Поиск"
      value={value}
      onChange={setValue}
    />
  );
};
```

</MdxTabs>

## Неактивный элемент списка

Чтобы сделать элемент списка неактивным, добавьте в объект массива `items` свойство `disabled: true`. Или используйте функцию `getItemDisabled`.

<MdxTabs>

<FlatSelectExampleDisabledItem />

```tsx
type Item = {
  label: string;
  id: number;
  disabled: boolean;
};

const items: Item[] = [
  {
    label: 'Первый — этот вариант не выбрать',
    id: 1,
    disabled: true,
  },
  {
    label: 'Второй',
    id: 2,
    disabled: false,
  },
  {
    label: 'Третий — и этот тоже не выбрать',
    id: 3,
    disabled: true,
  },
];

const FlatSelectExampleDisabledItem = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <Example col={1}>
      <FlatSelect
        placeholder="Выберите вариант"
        items={items}
        value={value}
        onChange={setValue}
      />
    </Example>
  );
};
```

</MdxTabs>

## Множественный выбор

Для выбора нескольких элементов установите `multiple`. В этом случае value и onChange работают с массивом элементов.

<MdxTabs>

<FlatSelectExampleMultiple />

```tsx
type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const FlatSelectExampleMultiple = () => {
  const [value, setValue] = useState<Item[] | null>();
  return (
    <FlatSelect items={items} value={value} onChange={setValue} multiple />
  );
};
```

</MdxTabs>

## Группы

Для группировки элементов используйте свойство `groups`, тип по умолчанию — `FlatSelectGroupDefault`:

```ts
type FlatSelectGroupDefault = {
  label: string;
  id: string | number;
};
```

Элементы списка привязываются к группе по свойству `groupId` или через функцию `getItemGroupId`.

<MdxTabs>

<FlatSelectExampleGroups />

```tsx
type Item = {
  label: string;
  id: number;
  groupId: number;
};

type Group = {
  label: string;
  id: number;
};

const groups: Group[] = [
  {
    id: 1,
    label: 'Первая группа',
  },
  {
    id: 2,
    label: 'Вторая группа',
  },
  {
    id: 3,
    label: 'Третья группа',
  },
];

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
    groupId: 1,
  },
  {
    label: 'Второй',
    id: 2,
    groupId: 2,
  },
  {
    label: 'Третий',
    id: 3,
    groupId: 1,
  },
  {
    label: 'Четвертый',
    id: 4,
    groupId: 3,
  },
  {
    label: 'Пятый',
    id: 5,
    groupId: 2,
  },
];

const FlatSelectExampleGroups = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <FlatSelect
      items={items}
      value={value}
      onChange={setValue}
      groups={groups}
    />
  );
};
```

</MdxTabs>

## Кнопка очистки поля

Чтобы добавить кнопку очистки поля, установите свойство `clearButton`.

<MdxTabs>

<FlatSelectExampleClearButton />

```tsx
import { useSearch } from '@consta/uikit/SelectCanary';

type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const FlatSelectExampleClearButton = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <FlatSelect
      {...useSearch({ items })}
      placeholder="Поиск"
      value={value}
      onChange={setValue}
      clearButton
    />
  );
};
```

</MdxTabs>
