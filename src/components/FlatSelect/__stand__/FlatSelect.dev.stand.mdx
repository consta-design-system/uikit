import { MdxMenu, MdxTabs, MdxInformer } from '@consta/stand';
import { FlatSelectExampleItems } from './examples/FlatSelectExampleItems/FlatSelectExampleItems';
import { FlatSelectExampleDisabledItem } from './examples/FlatSelectExampleDisabledItem/FlatSelectExampleDisabledItem';
import { FlatSelectExampleMultiple } from './examples/FlatSelectExampleMultiple/FlatSelectExampleMultiple';
import { FlatSelectExampleGroups } from './examples/FlatSelectExampleGroups/FlatSelectExampleGroups';
import { FlatSelectExampleSize } from './examples/FlatSelectExampleSize/FlatSelectExampleSize';
import { FlatSelectExampleClearButton } from './examples/FlatSelectExampleClearButton/FlatSelectExampleClearButton';
import { FlatSelectExampleView } from './examples/FlatSelectExampleView/FlatSelectExampleView';
import { FlatSelectExampleBorder } from './examples/FlatSelectExampleBorder/FlatSelectExampleBorder';
import { FlatSelectExampleForm } from './examples/FlatSelectExampleForm/FlatSelectExampleForm';
import { FlatSelectExampleIcon } from './examples/FlatSelectExampleIcon/FlatSelectExampleIcon';
import { FlatSelectExampleFooter } from './examples/FlatSelectExampleFooter/FlatSelectExampleFooter';
import { FlatSelectExampleAnchor } from './examples/FlatSelectExampleAnchor/FlatSelectExampleAnchor';
import { FlatSelectExampleDisabled } from './examples/FlatSelectExampleDisabled/FlatSelectExampleDisabled';
import { FlatSelectExampleCreate } from './examples/FlatSelectExampleCreate/FlatSelectExampleCreate';
import { FlatSelectExampleVirtualScroll } from './examples/FlatSelectExampleVirtualScroll/FlatSelectExampleVirtualScroll';
import { FlatSelectExampleLoading } from './examples/FlatSelectExampleLoading/FlatSelectExampleLoading';
import { FlatSelectExampleSelectAll } from './examples/FlatSelectExampleSelectAll/FlatSelectExampleSelectAll';
import { FlatSelectExampleIsOpen } from './examples/FlatSelectExampleIsOpen/FlatSelectExampleIsOpen';
import { FlatSelectExampleRenderItem } from './examples/FlatSelectExampleRenderItem/FlatSelectExampleRenderItem';
import {
  FlatSelectExampleInput,
  FlatSelectExampleUseSearch,
} from './examples/FlatSelectExampleInput/FlatSelectExampleInput';

<MdxMenu>

- [Обзор](#обзор)
- [Импорт](#импорт)
- [Свойства](#свойства)
- [Содержимое](#содержимое)
  - [Элементы списка](#элементы-списка)
  - [Выбранное значение](#выбранное-значение)
  - [Поле ввода](#поле-ввода)
  - [Неактивный элемент списка](#неактивный-элемент-списка)
  - [Множественный выбор](#множественный-выбор)
  - [Группы](#группы)
  - [Кнопка очистки поля](#кнопка-очистки-поля)
  - [Иконка](#иконка)
  - [Подвал](#подвал)
- [Внешний вид](#внешний-вид)
  - [Размер](#размер)
  - [Вид](#вид)
  - [Обводка](#обводка)
  - [Форма](#форма)
  - [Всплывающий вид](#всплывающий-вид)
- [Поведение](#поведение)
  - [Неактивный компонент](#неактивный-компонент)
  - [Создание новых вариантов](#создание-новых-вариантов)
  - [Виртуализация списка](#виртуализация-списка)
  - [Индикация загрузки](#индикация-загрузки)
  - [Выбор всех элементов](#выбор-всех-элементов)
  - [Управление состоянием выпадающего списка](#управление-состоянием-выпадающего-списка)
- [Кастомизация](#кастомизация)
  - [Кастомный элемент списка](#кастомный-элемент-списка)
  - [Кастомные типы данных](#кастомные-типы-данных)

</MdxMenu>

## Обзор

Компонент `FlatSelect` предоставляет список для выбора одного или нескольких вариантов. Поддерживает кастомизацию, группировку, поиск, виртуализацию и другие функции.

## Импорт

```js
import { FlatSelect } from '@consta/uikit/FlatSelect';
```

## Свойства

```ts
type FlatSelectPropOnChange<ITEM, MULTIPLE extends boolean> = (
  value: (MULTIPLE extends true ? ITEM[] : ITEM) | null,
  props: {
    e: React.SyntheticEvent;
  },
) => void;

type RenderItemProps<ITEM> = {
  item: ITEM;
  active: boolean;
  hovered: boolean;
  onClick: (e: React.MouseEvent) => void;
  onMouseEnter: (e: React.MouseEvent) => void;
  ref: React.Ref<HTMLDivElement>;
};

type FlatSelectPropRenderItem<ITEM> = (
  props: RenderItemProps<ITEM>,
) => React.ReactNode | null;

type FlatSelectPropOnCreate = (
  label: string,
  props: { e: React.SyntheticEvent },
) => void;

type FlatSelectPropValue<ITEM, MULTIPLE extends boolean> =
  | (MULTIPLE extends true ? ITEM[] : ITEM)
  | null
  | undefined;
```

| Свойство                | Тип или варианты значения                                              | По умолчанию              | Описание                                                                                                                                                                     |
| ----------------------- | ---------------------------------------------------------------------- | ------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| items                   | `ITEM[]`                                                               | -                         | Массив элементов, отображаемых в списке выбора.                                                                                                                              |
| onChange                | `FlatSelectPropOnChange<ITEM, MULTIPLE>`                               | -                         | Функция обратного вызова, срабатывающая при изменении выбора.                                                                                                                |
| disabled                | `boolean`                                                              | -                         | Указывает, отключен ли компонент.                                                                                                                                            |
| form                    | `'default'` \| `'brick'` \| `'round'`                                  | `'default'`               | Вариант стиля компонента.                                                                                                                                                    |
| placeholder             | `string`                                                               | -                         | Текст-заполнитель для поля ввода.                                                                                                                                            |
| size                    | `'m'` \| `'xs'` \| `'s'` \| `'l'`                                      | -                         | Размер компонента.                                                                                                                                                           |
| isLoading               | `boolean`                                                              | -                         | Указывает, находится ли компонент в состоянии загрузки.                                                                                                                      |
| listRef                 | `React.Ref<HTMLDivElement>`                                            | -                         | Ref для контейнера выпадающего списка.                                                                                                                                       |
| renderItem              | `FlatSelectPropRenderItem<ITEM>`                                       | -                         | Пользовательская функция отрисовки элементов.                                                                                                                                |
| onInputFocus            | `React.FocusEventHandler<HTMLInputElement>`                            | -                         | Функция обратного вызова, срабатывающая при фокусе на поле ввода.                                                                                                            |
| onInputBlur             | `React.FocusEventHandler<HTMLInputElement>`                            | -                         | Функция обратного вызова, срабатывающая при потере фокуса поля ввода.                                                                                                        |
| onCreate                | `FlatSelectPropOnCreate`                                               | -                         | Функция обратного вызова, срабатывающая при создании нового элемента.                                                                                                        |
| inputRef                | `React.Ref<HTMLInputElement>`                                          | -                         | Ref для поля ввода.                                                                                                                                                          |
| input                   | `boolean`                                                              | -                         | Указывает, включено ли поле ввода.                                                                                                                                           |
| inputValue              | `string`                                                               | -                         | Контролируемое значение поля ввода.                                                                                                                                          |
| inputDefaultValue       | `string`                                                               | -                         | Значение поля ввода по умолчанию.                                                                                                                                            |
| onInput                 | `(value: string) => void`                                              | -                         | Функция обратного вызова, срабатывающая при изменении значения ввода.                                                                                                        |
| labelForCreate          | `((label: string \| undefined) => React.ReactNode) \| React.ReactNode` | `'+'`                     | Метка или функция отрисовки для опции создания.                                                                                                                              |
| labelForEmptyItems      | `string`                                                               | `'Список пуст'`           | Метка, отображаемая, когда нет элементов.                                                                                                                                    |
| multiple                | `boolean`                                                              | `false`                   | Указывает, включен ли множественный выбор.                                                                                                                                   |
| value                   | `FlatSelectPropValue<ITEM, MULTIPLE>`                                  | -                         | Текущее выбранное значение(я).                                                                                                                                               |
| groups                  | `GROUP[]`                                                              | -                         | Массив групп для элементов.                                                                                                                                                  |
| getItemLabel            | `(item: ITEM) => string`                                               | `(item) => item.label`    | Функция для получения метки элемента.                                                                                                                                        |
| getItemKey              | `(item: ITEM) => string \| number`                                     | `(item) => item.id`       | Функция для получения уникального ключа элемента.                                                                                                                            |
| getItemGroupKey         | `(item: ITEM) => string \| number \| undefined`                        | `(item) => item.groupId`  | Функция для получения ключа группы элемента.                                                                                                                                 |
| getItemDisabled         | `(item: ITEM) => boolean \| undefined`                                 | `(item) => item.disabled` | Функция для проверки, отключен ли элемент.                                                                                                                                   |
| getGroupLabel           | `(group: GROUP) => string`                                             | `(group) => group.label`  | Функция для получения метки группы.                                                                                                                                          |
| getGroupKey             | `(group: GROUP) => string \| number`                                   | `(group) => group.id`     | Функция для получения уникального ключа группы.                                                                                                                              |
| virtualScroll           | `boolean`                                                              | -                         | Указывает, включена ли виртуальная прокрутка.                                                                                                                                |
| onScrollToBottom        | `(length: number) => void`                                             | -                         | Функция обратного вызова, срабатывающая при прокрутке до конца списка.                                                                                                       |
| onOpen                  | `(isOpen: boolean) => void`                                            | -                         | Функция обратного вызова, срабатывающая при открытии или закрытии списка.                                                                                                    |
| open                    | `boolean`                                                              | -                         | Контролирует состояние открытия выпадающего списка.                                                                                                                          |
| listClassName           | `string`                                                               | -                         | Дополнительный CSS-класс для выпадающего списка.                                                                                                                             |
| ignoreOutsideClicksRefs | `ReadonlyArray<React.RefObject<HTMLElement>>`                          | -                         | Массив рефов, игнорируемых при определении кликов вне области.                                                                                                               |
| clearButton             | `boolean`                                                              | -                         | Указывает, включена ли кнопка очистки.                                                                                                                                       |
| iconClear               | `IconComponent`                                                        | -                         | Компонент иконки для кнопки очистки.                                                                                                                                         |
| iconLeft                | `IconComponent`                                                        | -                         | Компонент иконки, отображаемой слева от поля ввода.                                                                                                                          |
| selectAll               | `boolean`                                                              | -                         | Указывает, включена ли опция "выбрать все" (только при множественном выборе).                                                                                                |
| selectAllLabel          | `string`                                                               | 'Выбрать все'             | Метка для опции "выбрать все".                                                                                                                                               |
| footer                  | `React.ReactNode`                                                      | -                         | Содержимое футера выпадающего списка.                                                                                                                                        |
| view                    | `'default'` \| `'clear'`                                               | `'default'`               | Стиль отображения компонента.                                                                                                                                                |
| bordered                | `boolean`                                                              | -                         | Указывает, есть ли у компонента граница.                                                                                                                                     |
| anchorRef               | `React.RefObject<HTMLElement>`                                         | -                         | Ref для элемента-якоря, используемого для позиционирования списка.                                                                                                           |
| direction               | `Direction`                                                            | -                         | Предпочтительное направление для выпадающего списка. (см. [Popover](##LIBS.LIB.STAND.TAB/lib:uikit/stand:components-popover-stable/tab:dev/hash:направление-разворачивания)) |
| spareDirection          | `Direction`                                                            | -                         | Резервное направление для выпадающего списка. (см. [Popover](##LIBS.LIB.STAND.TAB/lib:uikit/stand:components-popover-stable/tab:dev/hash:направление-разворачивания))        |
| possibleDirections      | `Direction[]`                                                          | -                         | Массив возможных направлений для выпадающего списка. (см. [Popover](##LIBS.LIB.STAND.TAB/lib:uikit/stand:components-popover-stable/tab:dev/hash:направление-разворачивания)) |
| className               | `string`                                                               | -                         | Дополнительный CSS-класс                                                                                                                                                     |
| ref                     | `React.Ref<HTMLDivElement>`                                            | -                         | Ссылка на корневой DOM-элемент компонента                                                                                                                                    |

## Содержимое

### Элементы списка

Свойство items задаёт массив элементов выпадающего списка. Тип по умолчанию — `FlatSelectItemDefault`:

```tsx
type FlatSelectItemDefault = {
  label: string; // название элемента (пишите с заглавной буквы, без точки).
  id: string | number; // уникальный ключ элемента.
  groupId?: string | number; // идентификатор группы (если используются группы).
  disabled?: boolean; // флаг неактивного элемента.
};
```

### Выбранное значение

Свойство `value` задаёт текущее выбранное значение (один элемент или массив при `multiple`). Для обработки выбора используйте `onChange`, который возвращает выбранное значение и событие. Выбор срабатывает по клику или нажатию `Enter`.

<MdxTabs>

<FlatSelectExampleItems />

```tsx
const items: FlatSelectItemDefault[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const FlatSelectExampleItems = () => {
  const [value, setValue] = useState<FlatSelectItemDefault | null>();
  return <FlatSelect items={items} value={value} onChange={setValue} />;
};
```

</MdxTabs>

### Поле ввода

Свойство `input` включает поле ввода для поиска по элементам. Логика поиска не реализована внутри компонента но вы можете использовать свойство `onInput` для реализации поиска.

<MdxTabs>

<FlatSelectExampleInput />

```tsx
import { useSearch } from '@consta/uikit/SelectCanary';
import { useDebounce } from '@consta/uikit/useDebounce';
import { FlatSelect } from '@consta/uikit/FlatSelect';

const items: FlatSelectItemDefault[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const search = (item: FlatSelectItemDefault, input: string) => {
  return item.label.toLowerCase().includes(input.toLowerCase());
};

const FlatSelectExampleInput = () => {
  const [value, setValue] = useState<FlatSelectItemDefault | null>();
  const [inputState, setInputState] = useState('');

  const filteredItems = useMemo(() => {
    if (!inputState) return items;
    return items.filter((item) => search(item, inputState));
  }, [inputState]);

  return (
    <FlatSelect
      items={filteredItems}
      input
      placeholder="Поиск"
      onInput={useDebounce(setInputState, 300)}
      value={value}
      onChange={setValue}
    />
  );
};
```

</MdxTabs>

Также можете взять хук `useSearch` из `@consta/uikit/SelectCanary` для реализации поиска.

<MdxTabs>

<FlatSelectExampleUseSearch />

```tsx
import { useSearch } from '@consta/uikit/SelectCanary';
import { FlatSelect } from '@consta/uikit/FlatSelect';

const items: FlatSelectItemDefault[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const FlatSelectExampleUseSearch = () => {
  const [value, setValue] = useState<FlatSelectItemDefault | null>();
  return (
    <FlatSelect
      {...useSearch({ items })}
      placeholder="Поиск"
      value={value}
      onChange={setValue}
    />
  );
};
```

</MdxTabs>

### Неактивный элемент списка

Чтобы сделать элемент списка неактивным, добавьте в объект массива `items` свойство `disabled: true`. Или используйте функцию `getItemDisabled`.

<MdxTabs>

<FlatSelectExampleDisabledItem />

```tsx
type Item = {
  label: string;
  id: number;
  disabled: boolean;
};

const items: Item[] = [
  {
    label: 'Первый — этот вариант не выбрать',
    id: 1,
    disabled: true,
  },
  {
    label: 'Второй',
    id: 2,
    disabled: false,
  },
  {
    label: 'Третий — и этот тоже не выбрать',
    id: 3,
    disabled: true,
  },
];

const FlatSelectExampleDisabledItem = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <Example col={1}>
      <FlatSelect
        placeholder="Выберите вариант"
        items={items}
        value={value}
        onChange={setValue}
      />
    </Example>
  );
};
```

</MdxTabs>

### Множественный выбор

Для выбора нескольких элементов установите `multiple`. В этом случае value и onChange работают с массивом элементов.

<MdxTabs>

<FlatSelectExampleMultiple />

```tsx
type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const FlatSelectExampleMultiple = () => {
  const [value, setValue] = useState<Item[] | null>();
  return (
    <FlatSelect items={items} value={value} onChange={setValue} multiple />
  );
};
```

</MdxTabs>

### Группы

Для группировки элементов используйте свойство `groups`, тип по умолчанию — `FlatSelectGroupDefault`:

```ts
type FlatSelectGroupDefault = {
  label: string;
  id: string | number;
};
```

Элементы списка привязываются к группе по свойству `groupId` или через функцию `getItemGroupId`.

<MdxTabs>

<FlatSelectExampleGroups />

```tsx
type Item = {
  label: string;
  id: number;
  groupId: number;
};

type Group = {
  label: string;
  id: number;
};

const groups: Group[] = [
  {
    id: 1,
    label: 'Первая группа',
  },
  {
    id: 2,
    label: 'Вторая группа',
  },
  {
    id: 3,
    label: 'Третья группа',
  },
];

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
    groupId: 1,
  },
  {
    label: 'Второй',
    id: 2,
    groupId: 2,
  },
  {
    label: 'Третий',
    id: 3,
    groupId: 1,
  },
  {
    label: 'Четвертый',
    id: 4,
    groupId: 3,
  },
  {
    label: 'Пятый',
    id: 5,
    groupId: 2,
  },
];

const FlatSelectExampleGroups = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <FlatSelect
      items={items}
      value={value}
      onChange={setValue}
      groups={groups}
    />
  );
};
```

</MdxTabs>

### Кнопка очистки поля

Чтобы добавить кнопку очистки поля, установите свойство `clearButton`.

<MdxTabs>

<FlatSelectExampleClearButton />

```tsx
import { useSearch } from '@consta/uikit/SelectCanary';

type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const FlatSelectExampleClearButton = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <FlatSelect
      {...useSearch({ items })}
      placeholder="Поиск"
      value={value}
      onChange={setValue}
      clearButton
    />
  );
};
```

</MdxTabs>

### Иконка

Чтобы добавить иконку, установите свойство `iconLeft`.

<MdxTabs>

<FlatSelectExampleIcon />

```tsx
import { useSearch } from '@consta/uikit/SelectCanary';
import { IconSearchStroked } from '@consta/icons/IconSearchStroked';

type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const FlatSelectExampleIcon = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <FlatSelect
      {...useSearch({ items })}
      placeholder="Поиск"
      iconLeft={IconSearchStroked}
      value={value}
      onChange={setValue}
    />
  );
};
```

</MdxTabs>

### Подвал

Чтобы добавить подвал, установите свойство `footer`. Если передавать массив нод, то отступы между нодами будут расставляться автоматически.

<MdxTabs>

<FlatSelectExampleFooter />

```tsx
import { useSearch } from '@consta/uikit/SelectCanary';

type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const cnFlatSelectExampleFooter = cn('FlatSelectExampleFooter');

const FlatSelectExampleFooter = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <FlatSelect
      {...useSearch({ items })}
      className={cnFlatSelectExampleFooter()}
      placeholder="Поиск"
      value={value}
      onChange={setValue}
      bordered
      footer={[
        <Button label="Сбросить" view="ghost" />,
        <Button label="Применить" />,
      ]}
    />
  );
};
```

```css
.FlatSelectExampleFooter {
  background: var(--color-bg-default);

  .FlatSelectFooter {
    background: var(--color-bg-secondary);
  }
}
```

</MdxTabs>

## Внешний вид

### Размеры

Для изменения размера выбора используйте свойство `size`. Доступные значения: `xs`, `s`, `m`, `l`.

<MdxTabs>

<FlatSelectExampleSize />

```tsx
type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const FlatSelectExampleSize = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <FlatSelect items={items} value={value} onChange={setValue} size="s" />
  );
};
```

</MdxTabs>

### Вид

За вид отвечает свойство `view`. Доступные значения: `default`, `clear`.

<MdxTabs>

<FlatSelectExampleView />

```tsx
import { useSearch } from '@consta/uikit/SelectCanary';

type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const FlatSelectExampleView = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <FlatSelect
      {...useSearch({ items })}
      value={value}
      onChange={setValue}
      view="clear"
    />
  );
};
```

</MdxTabs>

### Обводка

Для того, чтобы добавить обводку, установите свойство `bordered`.

<MdxInformer>

Если включить свойство `bordered`, то свойство `view` автоматически станет `clear`.

</MdxInformer>

<MdxTabs>

<FlatSelectExampleBorder />

```tsx
import { useSearch } from '@consta/uikit/SelectCanary';

type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const FlatSelectExampleBorder = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <FlatSelect
      {...useSearch({ items })}
      value={value}
      onChange={setValue}
      bordered
    />
  );
};
```

</MdxTabs>

### Форма

Для того, чтобы добавить форму, установите свойство `form`. Доступные значения: `default`, `round`, `brick`.

<MdxInformer>

В случае, если установлено свойство `bordered`, то свойство будет менять форму контейнера. Если нет то форму поля ввода.

</MdxInformer>

<MdxTabs>

<FlatSelectExampleForm />

```tsx
import { useSearch } from '@consta/uikit/SelectCanary';

type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const FlatSelectExampleForm = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <FlatSelect
      {...useSearch({ items })}
      value={value}
      onChange={setValue}
      form="round"
    />
  );
};
```

</MdxTabs>

### Всплывающий вид

Для того, чтобы добавить всплывающий вид, передайте в свойство `anchorRef` ссылку на элемент по клику на которой необходимо отображать компонент `FlatSelect`.

<MdxInformer>

Компонент с `anchorRef` всегда будет отображаться как `view="clear"` и `bordered={true}`.

</MdxInformer>

<MdxTabs>

<FlatSelectExampleAnchor />

```tsx
import { useSearch } from '@consta/uikit/SelectCanary';

const items: FlatSelectItemDefault[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const FlatSelectExampleAnchor = () => {
  const [value, setValue] = useState<FlatSelectItemDefault | null>();
  const anchorRef = useRef<HTMLButtonElement | null>(null);
  return (
    <>
      <Button iconLeft={IconFunnel} ref={anchorRef} />
      <FlatSelect
        {...useSearch({ items })}
        anchorRef={anchorRef}
        placeholder="Поиск"
        value={value}
        onChange={setValue}
      />
    </>
  );
};
```

</MdxTabs>

## Поведение

### Неактивный компонент

Для того, чтобы добавить неактивный компонент, установите свойство `disabled`.

<MdxTabs>

<FlatSelectExampleDisabled />

```tsx
const items: FlatSelectItemDefault[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const FlatSelectExampleDisabled = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <Example col={1}>
      <FlatSelect items={items} value={value} onChange={setValue} disabled />
    </Example>
  );
};
```

</MdxTabs>

### Создание новых вариантов

Свойство `onCreate` позволяет добавлять новые элементы в список. Передаётся label введённого значения.

<MdxTabs>

<FlatSelectExampleCreate />

```tsx
import React, { useCallback, useState } from 'react';

import {
  getSearchFunctionDefault,
  useSearch,
} from '@consta/uikit/SelectCanary';

import { FlatSelect } from '@consta/uikit/FlatSelect';

const getItemLabel = (item: string) => item;

export const FlatSelectExampleCreate = () => {
  const [value, setValue] = useState<string | null>();
  const [list, setList] = useState<string[]>(['Первый', 'Второй', 'Третий']);
  const { items, labelForEmptyItems, onInput } = useSearch({
    items: list,
    search: getSearchFunctionDefault(getItemLabel),
  });
  const onCreate = useCallback(
    (label: string) => setList((state) => [label, ...state]),
    [],
  );

  return (
    <FlatSelect
      placeholder="Выберите вариант"
      items={items}
      value={value}
      onChange={setValue}
      getItemLabel={getItemLabel}
      getItemKey={getItemLabel}
      onCreate={!items.length ? onCreate : undefined}
      labelForEmptyItems={labelForEmptyItems}
      onInput={onInput}
      input
    />
  );
};
```

</MdxTabs>

### Виртуализация списка

Свойство `virtualScroll` оптимизирует отображение больших списков.

<MdxInformer>

Для того чтобы виртуальный скролл работал необходимо ограничить высоты списка, это можно сделать через свойство `listClassName`.

</MdxInformer>

<MdxTabs>

<FlatSelectExampleVirtualScroll />

```tsx
import './FlatSelectExampleVirtualScroll.css';

import { Example } from '@consta/stand';
import React, { useState } from 'react';

import { useSearch } from '@consta/uikit/SelectCanary';

import { FlatSelect } from '@consta/uikit/FlatSelect';

type Item = {
  label: string;
  id: number;
  groupId: number;
};

type Group = {
  label: string;
  id: number;
};

const items: Item[] = new Array(1000).fill(null).map((_, i) => ({
  label: `Опция ${i + 1}`,
  groupId: Math.floor(i / 100) + 1,
  id: i,
}));

const groups: Group[] = new Array(items.length / 100)
  .fill(null)
  .map((_, i) => ({
    id: i + 1,
    label: `Группа ${i + 1}`,
  }));

const cnFlatSelectExampleVirtualScroll = cn('FlatSelectExampleVirtualScroll');

export const FlatSelectExampleVirtualScroll = () => {
  const [value, setValue] = useState<Item[] | null>();

  return (
    <Example col={1}>
      <FlatSelect
        {...useSearch({ items })}
        listClassName={cnFlatSelectExampleVirtualScroll('List')}
        placeholder="Поиск"
        value={value}
        onChange={setValue}
        groups={groups}
        multiple
        selectAll
        virtualScroll
      />
    </Example>
  );
};
```

```css
.FlatSelectExampleVirtualScroll {
  &-List {
    height: 200px;
  }
}
```

</MdxTabs>

### Индикация загрузки

Свойство `isLoading` позволяет показать индикацию загрузки. Если список пуст, то индикация отображается по середине списка, если список не пуст, то индикация отображается внизу списка.

<MdxTabs>

<FlatSelectExampleLoading />

```tsx
type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const itemsEmpty: Item[] = [];

const FlatSelectExampleLoading = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <>
      <FlatSelect
        items={items}
        value={value}
        onChange={setValue}
        isLoading
        bordered
      />
      <FlatSelect
        items={itemsEmpty}
        value={value}
        onChange={setValue}
        isLoading
        bordered
      />
    </>
  );
};
```

</MdxTabs>

### Выбор всех элементов

Свойство `selectAll` позволяет выбирать все варианты. Если будет включена группировка (свойство `groups`), то выбор всех вариантов будет работать только внутри группы.

<MdxTabs>

<FlatSelectExampleSelectAll />

```tsx
type Item = {
  label: string;
  id: number;
  groupId: number;
};

type Group = {
  label: string;
  id: number;
};

const groups: Group[] = [
  {
    id: 1,
    label: 'Первая группа',
  },
  {
    id: 2,
    label: 'Вторая группа',
  },
  {
    id: 3,
    label: 'Третья группа',
  },
];

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
    groupId: 1,
  },
  {
    label: 'Второй',
    id: 2,
    groupId: 2,
  },
  {
    label: 'Третий',
    id: 3,
    groupId: 1,
  },
  {
    label: 'Четвертый',
    id: 4,
    groupId: 3,
  },
  {
    label: 'Пятый',
    id: 5,
    groupId: 2,
  },
];

const FlatSelectExampleSelectAll = () => {
  const [value, setValue] = useState<Item[] | null>();
  return (
    <>
      <FlatSelect
        items={items}
        value={value}
        onChange={setValue}
        multiple
        selectAll
        bordered
      />
      <FlatSelect
        items={items}
        value={value}
        onChange={setValue}
        groups={groups}
        multiple
        selectAll
        bordered
      />
    </>
  );
};
```

</MdxTabs>

### Управление выпадающим списком

Для управления состоянием списка используйте:

- `isOpen` — флаг открытия/закрытия.
- `onOpen` — обработчик открытия/закрытия.
- `ignoreOutsideClicksRefs` — элементы, игнорируемые при клике вне компонента.

<MdxTabs>

<FlatSelectExampleIsOpen />

```tsx
import { IconFunnel } from '@consta/icons/IconFunnel';
import React, { useRef, useState } from 'react';

import { Button } from '@consta/uikit/Button';
import { useSearch } from '@consta/uikit/SelectCanary';

import { FlatSelect, FlatSelectItemDefault } from '@consta/uikit/FlatSelect';

const items: FlatSelectItemDefault[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

export const FlatSelectExampleIsOpen = () => {
  const [value, setValue] = useState<FlatSelectItemDefault | null>();
  const anchorRef = useRef<HTMLButtonElement | null>(null);
  const buttonRef = useRef<HTMLButtonElement | null>(null);
  const [isOpen, setIsOpen] = useState(false);
  return (
    <>
      <Button iconLeft={IconFunnel} ref={anchorRef} />
      <Button
        label="Программный вызов"
        onClick={() => setIsOpen((state) => !state)}
        ref={buttonRef}
      />
      <FlatSelect
        {...useSearch({ items })}
        placeholder="Поиск"
        value={value}
        onChange={setValue}
        anchorRef={anchorRef}
        isOpen={isOpen}
        onOpen={setIsOpen}
        ignoreOutsideClicksRefs={[buttonRef]}
      />
    </>
  );
};
```

</MdxTabs>

## Кастомизация

### Кастомный элемент списка

Свойство `renderItem` позволяет настроить отображение элементов списка через функцию рендера.

<MdxTabs>

<FlatSelectExampleRenderItem />

```tsx
import React, { useState } from 'react';

import { Badge } from '@consta/uikit/Badge';
import { ListItem } from '@consta/uikit//ListCanary';
import { Radio } from '@consta/uikit//Radio';
import { useSearch } from '@consta/uikit//SelectCanary';
import { cnMixSpace } from '@consta/uikit//MixSpace';
import { FlatSelect } from '@consta/uikit/FlatSelect';

type Item = {
  label: string;
  id: number;
  status?: 'repairs' | 'serviceable';
};

const items: Item[] = [
  {
    label: 'Принтер',
    id: 1,
    status: 'repairs',
  },
  {
    label: 'Монитор',
    id: 2,
    status: 'serviceable',
  },
  {
    label: 'Ноутбук',
    id: 3,
    status: 'serviceable',
  },
  {
    label: 'Стол',
    id: 4,
  },
];

const mapLabel = {
  repairs: 'На ремонте',
  serviceable: 'Исправен',
} as const;

const mapStatus = {
  repairs: 'error',
  serviceable: 'success',
} as const;

export const searchCompare = (
  searchValue: string,
  compare?: string,
): boolean => {
  if (!compare) {
    return false;
  }

  return (
    compare.toLocaleLowerCase().indexOf(searchValue.toLocaleLowerCase()) !== -1
  );
};

const searchFunction = (item: Item, searchValue: string): boolean => {
  const searchOfLabel = searchCompare(searchValue, item.label);

  if (searchOfLabel) {
    return searchOfLabel;
  }

  return searchCompare(searchValue, item.status && mapLabel[item.status]);
};

export const FlatSelectExampleRenderItem = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <FlatSelect
      {...useSearch({ items, search: searchFunction })}
      placeholder="Поиск"
      clearButton
      value={value}
      onChange={setValue}
      renderItem={({ item, active, hovered, onClick, onMouseEnter, ref }) => {
        return (
          <ListItem
            aria-selected={active}
            active={hovered}
            role="option"
            aria-hidden="true"
            onMouseEnter={onMouseEnter}
            onClick={onClick}
            ref={ref}
            leftSide={<Radio checked={active} tabIndex={-1} />}
            label={
              <>
                {item.label}
                {item.status && (
                  <Badge
                    className={cnMixSpace({ mL: 'm' })}
                    as="span"
                    size="s"
                    label={mapLabel[item.status]}
                    status={mapStatus[item.status]}
                  />
                )}
              </>
            }
          />
        );
      }}
    />
  );
};
```

</MdxTabs>

### Кастомные типы данных

Для использования кастомных типов данных задайте геттеры: `getItemLabel`, `getItemKey`, `getItemGroupKey`, `getItemDisabled`, `getGroupLabel`, `getGroupKey`.

#### Пример с кастомным Item

```tsx
import React, { useState } from 'react';
import { FlatSelect } from '@consta/uikit/FlatSelect';

function SelectExampleCustomTypes() {
  const [value, setValue] = useState<string | null>();
  return (
    <FlatSelect
      items={['Первый', 'Второй', 'Третий']}
      value={value}
      onChange={setValue}
      getItemKey={(item) => item}
      getItemLabel={(item) => item}
    />
  );
}
```

#### Пример с кастомным Item и Group

```tsx
import React, { useState } from 'react';
import { FlatSelect } from '@consta/uikit/Select';

type Item = {
  name: string;
  group: string;
};

const items: Item[] = [
  { name: 'Первый', group: 'Первая группа' },
  { name: 'Второй', group: 'Третья группа' },
  { name: 'Третий', group: 'Вторая группа' },
  { name: 'Четвертый', group: 'Первая группа' },
  { name: 'Пятый', group: 'Первая группа' },
  { name: 'Шестой', group: 'Третья группа' },
  { name: 'Седьмой', group: 'Первая группа' },
  { name: 'Восьмой', group: 'Вторая группа' },
  { name: 'Девятый', group: 'Третья группа' },
  { name: 'Десятый', group: 'Вторая группа' },
];

const groups: string[] = ['Первая группа', 'Вторая группа', 'Третья группа'];

function SelectExampleCustomTypesWithGroups() {
  const [value, setValue] = useState<Item | null>();
  return (
    <FlatSelect
      items={items}
      groups={groups}
      value={value}
      onChange={setValue}
      getItemKey={(item) => item.name}
      getItemLabel={(item) => item.name}
      getItemGroupKey={(item) => item.group}
      getGroupKey={(group: string) => group}
      getGroupLabel={(group: string) => group}
    />
  );
}
```
