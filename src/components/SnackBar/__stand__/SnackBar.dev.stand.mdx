import { MdxMenu, MdxTabs } from '@consta/stand';
import { SnackBarExampleStatus } from './examples/SnackBarExampleStatus/SnackBarExampleStatus';
import { SnackBarExampleIcon } from './examples/SnackBarExampleIcon/SnackBarExampleIcon';
import { SnackBarExampleTimer } from './examples/SnackBarExampleTimer/SnackBarExampleTimer';
import { SnackBarExampleButtons } from './examples/SnackBarExampleButtons/SnackBarExampleButtons';
import { SnackBarExampleText } from './examples/SnackBarExampleText/SnackBarExampleText';
import { SnackBarExampleAdaptive } from './examples/SnackBarExampleAdaptive/SnackBarExampleAdaptive';
import { SnackBarExampleForm } from './examples/SnackBarExampleForm/SnackBarExampleForm';
import { SnackBarExampleProgress } from './examples/SnackBarExampleProgress/SnackBarExampleProgress';
import { SnackBarExampleGetItemProgress } from './examples/SnackBarExampleGetItemProgress/SnackBarExampleGetItemProgress';

<MdxMenu>

- [Обзор](#обзор)
- [Импорт](#импорт)
- [Свойства](#свойства)
- [Содержимое](#содержимое)
  - [Текст сообщения](#текст-сообщения)
  - [Статус](#статус)
  - [Иконка](#иконка)
  - [Кнопки](#кнопки)
- [Внешний вид](#внешний-вид)
  - [Форма](#форма)
- [Поведение](#поведение)
  - [Возможность закрыть](#возможность-закрыть)
  - [Автоматическое закрытие](#автоматическое-закрытие)
  - [Таймер](#таймер)
  - [Прогресс](#прогресс)
- [Адаптивность](#адаптивность)
- [Пример использования](#пример)

</MdxMenu>

## Обзор

Компонент `SnackBar` используется для отображения уведомлений или кратких сообщений пользователю. Он поддерживает настройку текста, статуса, иконок, кнопок, таймеров и прогресса. Компонент адаптивен и может быть настроен для автоматического закрытия.

## Импорт

```tsx
import { SnackBar } from '@consta/uikit/SnackBar';
```

## Свойства

| Свойство                                        | Тип                               | По умолчанию | Описание                                                        |
| ----------------------------------------------- | --------------------------------- | ------------ | --------------------------------------------------------------- |
| [`items`](#содержимое)                          | `Item[]`                          | -            | Массив элементов                                                |
| `getItemKey?`                                   | `SnackBarPropGetItemKey`          | -            | Функция для получения ключа элемента                            |
| [`form?`](#форма)                               | `'default', 'round', 'brick'`     | `'default'`  | Внешний вид компонента                                          |
| [`getItemMessage?`](#текст-сообщения)           | `SnackBarPropGetItemMessage`      | -            | Функция для получения текста элемента                           |
| [`getItemStatus?`](#статус)                     | `SnackBarPropGetItemStatus`       | -            | Функция для получения статуса элемента                          |
| [`getItemIcon?`](#иконка)                       | `SnackBarPropGetItemIcon`         | -            | Функция для получения иконки для элемента                       |
| [`getItemActions?`](#кнопки)                    | `SnackBarPropGetItemActions`      | -            | Функция для получения дополнительных контролов элемента         |
| [`getItemAutoClose?`](#автоматическое-закрытие) | `SnackBarPropGetItemAutoClose`    | -            | Функция для получения значения таймера элемента                 |
| [`getItemShowProgress?`](#таймер)               | `SnackBarPropGetItemShowProgress` | -            | Функция для получения типа таймера элемента                     |
| [`getItemProgress?`](#прогресс)                 | `SnackBarPropGetItemProgress`     | -            | Функция для получения статуса прогресса                         |
| [`progressView?`](#прогресс)                    | `'spinText', 'spin', 'text'`      | `'spinText'` | Вид отображения прогресса                                       |
| [`getItemOnClose?`](#возможность-закрыть)       | `SnackBarPropGetItemOnClose`      | -            | Функция для получения события закрытия элемента                 |
| `getItemOnAutoClose?`                           | `SnackBarPropGetItemOnAutoClose`  | -            | Функция для получения события автоматического закрытия элемента |
| `onItemClose?`                                  | `(item: Item) => void`            | -            | Функция срабатывает при закрытии элемента                       |
| `onItemAutoClose?`                              | `(item: Item) => void`            | -            | Функция срабатывает при автоматическом закрытии элемента        |
| `className?`                                    | `string`                          | -            | Дополнительный CSS-класс                                        |

## Содержимое

### Текст сообщения

Свойство `message` в объекте `items` задаёт текст сообщения. Можно передавать строку, число или JSX-разметку (`React.ReactNode`), например, ссылку `<a href="#">Ссылка</a>`. Для кастомных типов используйте функцию `getItemMessage`.

<MdxTabs>

<SnackBarExampleText />

```tsx
const items: Item[] = [
  {
    key: 1,
    message: 'Это просто сообщение',
  },
];

export const SnackBarExampleText: React.FC = () => {
  return <SnackBar items={items} getItemMessage={(item) => item.text} />;
};
```

</MdxTabs>

### Статус

Свойство `status` определяет цвет фона или обводки сообщения. Возможные значения: `'success'`, `'warning'`, `'alert'`, `'normal'`. Для кастомных типов используйте функцию `getItemStatus`.

<MdxTabs>

<SnackBarExampleStatus />

```tsx
import { SnackBar } from '@consta/uikit/SnackBar';

type Item = {
  key: string;
  message?: string;
  criticality?: number;
};

const items: Item[] = [
  {
    key: '1',
    message: 'Сообщение — normal',
    criticality: 1,
  },
  {
    key: '2',
    message: 'Ошибка — alert',
    criticality: 3,
  },
  {
    key: '3',
    message: 'Предупреждение — warning',
    criticality: 2,
  },
];

const getStatus = (item: Item) => {
  if (item.criticality === 3) {
    return 'alert';
  }
  if (item.criticality === 2) {
    return 'warning';
  }
  return 'normal';
};

export const SnackBarExampleStatus: React.FC = () => {
  return <SnackBar items={items} getItemStatus={getStatus} />;
};
```

</MdxTabs>

### Иконка

Свойство `icon` позволяет добавить иконку из [библиотеки иконок Consta](##LIBS.LIB/lib:icons). Для кастомных типов используйте функцию `getItemIcon`.

<MdxTabs>

<SnackBarExampleIcon />

```tsx
import { SnackBar } from '@consta/uikit/SnackBar';
import { IconMoon } from '@consta/uikit/icons/IconMoon';
import { IconDisconnection } from '@consta/uikit/icons/IconDisconnection';

type Item = {
  key: string;
  message: string;
  status: 'normal' | 'warning';
};

const items: Item[] = [
  {
    key: '1',
    message: 'Тихо, тигры спят!',
    status: 'normal',
  },
  {
    key: '2',
    message: 'Интернет внезапно кончился',
    status: 'warning',
  },
];

const getIcon = (item: Item) => {
  if (item.status === 'normal') {
    return IconMoon;
  }
  return IconDisconnection;
};

export const SnackBarExampleIcon = () => {
  return <SnackBar items={items} getItemIcon={getIcon} />;
};
```

</MdxTabs>

### Кнопки

Свойство `actions` добавляет кнопки для взаимодействия. Объект `actions` содержит `label` (текст кнопки) и `onClick` (обработчик клика). Для кастомных типов используйте функцию `getItemActions`.

<MdxTabs>

<SnackBarExampleButtons />

```tsx
type Item = {
  key: number;
  message: string;
  buttons?: string[];
};

const items: Item[] = [
  {
    key: 1,
    message: 'С этим сообщением нельзя не согласиться',
    buttons: ['Согласен', 'Не согласен'],
  },
];

const getActions = (buttons?: string[]) => {
  if (Array.isArray(buttons)) {
    return buttons.map((button) => ({
      label: button,
      onClick: () => {
        console.log(button);
      },
    }));
  }
};

export const SnackBarExampleButtons: React.FC = () => {
  return (
    <SnackBar
      items={items}
      getItemActions={(item) => getActions(item.buttons)}
    />
  );
};
```

</MdxTabs>

## Внешний вид

### Форма

Свойство `form` задаёт форму компонента. Возможные значения: `'default'` (скругленные края), `'round'` (круглые края), `'brick'` (прямые края).

<MdxTabs>

<SnackBarExampleForm />

```tsx
<SnackBar items={items} form="default" />
<SnackBar items={items} form="round" />
<SnackBar items={items} form="brick" />
```

</MdxTabs>

## Поведение

### Возможность закрыть

Свойство `onClose` или функция `getItemOnClose` добавляет кнопку-крестик для закрытия снек-бара и задаёт обработчик закрытия.

### Автоматическое закрытие

Свойство `autoClose` или функция `getItemAutoClose` включает автоматическое закрытие сообщения. Можно указать время в секундах (по умолчанию 3 секунды).

### Таймер

Свойство `showProgress` или функция `getItemShowProgress` добавляет таймер, показывающий время до закрытия. Возможные значения: `'timer'` (радиальный таймер), `'line'` (линейный таймер).

<MdxTabs>

<SnackBarExampleTimer />

```tsx
type Item = {
  key: number;
  message: string;
  status: SnackBarItemStatus;
  progressMode?: 'line' | 'timer';
};

const mapIconByStatus: Record<SnackBarItemStatus, IconComponent | undefined> = {
  alert: IconAlert,
  normal: IconRing,
  system: undefined,
  success: undefined,
  warning: undefined,
};

function reducer(
  state: Item[],
  action: { type: 'add' | 'remove'; item: Item },
): Item[] {
  switch (action.type) {
    case 'add':
      return [...state, action.item];
    case 'remove':
      return state.filter((itemInState) => itemInState.key !== action.item.key);
  }
}

const getItemIcon = (item: Item) => mapIconByStatus[item.status];
const getItemShowProgress = (item: Item) => item.progressMode;

export const SnackBarExampleTimer: React.FC = () => {
  const [items, dispatchItems] = useReducer<
    React.Reducer<
      Item[],
      { type: 'add' | 'remove'; item: Item; key?: number | string }
    >
  >(reducer, []);

  const generateHandleAdd =
    (status: SnackBarItemStatus, progressMode?: SnackBarItemShowProgressProp) =>
    () => {
      const key = items.length + 1;
      const item: Item = {
        key,
        message: `Сейчас эта штука закроется ${key}`,
        status,
        progressMode,
      };
      dispatchItems({ type: 'add', item });
    };

  const handleAlertAdd = generateHandleAdd('alert', 'timer');
  const handleNormalAdd = generateHandleAdd('normal', 'timer');
  const handleLineNormalAdd = generateHandleAdd('normal', 'line');
  const handleHiddenTimerAdd = generateHandleAdd('normal');

  React.useEffect(() => handleNormalAdd(), []);

  return (
    <div>
      <div>
        <Button
          className={cnSnackBarExampleTimer('ButtonAdd')}
          iconLeft={IconAdd}
          label="Без таймера + иконка"
          onClick={handleHiddenTimerAdd}
        />
        <Button
          className={cnSnackBarExampleTimer('ButtonAdd')}
          iconLeft={IconAdd}
          label="Обычный таймер"
          onClick={handleNormalAdd}
        />
        <Button
          className={cnSnackBarExampleTimer('ButtonAdd')}
          iconLeft={IconAdd}
          label="Обычный таймер c линией"
          onClick={handleLineNormalAdd}
        />
        <Button
          className={cnSnackBarExampleTimer('ButtonAdd')}
          iconLeft={IconAdd}
          label="Тревожный таймер"
          onClick={handleAlertAdd}
        />
      </div>
      <SnackBar
        className={cnSnackBarExampleTimer('SnackBar')}
        items={items}
        onItemClose={(item) => dispatchItems({ type: 'remove', item })}
        getItemShowProgress={getItemShowProgress}
        getItemIcon={getItemIcon}
        getItemAutoClose={() => 5}
      />
    </div>
  );
};
```

</MdxTabs>

### Прогресс

Свойство `progress` или функция `getItemProgress` отображает прогресс. Свойство `progressView` задаёт вид анимации: `'spin'` (круговая), `'text'` (числовая), `'spinText'` (круговая с числом).

<MdxTabs>

<SnackBarExampleProgress />

```tsx
const items = [
  {
    key: '1',
    message: 'Обработка завершена',
    status: 'success',
    progress: 100,
  },
  {
    key: '2',
    message: 'Обработка данных',
    status: 'system',
    progress: true,
  },
];

export const SnackBarExampleProgress = () => {
  return (
    <Example col={1}>
      <SnackBar items={items} progressView="spinText" />
    </Example>
  );
};
```

</MdxTabs>

<MdxTabs>

<SnackBarExampleGetItemProgress />

```tsx
const items = [
  {
    key: '1',
    message: 'Обработка завершена',
    status: 'success',
    loading: 100,
  },
  {
    key: '2',
    message: 'Обработка данных',
    status: 'system',
    loading: true,
  },
];

export const SnackBarExampleGetItemProgress = () => {
  return (
    <Example col={1}>
      <SnackBar
        items={items}
        getItemProgress={(item) => item.loading}
        progressView="spin"
      />
    </Example>
  );
};
```

</MdxTabs>

## Адаптивность

Компонент автоматически подстраивается под ширину контейнера, с горизонтальными отступами `xs`.

<MdxTabs>

<SnackBarExampleAdaptive />

```tsx
const items = [
  {
    key: '1',
    message: 'Это пример сообщения в контейнере шириной 450 px',
    status: 'normal',
  },
];

return (
  <Card verticalSpace="xs" style={{ maxWidth: 200 }}>
    <SnackBar items={items} />
  </Card>
);
```

</MdxTabs>
