import { MdxMenu, MdxTabs } from '@consta/stand';

import { SelectExampleItems } from './examples/SelectExampleItems/SelectExampleItems';
import { SelectExamplePlaceholder } from './examples/SelectExamplePlaceholder/SelectExamplePlaceholder';
import { SelectExampleDisabledItem } from './examples/SelectExampleDisabledItem/SelectExampleDisabledItem';
import { SelectExampleMultiple } from './examples/SelectExampleMultiple/SelectExampleMultiple';
import { SelectExampleGroups } from './examples/SelectExampleGroups/SelectExampleGroups';
import { SelectExampleClearButton } from './examples/SelectExampleClearButton/SelectExampleClearButton';
import { SelectExampleStatus } from './examples/SelectExampleStatus/SelectExampleStatus';
import { SelectExampleSize } from './examples/SelectExampleSize/SelectExampleSize';
import { SelectExampleView } from './examples/SelectExampleView/SelectExampleView';
import { SelectExampleDisabled } from './examples/SelectExampleDisabled/SelectExampleDisabled';
import { SelectExampleCreate } from './examples/SelectExampleCreate/SelectExampleCreate';
import { SelectExampleSelectAll } from './examples/SelectExampleSelectAll/SelectExampleSelectAll';
import { SelectExampleVirtualScroll } from './examples/SelectExampleVirtualScroll/SelectExampleVirtualScroll';
import { SelectExampleDropdownOpen } from './examples/SelectExampleDropdownOpen/SelectExampleDropdownOpen';
import { SelectExampleOpenByFocus } from './examples/SelectExampleOpenByFocus/SelectExampleOpenByFocus';
import { SelectExampleRenderItem } from './examples/SelectExampleRenderItem/SelectExampleRenderItem';
import { SelectExampleRenderValue } from './examples/SelectExampleRenderValue/SelectExampleRenderValue';
import {
  SelectExampleSearch,
  SelectExampleUseSearch,
} from './examples/SelectExampleSearch/SelectExampleSearch';
import {
  SelectExampleIsLoading,
  SelectExampleIsLoadingOnScrollBottom,
} from './examples/SelectExampleIsLoading/SelectExampleIsLoading';

```tsx
import { Select } from '@consta/uikit/SelectCanary';
```

<MdxMenu>

- [Содержимое](#содержимое-списка)
  - [Варианты](#варианты)
  - [Выбранное значение](#выбранное-значение)
  - [Подсказка](#подсказка)
  - [Заголовок и подпись](#заголовок-и-подпись)
  - [Неактивный вариант](#неактивный-элемент-списка)
  - [Несколько вариантов](#несколько-вариантов)
  - [Группы вариантов](#группы-вариантов)
- [Статус](#статус-поля)
- [Размер](#размер)
- [Форма](#форма)
- [Внешний вид](#внешний-вид)
- [Поиск](#поиск)
- [Виртуализация списка](#виртуализация-списка)
- [Индикация загрузки](#индикация-загрузки)
- [Неактивный выпадающий список](#неактивный-выпадающий-список)
- [Создание новых вариантов](#создание-новых-вариантов)
- [Выбор всех элементов](#выбор-всех-элементов)
- [Управление состоянием выпадающего списка](#управление-состоянием-выпадающего-списка)
- [Кастомизация](#кастомизация)
  - [Кастомный элемент списка](#кастомный-элемент-списка)
  - [Кастомное выбранное значение](#кастомное-выбранное-значение)
  - [Кастомные типы данных для групп и вариантов](#кастомные-типы-данных-для-групп-и-вариантов)
- [Контролируемое значение поля ввода](#контролируемое-значение-поля-ввода)
- [Импорт](#импорт)
- [Список свойств](#свойства)

</MdxMenu>

## Содержимое

### Варианты

Элементы выпадающего списка можно описать в массиве `items`. Тип свойства `items` по умолчанию равен [DefaultItem](#свойства). Что внутри:

- `label` — название элемента списка, лучше писать с заглавной буквы, точка не нужна,
- `id` — уникальный ключ элемента,
- `groupId` — идентификатор [группы](#группы-вариантов), в которую входит этот элемент (если список разбит на группы),
- `disabled` — отмечает [неактивные элементы](#неактивный-элемент-списка).

Вы можете сделать [кастомный тип данных для элементов списка](#кастомный-элемент-списка) и использовать его.

### Выбранное значение

Выбранное значение задаётся в свойстве `value`. Тип свойства `value` по умолчанию равен [DefaultItem](#свойства).

Чтобы получить значение, которое пользователь выбрал из списка, используйте `onChange`. Этот обработчик срабатывает при выборе варианта или при очистке поля ввода
и возвращает значение из массива `items` и событие выбора.

Выбор варианта срабатывает по клику мыши или по нажатию `Enter` на клавиатуре.

<MdxTabs>

```tsx
import { Example } from '@consta/stand';
import React, { useState } from 'react';

import { Select } from '@consta/uikit/SelectCanary';

type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

export const SelectExampleItems = () => {
  const [value, setValue] = useState<Item | null>();
  return <Select items={items} value={value} onChange={setValue} />;
};
```

<SelectExampleItems />

</MdxTabs>

### Подсказка

Подсказка, которая видна, когда ни один вариант не выбран, задаётся в свойстве `placeholder`.
Сформулируйте подсказку так, чтобы стало понятно, что по клику на поле раскроется список вариантов, один из которых нужно выбрать.

Если не знаете, что написать в подсказке, используйте универсальное **Выберите**.

<MdxTabs>

```tsx
<Select {...otherProps} placeholder="Выберите вариант" />
```

<SelectExamplePlaceholder />

</MdxTabs>

### Неактивный элемент списка

Чтобы сделать вариант в списке неактивным, добавьте к элементу массива `items` свойство `disabled: true`. Или используете [кастомный тип `items`](#кастомные-типы-данных-для-групп-и-вариантов).

<MdxTabs>

```tsx
import React, { useState } from 'react';
import { Select } from '@consta/uikit/SelectCanary';

type Item = {
  label: string;
  id: number;
  disabled: boolean;
};

const items: Item[] = [
  {
    label: 'Первый — этот вариант не выбрать',
    id: 1,
    disabled: true,
  },
  {
    label: 'Второй',
    id: 2,
    disabled: false,
  },
  {
    label: 'Третий — и этот тоже не выбрать',
    id: 3,
    disabled: true,
  },
];

export const SelectExampleDisabledItem = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <Select
      placeholder="Выберите вариант"
      items={items}
      value={value}
      onChange={setValue}
    />
  );
};
```

<SelectExampleDisabledItem />

</MdxTabs>

### Несколько вариантов

По умолчанию можно выбрать только один вариант. Чтобы выбрать несколько вариантов, добавьте свойство `multiple`.

> В этом случае `value` становится массивом, а в `onChange` передаётся массив выбранных элементов.

<MdxTabs>

```tsx
import React, { useState } from 'react';
import { Select } from '@consta/uikit/SelectCanary';

type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

export const SelectExampleMultiple = () => {
  const [value, setValue] = useState<Item[] | null>();
  return (
    <Select
      placeholder="Выберите вариант"
      items={items}
      value={value}
      onChange={setValue}
      multiple
    />
  );
```

<SelectExampleMultiple />

</MdxTabs>

### Группы вариантов

Чтобы разбить элементы списка на группы, передайте массив групп в свойство `groups`. Тип свойства `groups` по умолчанию равен [DefaultGroup](#свойства). Что внутри:

- `label` — название группы,
- `id` — уникальный ключ.

<MdxTabs>

```tsx
import { Select } from '@consta/uikit/SelectCanary';

type Item = {
  label: string;
  id: number;
  groupId: number;
};

type Group = {
  label: string;
  id: number;
};

const groups: Group[] = [
  {
    id: 1,
    label: 'Первая группа',
  },
  {
    id: 2,
    label: 'Вторая группа',
  },
  {
    id: 3,
    label: 'Третья группа',
  },
];

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
    groupId: 1,
  },
  {
    label: 'Второй',
    id: 2,
    groupId: 2,
  },
  {
    label: 'Третий',
    id: 3,
    groupId: 1,
  },
  {
    label: 'Четвертый',
    id: 4,
    groupId: 3,
  },
  {
    label: 'Пятый',
    id: 5,
    groupId: 2,
  },
];

export const SelectExampleGroups = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <Select
      placeholder="Выберите вариант"
      items={items}
      value={value}
      onChange={setValue}
      groups={groups}
    />
  );
};
```

<SelectExampleGroups />

</MdxTabs>

### Кнопка очистки поля

Кнопка отвечает за действие очистки `value` и `searchValue`. Для отображения кнопки очистки включите свойство `clearButton`.

<MdxTabs>

```tsx
<Select {...otherProps} clearButton />
```

<SelectExampleClearButton />

</MdxTabs>

## Статус поля

С помощью статуса можно выделить поле: показать, где ошибка, или, наоборот,
отметить правильно заполненные поля.

За статус отвечает свойство `status`. Если оно не указано, поле будет обычным.

<MdxTabs>

```tsx
<Select {...otherProps} status="alert" />
<Select {...otherProps} status="success" />
<Select {...otherProps} status="warning" />
```

<SelectExampleStatus />

</MdxTabs>

## Размер

За размер компонента отвечает свойство `size`. Варианты: `s` , `m` , `l` , по умолчанию `m`.

Компонент занимает всю ширину родительского блока.

<MdxTabs>

```tsx
<Select {...otherProps} size="xs" />
<Select {...otherProps} size="s" />
<Select {...otherProps} size="m" />
<Select {...otherProps} size="l" />
```

<SelectExampleSize />

</MdxTabs>

## Внешний вид

За вид компонента отвечает свойство `view`. Варианты: `default`, `clear`, по умолчанию `default`.

Вид `view="clear"` используется в случаях когда нужно создать кастомное поле ввода или обернуть его в контейнер, в этом случае
поля с разными статусами и разной формы будут выглядит одинаково.

> Для создания hover и focus эффекта для view="`clear`" управляйте внешним видом контейнера, в котором находится Select

<MdxTabs>

```tsx
<Select {...otherProps} view="default" />
<Select {...otherProps} view="clear" />
```

<SelectExampleView />

</MdxTabs>

## Неактивный выпадающий список

Чтобы сделать весь комбобокс неактивным, добавьте `disabled`.

<MdxTabs>

```tsx
<Select {...otherProps} disabled />
```

<SelectExampleDisabled />

</MdxTabs>

## Поиск

Сам компонент не предоставляет функцию поиска, но предоставляет API для его реализации.

Используйте следующие свойства:

- `input` - включение текстового поля
- `onInput` - событие изменения `value` в текстовом поле
- `labelForEmptyItems` - текст который будет показан в случае отсутствия

Такое API предоставляет не только сортировку списка, а абсолютно любые операции.

### Пример с фильтрацией по каждому введенному слову и сортировкой по весам.

<MdxTabs>

```tsx
import { useMemo, useState } from 'react';
import { Select } from '@consta/uikit/SelectCanary';

const list: ListItem[] = [
  {
    firstName: 'Илья',
    lastName: 'Васильев',
    role: 'Руководитель',
    id: 1,
  },
  {
    firstName: 'Михаил',
    lastName: 'Гусев',
    role: 'Разработчик',
    id: 2,
  },
  {
    firstName: 'Василий',
    lastName: 'Жмых',
    role: 'Дизайнер',
    id: 3,
  },
  {
    firstName: 'Василий',
    lastName: 'Белый',
    role: 'Разработчик',
    id: 4,
  },
];

const getItemLabel: SelectPropGetItemLabel<ListItem> = ({
  lastName,
  firstName,
}) => `${firstName} ${lastName}`;

const isSubstring = (string: string, substring: string) =>
  string.toLocaleLowerCase().indexOf(substring.toLocaleLowerCase()) !== -1;

export const SelectExampleSearch = () => {
  const [value, setValue] = useState<ListItem | null>();
  const [searchValue, setSearchValue] = useState('');
  const setSearchValueDebounce = useDebounce(setSearchValue, 300);

  const items = useMemo(() => {
    const searchWords = searchValue.trim().split(' ');
    const propsToSearch = ['firstName', 'lastName', 'role'] as const;
    const weights: Record<number, number> = {};

    for (let index = 0; index < list.length; index++) {
      const item = list[index];
      let weight = 0;

      for (let index = 0; index < searchWords.length; index++) {
        const word = searchWords[index].toLocaleLowerCase();

        for (let index = 0; index < propsToSearch.length; index++) {
          if (isSubstring(item[propsToSearch[index]], word)) {
            weight++;
          }
        }
      }

      weights[item.id] = weight;
    }

    return list
      .filter((item) => weights[item.id])
      .sort((a, b) => weights[b.id] - weights[a.id]);
  }, [searchValue]);

  return (
    <Select
      items={items}
      getItemLabel={getItemLabel}
      placeholder="Выберите вариант"
      value={value}
      onChange={setValue}
      clearButton
      onInput={setSearchValueDebounce}
      input
    />
  );
};
```

<SelectExampleSearch />

</MdxTabs>

### useSearch

Если необходимо только фильтрация список то можете воспользоваться хуком `useSearch`. По умолчанию фильтрация происходит по свойству `label` вхождением строки.

| Свойство            | Тип или варианты значения                       | По умолчанию   | Описание                               |
| ------------------- | ----------------------------------------------- | -------------- | -------------------------------------- |
| `items`             | `ITEM[]`                                        | -              | Элементы для поиска                    |
| `search?`           | `(item: ITEM, searchValue: string) => boolean;` | функция        | Функция поиска                         |
| `labelForNotFound?` | `string`                                        | `'Не найдено'` | Сообщение при пустом результате поиска |
| `debounceTimeOut?`  | `number`                                        | `200`          | Задержка фильтрации                    |

<MdxTabs>

```tsx
import { Select, useSearch } from '@consta/uikit/SelectCanary';

type Item = {
  label: string;
  id: number | string;
};

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
  {
    label: 'Четвертый',
    id: 4,
  },
  {
    label: 'Пятый',
    id: 5,
  },
];

export const SelectExampleSearch = () => {
  const [value, setValue] = useState<Item | null>();

  return (
    <Select
      {...useSearch({ items })}
      placeholder="Выберите вариант"
      value={value}
      onChange={setValue}
      clearButton
    />
  );
};
```

<SelectExampleUseSearch />

</MdxTabs>

## Создание новых вариантов

Используйте свойство `onCreate` для возможности создавать элементы. В функцию на вход придёт `label` созданного элемента.

<MdxTabs>

```tsx
import React, { useState, useCallback } from 'react';
import { Select, useSearch } from '@consta/uikit/Select';

const getItemLabel = (item: string) => item;

export function SelectExampleCreate() {
  const [value, setValue] = useState<string | null>();
  const [list, setList] = useState<string[]>(['Первый', 'Второй', 'Третий']);
  const { items, labelForEmptyItems, onInput } = useSearch({
    items: list,
    search: getSearchFunctionDefault(getItemLabel),
  });
  const onCreate = useCallback(
    (label: string) => setList((state) => [label, ...state]),
    [],
  );

  return (
    <Example col={1}>
      <Select
        placeholder="Выберите вариант"
        items={items}
        value={value}
        onChange={setValue}
        getItemLabel={getItemLabel}
        getItemKey={getItemLabel}
        onCreate={!items.length ? onCreate : undefined}
        labelForEmptyItems={labelForEmptyItems}
        onInput={onInput}
        input
      />
    </Example>
  );
}
```

<SelectExampleCreate />

</MdxTabs>

## Виртуализация списка

Если список элементов очень большой, то стоит использовать виртуализацию скролла.

<MdxTabs>

```tsx
import { FieldArrayValueItem } from '@consta/uikit/FieldComponents';

import { Select } from '@consta/uikit/SelectCanary';

type Item = {
  label: string;
  id: number;
  groupId: number;
};

type Group = {
  label: string;
  id: number;
};

const items: Item[] = new Array(1000).fill(null).map((_, i) => ({
  label: `Опция ${i + 1}`,
  groupId: Math.floor(i / 100) + 1,
  id: i,
}));

const groups: Group[] = new Array(items.length / 100)
  .fill(null)
  .map((_, i) => ({
    id: i + 1,
    label: `Группа ${i + 1}`,
  }));

export const SelectExampleVirtualScroll = () => {
  const [value, setValue] = useState<Item[] | null>();

  return (
    <Select
      placeholder="Чтобы посмотреть весь список, прокрутите вниз"
      items={items}
      value={value}
      onChange={setValue}
      groups={groups}
      multiple
      selectAll
      virtualScroll
      renderValue={({ value, getRemove }) => {
        if (value.length >= 200)
          return (
            <div
              style={{
                height: 'var(--field-array-value-inline-control-input-height)',
                lineHeight:
                  'var(--field-array-value-inline-control-input-height)',
              }}
            >{`Выбрано ${value.length} элементов`}</div>
          );
        return value.map((item) => (
          <FieldArrayValueItem
            key={item.id}
            size="m"
            label={item.label}
            onRemove={getRemove(item)}
          />
        ));
      }}
    />
  );
};
```

<SelectExampleVirtualScroll />

</MdxTabs>

## Индикация загрузки

Для отображения индикации загрузки укажите параметр `isLoading`

<MdxTabs>

```tsx
export const SelectExampleIsLoading = () => {
  const [value, setValue] = useState<Item[] | null>();

  return (
    <Example col={1}>
      <Select
        placeholder="Кликните по полю ввода"
        items={[]}
        value={value}
        onChange={setValue}
        multiple
        isLoading
      />
    </Example>
  );
};
```

<SelectExampleIsLoading />

</MdxTabs>

Пример ниже показывает как можно дозагружать данные при прокрутке до конца списка.

<MdxTabs>

```tsx
type Item = {
  label: string;
  id: number;
};

const useMockLoadData = (
  searchValue = '',
  timeout = 2000,
): [Item[], boolean, () => void] => {
  const [isLoading, setIsLoading] = useFlag();
  const [isStart, setIsStart] = useFlag();
  const [length, setLength] = useState<number>(0);
  const isLoadingOffDebounce = useDebounce(setIsLoading.off, 2000);

  const items = useMemo(() => {
    if (searchValue) {
      return new Array(10000)
        .fill(null)
        .map((_, i) => ({
          label: `Опция ${i + 1}`,
          id: i,
        }))
        .filter(
          (item) =>
            item.label
              .toLocaleLowerCase()
              .indexOf(searchValue.toLocaleLowerCase()) !== -1,
        );
    }
    return new Array(length).fill(null).map((_, i) => ({
      label: `Опция ${i + 1}`,
      id: i,
    }));
  }, [length, searchValue]);

  useEffect(() => {
    setIsLoading.on();
    isLoadingOffDebounce();
  }, [searchValue]);

  useEffect(() => {
    if (isStart) {
      setIsLoading.on();
    }

    const timeoutNumber = setTimeout(() => {
      if (isStart) {
        setLength((state) => state + 100);
        setIsLoading.off();
        setIsStart.off();
      }
    }, timeout);

    return () => {
      clearTimeout(timeoutNumber);
    };
  }, [isStart]);

  useEffect(() => {
    return () => {
      setIsLoading.off();
      setIsStart.off();
    };
  }, []);

  return [searchValue && isLoading ? [] : items, isLoading, setIsStart.on];
};

const SelectExampleIsLoadingOnScrollBottom = () => {
  const [value, setValue] = useState<Item[] | null>();
  const [searchValue, setSearchValue] = useState<string>('');
  const [data, isLoading, load] = useMockLoadData(searchValue);

  return (
    <Select
      placeholder="Кликните по полю ввода, чтобы данные загрузились"
      items={data}
      value={value}
      onChange={setValue}
      multiple
      isLoading={isLoading}
      virtualScroll
      onScrollToBottom={searchValue ? undefined : load}
      searchFunction={() => true}
      onSearchValueChange={setSearchValue}
    />
  );
};
```

<SelectExampleIsLoadingOnScrollBottom />

</MdxTabs>

## Выбор всех элементов

Для того чтобы выбрать все элементы в группе, если группы определены, или все элементы в целом, необходимо определить флаг `selectAll`.

> Чтобы переопределить текст выводимый при выборе все элементов укажите свойство `allSelectedAllLabel`.

<MdxTabs>

```tsx
import React, { useState } from 'react';
import { Select } from '@consta/uikit/Select';

type Item = {
  label: string;
  id: number;
  groupId: number;
};

type Group = {
  label: string;
  id: number;
};

const groups: Group[] = [
  {
    id: 1,
    label: 'Первая группа',
  },
  {
    id: 2,
    label: 'Вторая группа',
  },
  {
    id: 3,
    label: 'Третья группа',
  },
];

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
    groupId: 1,
  },
  {
    label: 'Второй',
    id: 2,
    groupId: 2,
  },
  {
    label: 'Третий',
    id: 3,
    groupId: 1,
  },
  {
    label: 'Четвертый',
    id: 4,
    groupId: 3,
  },
  {
    label: 'Пятый',
    id: 5,
    groupId: 2,
  },
];

const SelectExampleSelectAll = () => {
  const [value, setValue] = useState<Item[] | null>();
  return (
    <Select
      placeholder="Выберите варианты"
      items={items}
      value={value}
      multiple
      selectAll
      allSelectedAllLabel="Все варианты"
      onChange={setValue}
      groups={groups}
    />
  );
};
```

<SelectExampleSelectAll />

</MdxTabs>

## Управление состоянием выпадающего списка

Для управлением состояния выпадающего списка используйте следующие свойства:

- `dropdownOpen` - флаг открыт/закрыт
- `onDropdownOpen` - Колбэк отрабатывающий каждый раз при открытии/закрытии
- `ignoreOutsideClicksRefs` - список ссылок на элементы по которым игнорируется клики

### Пример с раскрытием списка по кнопке

<MdxTabs>

```tsx
type Item = {
  label: string;
  id: number | string;
};

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

const Icon = withAnimateSwitcherHOC({
  startIcon: IconArrowDown,
  startDirection: 0,
  endDirection: 180,
});

const SelectExampleDropdownOpen = () => {
  const [value, setValue] = useState<Item | null>();
  const [open, setOpen] = useFlag();
  const buttonRef = useRef<HTMLButtonElement>(null);
  const inputRef = useRef<HTMLInputElement>(null);
  const onDropdownOpen = useCallback((open: boolean) => {
    setOpen.set(open);
    if (open) {
      inputRef.current?.focus();
    }
  }, []);

  return (
    <AnimateIconSwitcherProvider active={open}>
      <FieldGroup>
        <Button
          ref={buttonRef}
          label={open ? 'Закрыть' : 'Открыть'}
          onClick={setOpen.toggle}
          iconLeft={Icon}
          onlyIcon
        />
        <Select
          inputRef={inputRef}
          placeholder="Выберите вариант"
          items={items}
          value={value}
          onChange={setValue}
          dropdownOpen={open}
          onDropdownOpen={onDropdownOpen}
          ignoreOutsideClicksRefs={[buttonRef]}
        />
      </FieldGroup>
    </AnimateIconSwitcherProvider>
  );
};
```

<SelectExampleDropdownOpen />

</MdxTabs>

### Пример с раскрытием списка по фокусу

<MdxTabs>

```tsx
type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

export function SelectExampleOpenByFocus() {
  const [value, setValue] = useState<Item | null>();
  const [isOpened, setIsOpened] = useFlag();
  const inputRef = useRef<HTMLInputElement>(null);

  const handleFocus = () => {
    inputRef.current?.focus();
  };

  // Запрещаем всплытие клика c input, чтобы предотвратить рассинхронизацию isOpened
  // с внутренним состоянием раскрытия списка. Так как клик по компоненту переключает состояние скрыт/раскрыт,
  // нам при фокусе требуется не переключение (toggle), а включение (setTrue)
  useEffect(() => {
    if (inputRef.current) {
      inputRef.current.onclick = (e) => e.stopPropagation();
    }
  }, [inputRef.current]);

  return (
    <Example col={1}>
      <Button onClick={handleFocus} label="Эмулировать фокус на элемент" />
      <Select
        inputRef={inputRef}
        items={items}
        value={value}
        onChange={setValue}
        placeholder="Выберите элемент"
        dropdownOpen={isOpened}
        onDropdownOpen={setIsOpened.set}
        onFocus={setIsOpened.on}
      />
    </Example>
  );
}
```

<SelectExampleOpenByFocus />

</MdxTabs>

## Кастомизация

### Кастомный элемент списка

Чтобы создать свое представление элементов списка, используйте свойство `renderItem`.
Свойство принимает [функцию рендера](https://reactjs.org/docs/render-props.html).

#### Пример с кастомным элементом списка и своей функцией поиска

<MdxTabs>

```tsx
import React, { useState } from 'react';
import { Badge } from '@consta/uikit/Badge';
import { Select } from '@consta/uikit/Select';

import { cn } from '@bem-react/classname';

import './SelectExampleRenderItem.css';

import { Example } from '@consta/stand';
import React, { useState } from 'react';

import { Badge } from '##/components/Badge';
import { Select } from '##/components/SelectCanary';
import { cn } from '##/utils/bem';

const cnSelectExampleRenderItem = cn('SelectExampleRenderItem');

type Item = {
  label: string;
  id: number;
  status?: 'repairs' | 'serviceable';
};

const items: Item[] = [
  {
    label: 'Принтер',
    id: 1,
    status: 'repairs',
  },
  {
    label: 'Монитор',
    id: 2,
    status: 'serviceable',
  },
  {
    label: 'Ноутбук',
    id: 3,
    status: 'serviceable',
  },
  {
    label: 'Стол',
    id: 4,
  },
];

const mapLabel = {
  repairs: 'На ремонте',
  serviceable: 'Исправен',
} as const;

const mapStatus = {
  repairs: 'error',
  serviceable: 'success',
} as const;

const searchCompare = (searchValue: string, compare?: string): boolean => {
  if (!compare) {
    return false;
  }

  return (
    compare.toLocaleLowerCase().indexOf(searchValue.toLocaleLowerCase()) !== -1
  );
};

const searchFunction = (item: Item, searchValue: string): boolean => {
  const searchOfLabel = searchCompare(searchValue, item.label);

  if (searchOfLabel) {
    return searchOfLabel;
  }

  return searchCompare(searchValue, item.status && mapLabel[item.status]);
};

function SelectExampleRenderItem() {
  const [value, setValue] = useState<Item | null>();
  return (
    <Select
      {...useSearch({ items, search: searchFunction })}
      placeholder="Выберите вариант"
      clearButton
      value={value}
      onChange={setValue}
      renderItem={({ item, active, hovered, onClick, onMouseEnter, ref }) => (
        <div
          className={cnSelectExampleRenderItem('Item', { active, hovered })}
          aria-selected={active}
          aria-hidden="true"
          onMouseEnter={onMouseEnter}
          onClick={onClick}
          ref={ref}
        >
          {item.label}
          {item.status && (
            <Badge
              className={cnSelectExampleRenderItem('Badge')}
              as="span"
              size="s"
              label={mapLabel[item.status]}
              status={mapStatus[item.status]}
            />
          )}
        </div>
      )}
    />
  );
}
```

<SelectExampleRenderItem />

</MdxTabs>

### Кастомное выбранное значение

Чтобы создать кастомное выбранное значение, используйте свойство `renderValue`.
Свойство принимает [функцию рендера](https://reactjs.org/docs/render-props.html).

<MdxTabs>

```tsx
import React, { useState } from 'react';
import { Select } from '@consta/uikit/Select';

type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  {
    label: 'Первый',
    id: 1,
  },
  {
    label: 'Второй',
    id: 2,
  },
  {
    label: 'Третий',
    id: 3,
  },
];

function SelectExampleRenderValue() {
  const [value, setValue] = useState<Item | null>();
  return (
    <Select
      placeholder="Выберите вариант"
      items={items}
      value={value}
      onChange={setValue}
      renderValue={({ value }) => (
        <div>
          <span role="img" aria-label="Panda">
            🐼
          </span>{' '}
          — {value.label}
        </div>
      )}
    />
  );
}
```

<SelectExampleRenderValue />

</MdxTabs>

### Кастомные типы данных для групп и вариантов

Вы можете использовать кастомные типы данных для элементов списка (items) и групп (groups) — они могут отличаться от [DefaultItem](#свойства) и [DefaultGroup](#свойства).

В этом случае нужно использовать геттеры `getItemLabel`, `getItemKey`, `getItemGroupKey`, `getItemDisabled`, `getGroupLabel`, `getGroupKey`, чтобы компонент понимал, откуда брать данные.

#### Геттеры по умолчанию

```ts
const defaultGetItemKey = (item) => item.id;
const defaultGetItemLabel = (item) => item.label;
const defaultGetItemGroupKey = (item) => item.groupId;
const defaultGetItemDisabled = (item) => item.disabled;
const defaultGetGroupKey = (group) => group.id;
const defaultGetGroupLabel = (group) => group.label;
```

#### Пример с кастомным Item

```tsx
import React, { useState } from 'react';
import { Select } from '@consta/uikit/Select';

function SelectExampleCustomTypes() {
  const [value, setValue] = useState<string | null>();
  return (
    <Select
      placeholder="Выберите вариант"
      items={['Первый', 'Второй', 'Третий']}
      value={value}
      onChange={setValue}
      getItemKey={(item) => item}
      getItemLabel={(item) => item}
    />
  );
}
```

{/* <SelectExampleCustomTypes /> */}

#### Пример с кастомным Item и Group

```tsx
import React, { useState } from 'react';
import { Select } from '@consta/uikit/Select';

type Item = {
  name: string;
  group: string;
};

const items: Item[] = [
  { name: 'Первый', group: 'Первая группа' },
  { name: 'Второй', group: 'Третья группа' },
  { name: 'Третий', group: 'Вторая группа' },
  { name: 'Четвертый', group: 'Первая группа' },
  { name: 'Пятый', group: 'Первая группа' },
  { name: 'Шестой', group: 'Третья группа' },
  { name: 'Седьмой', group: 'Первая группа' },
  { name: 'Восьмой', group: 'Вторая группа' },
  { name: 'Девятый', group: 'Третья группа' },
  { name: 'Десятый', group: 'Вторая группа' },
];

const groups: string[] = ['Первая группа', 'Вторая группа', 'Третья группа'];

function SelectExampleCustomTypesWithGroups() {
  const [value, setValue] = useState<Item | null>();
  return (
    <Select
      placeholder="Выберите вариант"
      items={items}
      groups={groups}
      value={value}
      onChange={setValue}
      getItemKey={(item) => item.name}
      getItemLabel={(item) => item.name}
      getItemGroupKey={(item) => item.group}
      getGroupKey={(group: string) => group}
      getGroupLabel={(group: string) => group}
    />
  );
}
```

{/* <SelectExampleCustomTypesWithGroups /> */}

## Контролируемое значение поля ввода

Для того, чтобы программным путем изменить значение поля ввода, используйте `searchValue`.

```tsx
function SelectExampleSearchValue() {
  const [value, setValue] = useState<Item[] | null>();
  const [searchValue, setSearchValue] = useState<string | undefined>();

  return (
    <>
      <Select
        className={cnMixSpace({ mB: 'm' })}
        placeholder="Выберите вариант"
        items={items}
        value={value}
        onChange={setValue}
        searchValue={searchValue}
        onSearchValueChange={setSearchValue}
        multiple
      />
      <Button
        className={cnMixSpace({ mR: 'm' })}
        label="Второй"
        onClick={() => setSearchValue('Второй')}
      />
      <Button
        className={cnMixSpace({ mR: 'm' })}
        label="Первый"
        onClick={() => setSearchValue('Первый')}
      />
      <Button label="Очистить" onClick={() => setSearchValue(undefined)} />
    </>
  );
}
```

{/* <SelectExampleSearchValue /> */}

## Импорт

```tsx
import { Select } from '@consta/uikit/Select';
```

## Свойства

```tsx
type SelectItemDefault = {
  label: string;
  id: string | number;
  groupId?: string | number;
  disabled?: boolean;
};

type SelectGroupDefault = {
  label: string;
  id: string | number;
};

type SelectPropOnChange<ITEM, MULTIPLE extends boolean> = (
  value: (MULTIPLE extends true ? ITEM[] : ITEM) | null,
  props: {
    e: React.SyntheticEvent;
  },
) => void;

type SelectPropRenderItem<ITEM = DefaultItem> = (props: {
  item: ITEM;
  active: boolean;
  hovered: boolean;
  onClick: React.ReactEventHandler;
  onMouseEnter: React.ReactEventHandler;
}) => React.ReactElement | null;

type SelectPropValue<ITEM, MULTIPLE extends boolean> =
  | (MULTIPLE extends true ? ITEM[] : ITEM)
  | null
  | undefined;

type SelectPropRenderValue<ITEM> = (props: {
  item: ITEM;
}) => React.ReactElement | null;

type SelectPropSearchFunction<ITEM> = (
  item: ITEM,
  searchValue: string,
) => boolean;

type SelectPropGetItemLabel<ITEM> = (item: ITEM) => string;
type SelectPropGetItemKey<ITEM> = (item: ITEM) => string | number;
type SelectPropGetItemGroupKey<ITEM> = (
  item: ITEM,
) => string | number | undefined;
type SelectPropGetItemDisabled<ITEM> = (item: ITEM) => boolean | undefined;
type SelectPropGetGroupKey<GROUP> = (group: GROUP) => string | number;
type SelectPropGetGroupLabel<GROUP> = (group: GROUP) => string;

type SelectPropOnCreate = (
  label: string,
  props: { e: React.SyntheticEvent },
) => void;
```

| Свойство                                                                | Тип или варианты значения                              | По умолчанию                                                  | Описание                                                                              |
| ----------------------------------------------------------------------- | ------------------------------------------------------ | ------------------------------------------------------------- | ------------------------------------------------------------------------------------- |
| [`view?`](#внешний-вид)                                                 | `default` , `clear`                                    | `default`                                                     | Внешний вид компонента                                                                |
| [`disabled?`](#отключение-поля-ввода)                                   | `boolean`                                              | -                                                             | Делает компонент недоступным                                                          |
| [`status?`](#статус-поля)                                               | `'', 'alert', 'success', 'warning'`                    | `' '`                                                         | Тип поля                                                                              |
| [`size?`](#размер)                                                      | `'xs'`, `'s'` , `'m'` , `'l'`                          | `'m'`                                                         | Размер компонента                                                                     |
| [`form?`](#форма)                                                       | `default`, `brick`, `round`                            | `default`                                                     | Форма компонента                                                                      |
| [`placeholder?`](#подсказка)                                            | `string`                                               | -                                                             | Подсказка, отображается, когда вариант не выбран                                      |
| [`label?`](#лейбл-и-подпись)                                            | `string`                                               | -                                                             | Лейбл                                                                                 |
| [`labelIcon?`](#лейбл-и-подпись)                                        | `IconComponent`                                        | -                                                             | Иконка справа от лейбла                                                               |
| [`labelPosition?`](#лейбл-и-подпись)                                    | `'top', 'left'`                                        | `'top'`                                                       | Положение лейбла                                                                      |
| [`caption?`](#лейбл-и-подпись)                                          | `string`                                               | -                                                             | Подпись                                                                               |
| [`items`](#варианты)                                                    | `ITEM[]`                                               | -                                                             | Варианты                                                                              |
| [`value?`](#значение)                                                   | `SelectPropValue<ITEM,MULTIPLE>`                       | -                                                             | Значение селекта                                                                      |
| [`onChange?`](#onchange)                                                | `SelectPropOnChange<ITEM,MULTIPLE>`                    | -                                                             | Событие связанное с изменением значения компонента                                    |
| [`multiple?`](#множественный-выбор)                                     | `boolean`                                              | `false`                                                       | Указатель множественного выбора                                                       |
| [`groups?`](#группировка-списка)                                        | `GROUP[]`                                              | -                                                             | Группы                                                                                |
| [`onSearchValueChange?`](#поиск)                                        | `(value: string) => void`                              | -                                                             | Функция для получения значения строки поиска                                          |
| [`searchFunction?`](#поиск)                                             | `SelectPropSearchFunction<ITEM>`                       | поиск по `label` элементов, `label` получен из `getItemLabel` | Функция поиска                                                                        |
| [`renderItem?`](#свое-представление-элемента-списка)                    | `SelectPropRenderItem<ITEM>`                           | рендер по умолчанию                                           | Рендер-функция для элемента списка                                                    |
| [`renderValue?`](#свое-представление-выбранного-значения)               | `SelectPropRenderValue<ITEM>`                          | рендер по умолчанию                                           | Рендер-функция для элемента значения                                                  |
| [`getItemLabel?`](#свои-тип-данных-items-и-groups)                      | `SelectPropGetItemLabel<ITEM>`                         | `(item) => item.label`                                        | Функция для определения названия элемента                                             |
| [`getItemKey?`](#свои-тип-данных-items-и-groups)                        | `SelectPropGetItemKey<ITEM>`                           | `(item) => item.id`                                           | Функция для определения уникального ключа элемента                                    |
| [`getItemGroupKey?`](#свои-тип-данных-items-и-groups)                   | `SelectPropGetItemGroupKey<ITEM>`                      | `(item) => item.groupId`                                      | Функция для определения ключа группы, к которой будет привязан элемент                |
| [`getItemDisabled?`](#свои-тип-данных-items-и-groups)                   | `SelectPropGetItemDisabled<ITEM>`                      | `(item) => item.disabled`                                     | Функция для определения состояния `disabled`                                          |
| [`getGroupLabel?`](#свои-тип-данных-items-и-groups)                     | `SelectPropGetGroupKey<GROUP>`                         | `(group) => group.id`                                         | Функция для определения названия группы                                               |
| [`getGroupKey?`](#свои-тип-данных-items-и-groups)                       | `SelectPropGetGroupLabel<GROUP>`                       | `(group) => group.label`                                      | Функция для определения уникального ключа группы                                      |
| [`isLoading?`](#индикация-загрузки)                                     | `boolean`                                              | -                                                             | При `true` будет отображаться индикатор загрузки                                      |
| `required?`                                                             | `boolean`                                              | -                                                             | Нужно заполнить                                                                       |
| `searchValue?`                                                          | `string`                                               | -                                                             | Значение поля ввода                                                                   |
| `labelForEmptyItems?`                                                   | `string`                                               | `Список пуст`                                                 | Текст, который нужно показать, если в списке нет значений                             |
| [`labelForNotFound?`](#поиск)                                           | `string`                                               | `Не найдено`                                                  | Текст, который нужно показать, если при поиске ничего не нашлось                      |
| [`labelForCreate?`](#создание-новых-вариантов)                          | `string`                                               | `+`                                                           | Текст для кнопки, по которой можно добавить элемент в список                          |
| [`selectAll?`](#выбор-всех-элементов)                                   | `boolean`                                              | `false`                                                       | Добавляет пункт списка с возможностью выбора всех элементов                           |
| [`allSelectedAllLabel?`](#выбор-всех-элементов)                         | `string`                                               | `Все`                                                         | Текст отображаемый при выборе всех элементов (работает только при `selectAll="true"`) |
| `onBlur?`                                                               | `(event?: React.FocusEvent<HTMLInputElement>) => void` | -                                                             | Обработчик события `blur`                                                             |
| `onFocus?`                                                              | `(event?: React.FocusEvent<HTMLInputElement>) => void` | -                                                             | Обработчик события `focus`                                                            |
| `onCreate?`                                                             | `SelectPropOnCreate`                                   | -                                                             | Событие по клику на кнопку 'Создать'                                                  |
| `onScrollToBottom?`                                                     | `(length: number) => void`                             | -                                                             | Событие срабатывает когда прокрутили список до конца                                  |
| `onSearchValueChange?`                                                  | `(value: string) => void;`                             | -                                                             | Событие срабатывает при изменении значения поиска                                     |
| `virtualScroll?`                                                        | `boolean`                                              | -                                                             | Включает виртуализацию скролла                                                        |
| `ariaLabel?`                                                            | `string`                                               | -                                                             | `aria` атрибут для поля ввода                                                         |
| `name?`                                                                 | `string`                                               | -                                                             | Имя поля ввода                                                                        |
| `className?`                                                            | `string`                                               | -                                                             | Дополнительный CSS-класс                                                              |
| `dropdownClassName?`                                                    | `string`                                               | -                                                             | Дополнительный CSS-класс для выпадающего блока                                        |
| [`onDropdownOpen?`](#управление-состоянием-выпадающего-списка)          | `(open: boolean) => void;`                             | -                                                             | Событие срабатывает при открытии списка                                               |
| [`dropdownOpen?` ](#управление-состоянием-выпадающего-списка)           | `boolean`                                              | -                                                             | Состояние открыт/закрыт выпадающего списка                                            |
| [`ignoreOutsideClicksRefs?`](#управление-состоянием-выпадающего-списка) | `ReadonlyArray<React.RefObject<HTMLElement>>`          | -                                                             | Ссылки на элементы с которые нужно игнорировать при кликах вне компонента             |
| `ref?`                                                                  | `React.Ref<HTMLDivElement>`                            | -                                                             | Ссылка на корневой DOM-элемент компонента                                             |
