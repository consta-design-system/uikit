import { MdxMenu, MdxTabs } from '@consta/stand';

import { SelectExampleItems } from './examples/SelectExampleItems/SelectExampleItems';
import { SelectExamplePlaceholder } from './examples/SelectExamplePlaceholder/SelectExamplePlaceholder';
import { SelectExampleDisabledItem } from './examples/SelectExampleDisabledItem/SelectExampleDisabledItem';
import { SelectExampleMultiple } from './examples/SelectExampleMultiple/SelectExampleMultiple';
import { SelectExampleGroups } from './examples/SelectExampleGroups/SelectExampleGroups';
import { SelectExampleClearButton } from './examples/SelectExampleClearButton/SelectExampleClearButton';
import { SelectExampleStatus } from './examples/SelectExampleStatus/SelectExampleStatus';
import { SelectExampleSize } from './examples/SelectExampleSize/SelectExampleSize';
import { SelectExampleView } from './examples/SelectExampleView/SelectExampleView';
import { SelectExampleDisabled } from './examples/SelectExampleDisabled/SelectExampleDisabled';
import { SelectExampleCreate } from './examples/SelectExampleCreate/SelectExampleCreate';
import { SelectExampleSelectAll } from './examples/SelectExampleSelectAll/SelectExampleSelectAll';
import { SelectExampleVirtualScroll } from './examples/SelectExampleVirtualScroll/SelectExampleVirtualScroll';
import { SelectExampleDropdownOpen } from './examples/SelectExampleDropdownOpen/SelectExampleDropdownOpen';
import { SelectExampleOpenByFocus } from './examples/SelectExampleOpenByFocus/SelectExampleOpenByFocus';
import { SelectExampleRenderItem } from './examples/SelectExampleRenderItem/SelectExampleRenderItem';
import { SelectExampleRenderValue } from './examples/SelectExampleRenderValue/SelectExampleRenderValue';
import {
  SelectExampleSearch,
  SelectExampleUseSearch,
} from './examples/SelectExampleSearch/SelectExampleSearch';
import {
  SelectExampleIsLoading,
  SelectExampleIsLoadingOnScrollBottom,
} from './examples/SelectExampleIsLoading/SelectExampleIsLoading';

<MdxMenu>

- [Обзор](#обзор)
- [Импорт](#импорт)
- [Свойства](#свойства)
- [Содержимое](#содержимое)
  - [Варианты](#варианты)
  - [Выбранное значение](#выбранное-значение)
  - [Подсказка](#подсказка)
  - [Неактивный элемент списка](#неактивный-элемент-списка)
  - [Множественный выбор](#множественный-выбор)
  - [Группы вариантов](#группы-вариантов)
  - [Кнопка очистки поля](#кнопка-очистки-поля)
- [Внешний вид](#внешний-вид)
  - [Размер](#размер)
  - [Стиль](#стиль)
  - [Форма](#форма)
  - [Статус](#статус)
- [Поведение](#поведение)
  - [Неактивный компонент](#неактивный-компонент)
  - [Поиск](#поиск)
  - [Создание новых вариантов](#создание-новых-вариантов)
  - [Виртуализация списка](#виртуализация-списка)
  - [Индикация загрузки](#индикация-загрузки)
  - [Выбор всех элементов](#выбор-всех-элементов)
  - [Управление состоянием выпадающего списка](#управление-состоянием-выпадающего-списка)
- [Кастомизация](#кастомизация)
  - [Кастомный элемент списка](#кастомный-элемент-списка)
  - [Кастомное выбранное значение](#кастомное-выбранное-значение)
  - [Кастомные типы данных](#кастомные-типы-данных)

</MdxMenu>

## Обзор

Компонент `Select` предоставляет выпадающий список для выбора одного или нескольких вариантов. Поддерживает кастомизацию, группировку, поиск, виртуализацию и другие функции.

## Импорт

```tsx
import { Select } from '@consta/uikit/SelectCanary';
```

## Свойства

| Свойство                                                               | Тип или варианты значения                              | По умолчанию              | Описание                                         |
| ---------------------------------------------------------------------- | ------------------------------------------------------ | ------------------------- | ------------------------------------------------ |
| [`items`](#варианты)                                                   | `ITEM[]`                                               | -                         | Массив элементов списка                          |
| [`value`](#выбранное-значение)                                         | `SelectPropValue<ITEM, MULTIPLE>`                      | -                         | Выбранное значение или массив значений           |
| [`onChange`](#выбранное-значение)                                      | `SelectPropOnChange<ITEM, MULTIPLE>`                   | -                         | Обработчик изменения значения                    |
| [`placeholder`](#подсказка)                                            | `string`                                               | -                         | Подсказка, отображается, когда вариант не выбран |
| [`groups`](#группы-вариантов)                                          | `GROUP[]`                                              | -                         | Массив групп для элементов списка                |
| [`multiple`](#множественный-выбор)                                     | `boolean`                                              | `false`                   | Включение множественного выбора                  |
| [`clearButton`](#кнопка-очистки-поля)                                  | `boolean`                                              | -                         | Показывает кнопку очистки поля                   |
| [`size`](#размер)                                                      | `'xs' \| 's' \| 'm' \| 'l'`                            | `'m'`                     | Размер компонента                                |
| [`view`](#стиль)                                                       | `'default' \| 'clear'`                                 | `'default'`               | Внешний вид компонента                           |
| [`form`](#форма)                                                       | `FieldPropForm`                                        | `'default'`               | Форма компонента                                 |
| [`status`](#статус)                                                    | `'' \| 'alert' \| 'success' \| 'warning'`              | `''`                      | Статус поля для выделения состояния              |
| [`disabled`](#неактивный-компонент)                                    | `boolean`                                              | -                         | Делает компонент неактивным                      |
| [`input`](#поиск)                                                      | `boolean`                                              | -                         | Включение текстового поля для поиска             |
| [`onInput`](#поиск)                                                    | `(value: string) => void`                              | -                         | Обработчик изменения значения в поле поиска      |
| [`labelForEmptyItems`](#поиск)                                         | `string`                                               | `'Список пуст'`           | Текст при отсутствии элементов в списке          |
| [`isLoading`](#индикация-загрузки)                                     | `boolean`                                              | -                         | Показывает индикатор загрузки                    |
| [`onCreate`](#создание-новых-вариантов)                                | `SelectPropOnCreate`                                   | -                         | Обработчик создания нового элемента              |
| [`labelForCreate`](#создание-новых-вариантов)                          | `string`                                               | `'+'`                     | Текст кнопки создания нового элемента            |
| [`virtualScroll`](#виртуализация-списка)                               | `boolean`                                              | -                         | Включает виртуализацию скролла                   |
| [`selectAll`](#выбор-всех-элементов)                                   | `boolean`                                              | `false`                   | Добавляет возможность выбора всех элементов      |
| [`allSelectedAllLabel`](#выбор-всех-элементов)                         | `string`                                               | -                         | Текст для выбора всех элементов                  |
| [`dropdownOpen`](#управление-состоянием-выпадающего-списка)            | `boolean`                                              | -                         | Состояние выпадающего списка (открыт/закрыт)     |
| [`onDropdownOpen`](#управление-состоянием-выпадающего-списка)          | `(open: boolean) => void`                              | -                         | Обработчик открытия/закрытия списка              |
| [`ignoreOutsideClicksRefs`](#управление-состоянием-выпадающего-списка) | `ReadonlyArray<React.RefObject<HTMLElement>>`          | -                         | Игнорируемые элементы при клике вне компонента   |
| [`renderItem`](#кастомный-элемент-списка)                              | `SelectPropRenderItem<ITEM>`                           | -                         | Функция рендера элемента списка                  |
| [`renderValue`](#кастомное-выбранное-значение)                         | `SelectPropRenderValue<ITEM, MULTIPLE>`                | -                         | Функция рендера выбранного значения              |
| [`getItemLabel`](#кастомные-типы-данных)                               | `SelectPropGetItemLabel<ITEM>`                         | `(item) => item.label`    | Функция получения названия элемента              |
| [`getItemKey`](#кастомные-типы-данных)                                 | `SelectPropGetItemKey<ITEM>`                           | `(item) => item.id`       | Функция получения ключа элемента                 |
| [`getItemGroupKey`](#кастомные-типы-данных)                            | `SelectPropGetItemGroupKey<ITEM>`                      | `(item) => item.groupId`  | Функция получения ключа группы элемента          |
| [`getItemDisabled`](#кастомные-типы-данных)                            | `SelectPropGetItemDisabled<ITEM>`                      | `(item) => item.disabled` | Функция определения состояния `disabled`         |
| [`getGroupLabel`](#кастомные-типы-данных)                              | `SelectPropGetGroupLabel<GROUP>`                       | `(group) => group.label`  | Функция получения названия группы                |
| [`getGroupKey`](#кастомные-типы-данных)                                | `SelectPropGetGroupKey<GROUP>`                         | `(group) => group.id`     | Функция получения ключа группы                   |
| `dropdownClassName`                                                    | `string`                                               | -                         | CSS-класс для выпадающего списка                 |
| `dropdownRef`                                                          | `React.Ref<HTMLDivElement>`                            | -                         | Ссылка на элемент выпадающего списка             |
| `inputRef`                                                             | `React.Ref<HTMLInputElement>`                          | -                         | Ссылка на поле ввода                             |
| `inputValue`                                                           | `string`                                               | -                         | Значение поля ввода                              |
| `inputDefaultValue`                                                    | `string`                                               | -                         | Начальное значение поля ввода                    |
| `onFocus`                                                              | `(event?: React.FocusEvent<HTMLInputElement>) => void` | -                         | Обработчик события фокуса                        |
| `onBlur`                                                               | `(event?: React.FocusEvent<HTMLInputElement>) => void` | -                         | Обработчик события потери фокуса                 |
| `onScrollToBottom`                                                     | `(length: number) => void`                             | -                         | Обработчик прокрутки до конца списка             |
| `iconClear`                                                            | `IconComponent`                                        | -                         | Иконка кнопки очистки                            |
| `aria-label`                                                           | `string`                                               | -                         | Атрибут `aria-label` для поля ввода              |
| `className`                                                            | `string`                                               | -                         | Дополнительный CSS-класс                         |
| `ref`                                                                  | `React.Ref<HTMLDivElement>`                            | -                         | Ссылка на корневой DOM-элемент компонента        |

```tsx
type RenderItemProps<ITEM> = {
  item: ITEM;
  active: boolean;
  hovered: boolean;
  onClick: (e: React.MouseEvent) => void;
  onMouseEnter: (e: React.MouseEvent) => void;
  ref: React.Ref<HTMLDivElement>;
};

type SelectItemDefault = {
  label: string;
  id: string | number;
  groupId?: string | number;
  disabled?: boolean;
};

type SelectGroupDefault = {
  label: string;
  id: string | number;
};

type SelectPropGetItemLabel<ITEM> = (item: ITEM) => string;
type SelectPropGetItemKey<ITEM> = (item: ITEM) => string | number;
type SelectPropGetItemGroupKey<ITEM> = (
  item: ITEM,
) => string | number | undefined;
type SelectPropGetItemDisabled<ITEM> = (item: ITEM) => boolean | undefined;
type SelectPropGetGroupKey<GROUP> = (group: GROUP) => string | number;
type SelectPropGetGroupLabel<GROUP> = (group: GROUP) => string;

type SelectPropOnChange<ITEM, MULTIPLE extends boolean> = (
  value: (MULTIPLE extends true ? ITEM[] : ITEM) | null,
  props: {
    e: React.SyntheticEvent;
  },
) => void;
type SelectPropValue<ITEM, MULTIPLE extends boolean> =
  | (MULTIPLE extends true ? ITEM[] : ITEM)
  | null
  | undefined;

type SelectPropRenderItem<ITEM> = (
  props: RenderItemProps<ITEM>,
) => React.ReactNode | null;

type SelectPropRenderValue<ITEM, MULTIPLE> = MULTIPLE extends true
  ? (props: {
      value: ITEM[];
      getRemove: (
        item: ITEM,
      ) => (e: React.SyntheticEvent<Element, Event>) => void;
    }) => React.ReactNode | null
  : (props: { value: ITEM }) => React.ReactNode | null;

type SelectPropOnCreate = (
  label: string,
  props: { e: React.SyntheticEvent },
) => void;

type FieldPropForm =
  | 'default'
  | 'defaultClear'
  | 'defaultBrick'
  | 'brick'
  | 'brickDefault'
  | 'brickClear'
  | 'brickRound'
  | 'round'
  | 'roundClear'
  | 'roundBrick'
  | 'clearRound'
  | 'clearDefault'
  | 'clearBrick'
  | 'clear';
```

## Содержимое

### Варианты

Свойство `items` задаёт массив элементов выпадающего списка. Тип по умолчанию — `SelectItemDefault`:

- `label: string` — название элемента (пишите с заглавной буквы, без точки).
- `id: string | number` — уникальный ключ элемента.
- `groupId?: string | number` — идентификатор группы (если используются группы).
- `disabled?: boolean` — флаг неактивного элемента.

Для кастомных типов данных используйте геттеры, описанные в [Кастомные типы данных](#кастомные-типы-данных).

<MdxTabs>

<SelectExampleItems />

```tsx
const items = [
  { label: 'Первый', id: 1 },
  { label: 'Второй', id: 2 },
  { label: 'Третий', id: 3 },
];
```

</MdxTabs>

### Выбранное значение

Свойство `value` задаёт текущее выбранное значение (один элемент или массив при `multiple`). Для обработки выбора используйте `onChange`, который возвращает выбранное значение и событие. Выбор срабатывает по клику или нажатию `Enter`.

<MdxTabs>

<SelectExampleItems />

```tsx
type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  { label: 'Первый', id: 1 },
  { label: 'Второй', id: 2 },
  { label: 'Третий', id: 3 },
];

export const SelectExampleItems = () => {
  const [value, setValue] = useState<Item | null>();
  return <Select items={items} value={value} onChange={setValue} />;
};
```

</MdxTabs>

### Подсказка

Свойство `placeholder` задаёт текст, отображаемый, когда ничего не выбрано. Рекомендуется использовать лаконичный текст, например, «Выберите».

<MdxTabs>

<SelectExamplePlaceholder />

```tsx
<Select placeholder="Выберите вариант" />
```

</MdxTabs>

### Неактивный элемент списка

Чтобы сделать элемент списка неактивным, добавьте в объект `items` свойство `disabled: true`.

<MdxTabs>

<SelectExampleDisabledItem />

```tsx
import React, { useState } from 'react';
import { Select } from '@consta/uikit/SelectCanary';

type Item = {
  label: string;
  id: number;
  disabled: boolean;
};

const items: Item[] = [
  { label: 'Первый — этот вариант не выбрать', id: 1, disabled: true },
  { label: 'Второй', id: 2, disabled: false },
  { label: 'Третий — и этот тоже не выбрать', id: 3, disabled: true },
];

export const SelectExampleDisabledItem = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <Select
      placeholder="Выберите вариант"
      items={items}
      value={value}
      onChange={setValue}
    />
  );
};
```

</MdxTabs>

### Множественный выбор

Для выбора нескольких элементов установите `multiple`. В этом случае `value` и `onChange` работают с массивом элементов.

<MdxTabs>

<SelectExampleMultiple />

```tsx
type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  { label: 'Первый', id: 1 },
  { label: 'Второй', id: 2 },
  { label: 'Третий', id: 3 },
];

export const SelectExampleMultiple = () => {
  const [value, setValue] = useState<Item[] | null>();
  return (
    <Select
      placeholder="Выберите вариант"
      items={items}
      value={value}
      onChange={setValue}
      multiple
    />
  );
```

</MdxTabs>

### Группы вариантов

Для группировки элементов используйте свойство `groups` (тип по умолчанию — `SelectGroupDefault`):

- `label: string` — название группы.
- `id: string | number` — уникальный ключ группы.

Связь элементов с группами задаётся через `groupId` в `items`.

<MdxTabs>

<SelectExampleGroups />

```tsx
type Item = {
  label: string;
  id: number;
  groupId: number;
};

type Group = {
  label: string;
  id: number;
};

const groups: Group[] = [
  { id: 1, label: 'Первая группа' },
  { id: 2, label: 'Вторая группа' },
  { id: 3, label: 'Третья группа' },
];
const items: Item[] = [
  { label: 'Первый', id: 1, groupId: 1 },
  { label: 'Второй', id: 2, groupId: 2 },
  { label: 'Третий', id: 3, groupId: 1 },
  { label: 'Четвертый', id: 4, groupId: 3 },
  { label: 'Пятый', id: 5, groupId: 2 },
];
export const SelectExampleGroups = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <Select
      placeholder="Выберите вариант"
      items={items}
      value={value}
      onChange={setValue}
      groups={groups}
    />
  );
};
```

</MdxTabs>

### Кнопка очистки поля

Свойство `clearButton` включает кнопку для очистки значений `value` и `searchValue`.

<MdxTabs>

<SelectExampleClearButton />

```tsx
<Select clearButton />
```

</MdxTabs>

## Внешний вид

### Размер

Свойство `size` задаёт размер компонента: `'xs'`, `'s'`, `'m'`, `'l'` (по умолчанию `'m'`). Компонент занимает всю ширину контейнера.

<MdxTabs>

<SelectExampleSize />

```tsx
<Select size="xs" />
<Select size="s" />
<Select size="m" />
<Select size="l" />
```

</MdxTabs>

### Стиль

Свойство `view` определяет стиль: `'default'` (по умолчанию) или `'clear'` (для кастомных контейнеров, без встроенных эффектов hover/focus).

<MdxTabs>

<SelectExampleView />

```tsx
<Select view="default" />
<Select view="clear" />
```

</MdxTabs>

### Форма

Свойство `form` задаёт форму компонента: `'default'`, `'brick'`, `'round'`, `'clear'`, и их комбинации (например, `'brickClear'`). По умолчанию — `'default'`.

### Статус

Свойство `status` выделяет поле визуально: `''` (обычное), `'alert'` (ошибка), `'success'` (успех), `'warning'` (предупреждение).

<MdxTabs>

<SelectExampleStatus />

```tsx
<Select status="alert" />
<Select status="success" />
<Select status="warning" />
```

</MdxTabs>

## Поведение

### Неактивный компонент

Свойство `disabled` делает весь компонент неактивным.

<MdxTabs>

<SelectExampleDisabled />

```tsx
<Select disabled />
```

</MdxTabs>

### Поиск

Для включения поиска используйте свойства:

- `input` — включает текстовое поле.
- `onInput` — обрабатывает изменения в поле.
- `labelForEmptyItems` — текст при пустом списке.

<MdxTabs>

<SelectExampleSearch />

```tsx
const list: ListItem[] = [
  { firstName: 'Илья', lastName: 'Васильев', role: 'Руководитель', id: 1 },
  { firstName: 'Михаил', lastName: 'Гусев', role: 'Разработчик', id: 2 },
  { firstName: 'Василий', lastName: 'Жмых', role: 'Дизайнер', id: 3 },
  { firstName: 'Василий', lastName: 'Белый', role: 'Разработчик', id: 4 },
];
const getItemLabel: SelectPropGetItemLabel<ListItem> = ({
  lastName,
  firstName,
}) => `${firstName} ${lastName}`;

const isSubstring = (string: string, substring: string) =>
  string.toLocaleLowerCase().indexOf(substring.toLocaleLowerCase()) !== -1;

export const SelectExampleSearch = () => {
  const [value, setValue] = useState<ListItem | null>();
  const [searchValue, setSearchValue] = useState('');
  const setSearchValueDebounce = useDebounce(setSearchValue, 300);

  const items = useMemo(() => {
    const searchWords = searchValue.trim().split(' ');
    const propsToSearch = ['firstName', 'lastName', 'role'] as const;
    const weights: Record<number, number> = {};

    for (let index = 0; index < list.length; index++) {
      const item = list[index];
      let weight = 0;

      for (let index = 0; index < searchWords.length; index++) {
        const word = searchWords[index].toLocaleLowerCase();

        for (let index = 0; index < propsToSearch.length; index++) {
          if (isSubstring(item[propsToSearch[index]], word)) {
            weight++;
          }
        }
      }

      weights[item.id] = weight;
    }

    return list
      .filter((item) => weights[item.id])
      .sort((a, b) => weights[b.id] - weights[a.id]);
  }, [searchValue]);

  return (
    <Select
      items={items}
      getItemLabel={getItemLabel}
      placeholder="Выберите вариант"
      value={value}
      onChange={setValue}
      clearButton
      onInput={setSearchValueDebounce}
      input
    />
  );
};
```

</MdxTabs>

Хук `useSearch` упрощает фильтрацию по свойству `label`.

<MdxTabs>

<SelectExampleUseSearch />

```tsx
type Item = {
  label: string;
  id: number | string;
};

const items: Item[] = [
  { label: 'Первый', id: 1 },
  { label: 'Второй', id: 2 },
  { label: 'Третий', id: 3 },
  { label: 'Четвертый', id: 4 },
  { label: 'Пятый', id: 5 },
];

export const SelectExampleSearch = () => {
  const [value, setValue] = useState<Item | null>();

  return (
    <Select
      {...useSearch({ items })}
      placeholder="Выберите вариант"
      value={value}
      onChange={setValue}
      clearButton
    />
  );
};
```

</MdxTabs>

### Создание новых вариантов

Свойство `onCreate` позволяет добавлять новые элементы в список. Передаётся `label` введённого значения.

<MdxTabs>

<SelectExampleCreate />

```tsx
import React, { useState, useCallback } from 'react';
import { Select, useSearch } from '@consta/uikit/Select';

const getItemLabel = (item: string) => item;

export function SelectExampleCreate() {
  const [value, setValue] = useState<string | null>();
  const [list, setList] = useState<string[]>(['Первый', 'Второй', 'Третий']);
  const { items, labelForEmptyItems, onInput } = useSearch({
    items: list,
    search: getSearchFunctionDefault(getItemLabel),
  });
  const onCreate = useCallback(
    (label: string) => setList((state) => [label, ...state]),
    [],
  );

  return (
    <Example col={1}>
      <Select
        placeholder="Выберите вариант"
        items={items}
        value={value}
        onChange={setValue}
        getItemLabel={getItemLabel}
        getItemKey={getItemLabel}
        onCreate={!items.length ? onCreate : undefined}
        labelForEmptyItems={labelForEmptyItems}
        onInput={onInput}
        input
      />
    </Example>
  );
}
```

</MdxTabs>

### Виртуализация списка

Свойство `virtualScroll` оптимизирует отображение больших списков.

<MdxTabs>

<SelectExampleVirtualScroll />

```tsx
import { FieldArrayValueItem } from '@consta/uikit/FieldComponents';

import { Select } from '@consta/uikit/SelectCanary';

type Item = {
  label: string;
  id: number;
  groupId: number;
};

type Group = {
  label: string;
  id: number;
};

const items: Item[] = new Array(1000).fill(null).map((_, i) => ({
  label: `Опция ${i + 1}`,
  groupId: Math.floor(i / 100) + 1,
  id: i,
}));

const groups: Group[] = new Array(items.length / 100)
  .fill(null)
  .map((_, i) => ({
    id: i + 1,
    label: `Группа ${i + 1}`,
  }));

export const SelectExampleVirtualScroll = () => {
  const [value, setValue] = useState<Item[] | null>();

  return (
    <Select
      placeholder="Чтобы посмотреть весь список, прокрутите вниз"
      items={items}
      value={value}
      onChange={setValue}
      groups={groups}
      multiple
      selectAll
      virtualScroll
      renderValue={({ value, getRemove }) => {
        if (value.length >= 200)
          return (
            <div
              style={{
                height: 'var(--field-array-value-inline-control-input-height)',
                lineHeight:
                  'var(--field-array-value-inline-control-input-height)',
              }}
            >{`Выбрано ${value.length} элементов`}</div>
          );
        return value.map((item) => (
          <FieldArrayValueItem
            key={item.id}
            size="m"
            label={item.label}
            onRemove={getRemove(item)}
          />
        ));
      }}
    />
  );
};
```

</MdxTabs>

### Индикация загрузки

Свойство `isLoading` включает индикатор загрузки. Для дозагрузки данных при прокрутке используйте `onScrollToBottom`.

<MdxTabs>

<SelectExampleIsLoading />

```tsx
export const SelectExampleIsLoading = () => {
  const [value, setValue] = useState<Item[] | null>();

  return (
    <Example col={1}>
      <Select
        placeholder="Кликните по полю ввода"
        items={[]}
        value={value}
        onChange={setValue}
        multiple
        isLoading
      />
    </Example>
  );
};
```

</MdxTabs>

<MdxTabs>

<SelectExampleIsLoadingOnScrollBottom />

```tsx
type Item = {
  label: string;
  id: number;
};

const useMockLoadData = (
  searchValue = '',
  timeout = 2000,
): [Item[], boolean, () => void] => {
  const [isLoading, setIsLoading] = useFlag();
  const [isStart, setIsStart] = useFlag();
  const [length, setLength] = useState<number>(0);
  const isLoadingOffDebounce = useDebounce(setIsLoading.off, 2000);

  const items = useMemo(() => {
    if (searchValue) {
      return new Array(10000)
        .fill(null)
        .map((_, i) => ({
          label: `Опция ${i + 1}`,
          id: i,
        }))
        .filter(
          (item) =>
            item.label
              .toLocaleLowerCase()
              .indexOf(searchValue.toLocaleLowerCase()) !== -1,
        );
    }
    return new Array(length).fill(null).map((_, i) => ({
      label: `Опция ${i + 1}`,
      id: i,
    }));
  }, [length, searchValue]);

  useEffect(() => {
    setIsLoading.on();
    isLoadingOffDebounce();
  }, [searchValue]);

  useEffect(() => {
    if (isStart) {
      setIsLoading.on();
    }

    const timeoutNumber = setTimeout(() => {
      if (isStart) {
        setLength((state) => state + 100);
        setIsLoading.off();
        setIsStart.off();
      }
    }, timeout);

    return () => {
      clearTimeout(timeoutNumber);
    };
  }, [isStart]);

  useEffect(() => {
    return () => {
      setIsLoading.off();
      setIsStart.off();
    };
  }, []);

  return [searchValue && isLoading ? [] : items, isLoading, setIsStart.on];
};

const SelectExampleIsLoadingOnScrollBottom = () => {
  const [value, setValue] = useState<Item[] | null>();
  const [searchValue, setSearchValue] = useState<string>('');
  const [data, isLoading, load] = useMockLoadData(searchValue);

  return (
    <Select
      placeholder="Кликните по полю ввода, чтобы данные загрузились"
      items={data}
      value={value}
      onChange={setValue}
      multiple
      isLoading={isLoading}
      virtualScroll
      onScrollToBottom={searchValue ? undefined : load}
      searchFunction={() => true}
      onSearchValueChange={setSearchValue}
    />
  );
};
```

</MdxTabs>

### Выбор всех элементов

Свойство `selectAll` добавляет пункт для выбора всех элементов. Текст пункта можно настроить через `allSelectedAllLabel`.

<MdxTabs>

<SelectExampleSelectAll />

```tsx
type Item = {
  label: string;
  id: number;
  groupId: number;
};

type Group = {
  label: string;
  id: number;
};

const groups: Group[] = [
  { id: 1, label: 'Первая группа' },
  { id: 2, label: 'Вторая группа' },
  { id: 3, label: 'Третья группа' },
];
const items: Item[] = [
  { label: 'Первый', id: 1, groupId: 1 },
  { label: 'Второй', id: 2, groupId: 2 },
  { label: 'Третий', id: 3, groupId: 1 },
  { label: 'Четвертый', id: 4, groupId: 3 },
  { label: 'Пятый', id: 5, groupId: 2 },
];

const SelectExampleSelectAll = () => {
  const [value, setValue] = useState<Item[] | null>();
  return (
    <Select
      placeholder="Выберите варианты"
      items={items}
      value={value}
      multiple
      selectAll
      allSelectedAllLabel="Все варианты"
      onChange={setValue}
      groups={groups}
    />
  );
};
```

</MdxTabs>

### Управление состоянием выпадающего списка

Для управления состоянием списка используйте:

- `dropdownOpen` — флаг открытия/закрытия.
- `onDropdownOpen` — обработчик открытия/закрытия.
- `ignoreOutsideClicksRefs` — элементы, игнорируемые при клике вне компонента.

#### Пример с раскрытием списка по кнопке

<MdxTabs>

<SelectExampleDropdownOpen />

```tsx
type Item = {
  label: string;
  id: number | string;
};

const items: Item[] = [
  { label: 'Первый', id: 1 },
  { label: 'Второй', id: 2 },
  { label: 'Третий', id: 3 },
];

const Icon = withAnimateSwitcherHOC({
  startIcon: IconArrowDown,
  startDirection: 0,
  endDirection: 180,
});

const SelectExampleDropdownOpen = () => {
  const [value, setValue] = useState<Item | null>();
  const [open, setOpen] = useFlag();
  const buttonRef = useRef<HTMLButtonElement>(null);
  const inputRef = useRef<HTMLInputElement>(null);
  const onDropdownOpen = useCallback((open: boolean) => {
    setOpen.set(open);
    if (open) {
      inputRef.current?.focus();
    }
  }, []);

  return (
    <AnimateIconSwitcherProvider active={open}>
      <FieldGroup>
        <Button
          ref={buttonRef}
          label={open ? 'Закрыть' : 'Открыть'}
          onClick={setOpen.toggle}
          iconLeft={Icon}
          onlyIcon
        />
        <Select
          inputRef={inputRef}
          placeholder="Выберите вариант"
          items={items}
          value={value}
          onChange={setValue}
          dropdownOpen={open}
          onDropdownOpen={onDropdownOpen}
          ignoreOutsideClicksRefs={[buttonRef]}
        />
      </FieldGroup>
    </AnimateIconSwitcherProvider>
  );
};
```

</MdxTabs>

#### Пример с раскрытием списка по фокусу

<MdxTabs>

<SelectExampleOpenByFocus />

```tsx
type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  { label: 'Первый', id: 1 },
  { label: 'Второй', id: 2 },
  { label: 'Третий', id: 3 },
];

export const SelectExampleOpenByFocus = () => {
  const [value, setValue] = useState<Item | null>();
  const [isOpened, setIsOpened] = useFlag();
  const inputRef = useRef<HTMLInputElement>(null);

  const handleFocus = () => inputRef.current?.focus();

  return (
    <>
      <Button onClick={handleFocus} label="Эмулировать фокус на элемент" />
      <Select
        inputRef={inputRef}
        items={items}
        value={value}
        onChange={setValue}
        placeholder="Выберите элемент"
        dropdownOpen={isOpened}
        onDropdownOpen={setIsOpened.set}
        onFocus={setIsOpened.on}
      />
    </>
  );
};
```

</MdxTabs>

## Кастомизация

### Кастомный элемент списка

Свойство `renderItem` позволяет настроить отображение элементов списка через функцию рендера.

<MdxTabs>

<SelectExampleRenderItem />

```tsx
import React, { useState } from 'react';
import { Badge } from '@consta/uikit/Badge';
import { Select } from '@consta/uikit/Select';

import { cn } from '@bem-react/classname';

import './SelectExampleRenderItem.css';

import { Example } from '@consta/stand';
import React, { useState } from 'react';

import { Badge } from '##/components/Badge';
import { Select } from '##/components/SelectCanary';
import { cn } from '##/utils/bem';

const cnSelectExampleRenderItem = cn('SelectExampleRenderItem');

type Item = {
  label: string;
  id: number;
  status?: 'repairs' | 'serviceable';
};

const items: Item[] = [
  { label: 'Принтер', id: 1, status: 'repairs' },
  { label: 'Монитор', id: 2, status: 'serviceable' },
  { label: 'Ноутбук', id: 3, status: 'serviceable' },
  { label: 'Стол', id: 4 },
];

const mapLabel = {
  repairs: 'На ремонте',
  serviceable: 'Исправен',
} as const;

const mapStatus = {
  repairs: 'error',
  serviceable: 'success',
} as const;

export const searchCompare = (
  searchValue: string,
  compare?: string,
): boolean => {
  if (!compare) {
    return false;
  }

  return (
    compare.toLocaleLowerCase().indexOf(searchValue.toLocaleLowerCase()) !== -1
  );
};

const searchFunction = (item: Item, searchValue: string): boolean => {
  const searchOfLabel = searchCompare(searchValue, item.label);

  if (searchOfLabel) {
    return searchOfLabel;
  }

  return searchCompare(searchValue, item.status && mapLabel[item.status]);
};

export const SelectExampleRenderItem = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <Select
      {...useSearch({ items, search: searchFunction })}
      placeholder="Выберите вариант"
      clearButton
      value={value}
      onChange={setValue}
      renderItem={({ item, active, hovered, onClick, onMouseEnter, ref }) => (
        <div
          className={cnSelectExampleRenderItem('Item', { active, hovered })}
          aria-selected={active}
          aria-hidden="true"
          onMouseEnter={onMouseEnter}
          onClick={onClick}
          ref={ref}
        >
          {item.label}
          {item.status && (
            <Badge
              className={cnSelectExampleRenderItem('Badge')}
              as="span"
              size="s"
              label={mapLabel[item.status]}
              status={mapStatus[item.status]}
            />
          )}
        </div>
      )}
    />
  );
};
```

```css
.SelectExampleRenderItem {
  &-Item {
    --text-color: var(--color-control-typo-default);
    position: relative;
    padding: var(--space-xs) var(--space-l);
    color: var(--text-color);
    &_hovered {
      background-color: var(--color-control-bg-clear-hover);
    }
    &_active {
      --text-color: var(--color-control-typo-secondary);
    }
    &_disabled {
      --text-color: var(--color-control-typo-disable);
    }
    &::before {
      content: '';
      position: absolute;
      top: calc(50% - 6px);
      left: 6px;
      width: 8px;
      height: 8px;
      background-color: var(--color-control-typo-disable);
      border-radius: 50%;
      transition: background-color 0.2s ease-in;
    }
    &_active::before {
      background-color: var(--text-color);
    }
  }
  &-Badge {
    margin-left: var(--space-m);
  }
}
```

</MdxTabs>

### Кастомное выбранное значение

Свойство `renderValue` позволяет настроить отображение выбранного значения.

<MdxTabs>

<SelectExampleRenderValue />

```tsx
type Item = {
  label: string;
  id: number;
};

const items: Item[] = [
  { label: 'Первый', id: 1 },
  { label: 'Второй', id: 2 },
  { label: 'Третий', id: 3 },
];

const SelectExampleRenderValue = () => {
  const [value, setValue] = useState<Item | null>();
  return (
    <Select
      placeholder="Выберите вариант"
      items={items}
      value={value}
      onChange={setValue}
      renderValue={({ value }) => (
        <div
          style={{
            height: 'var(--field-control-layout-slot-height)',
            lineHeight: 'var(--field-control-layout-slot-height)',
          }}
        >
          <span role="img" aria-label="Panda">
            🐼
          </span>{' '}
          — {value.label}
        </div>
      )}
    />
  );
};
```

</MdxTabs>

### Кастомные типы данных

Для использования кастомных типов данных задайте геттеры: `getItemLabel`, `getItemKey`, `getItemGroupKey`, `getItemDisabled`, `getGroupLabel`, `getGroupKey`.

#### Пример с кастомным Item

```tsx
import React, { useState } from 'react';
import { Select } from '@consta/uikit/Select';

function SelectExampleCustomTypes() {
  const [value, setValue] = useState<string | null>();
  return (
    <Select
      placeholder="Выберите вариант"
      items={['Первый', 'Второй', 'Третий']}
      value={value}
      onChange={setValue}
      getItemKey={(item) => item}
      getItemLabel={(item) => item}
    />
  );
}
```

#### Пример с кастомным Item и Group

```tsx
import React, { useState } from 'react';
import { Select } from '@consta/uikit/Select';

type Item = {
  name: string;
  group: string;
};

const items: Item[] = [
  { name: 'Первый', group: 'Первая группа' },
  { name: 'Второй', group: 'Третья группа' },
  { name: 'Третий', group: 'Вторая группа' },
  { name: 'Четвертый', group: 'Первая группа' },
  { name: 'Пятый', group: 'Первая группа' },
  { name: 'Шестой', group: 'Третья группа' },
  { name: 'Седьмой', group: 'Первая группа' },
  { name: 'Восьмой', group: 'Вторая группа' },
  { name: 'Девятый', group: 'Третья группа' },
  { name: 'Десятый', group: 'Вторая группа' },
];

const groups: string[] = ['Первая группа', 'Вторая группа', 'Третья группа'];

function SelectExampleCustomTypesWithGroups() {
  const [value, setValue] = useState<Item | null>();
  return (
    <Select
      placeholder="Выберите вариант"
      items={items}
      groups={groups}
      value={value}
      onChange={setValue}
      getItemKey={(item) => item.name}
      getItemLabel={(item) => item.name}
      getItemGroupKey={(item) => item.group}
      getGroupKey={(group: string) => group}
      getGroupLabel={(group: string) => group}
    />
  );
}
```
