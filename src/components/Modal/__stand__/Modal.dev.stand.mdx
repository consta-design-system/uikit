import { MdxMenu, MdxTabs } from '@consta/stand';
import {
  ModalExample,
  ModalExampleTop,
  ModalExampleCenter,
  ModalExampleNoOverlay,
} from './examples/ModalExample/ModalExample';

import { ModalExampleZIndex } from './examples/ModalExampleZIndex/ModalExampleZIndex';

<MdxMenu>

- [Обзор](#обзор)
- [Импорт](#импорт)
- [Свойства](#свойства)
- [Содержимое](#содержимое)
- [Внешний вид](#внешний-вид)
  - [Расположение](#расположение)
  - [Подложка](#подложка)
- [Поведение](#поведение)
  - [Взаимодействие](#взаимодействие)
- [zIndex и вложенные всплывающие окна](#zindex-и-вложенные-всплывающие-окна)

</MdxMenu>

## Обзор

Компонент `Modal` используется для создания модальных окон, которые отображаются поверх основного содержимого страницы. В модальное окно можно поместить любой контент: текст, изображения, формы, таблицы или другие компоненты. Оно поддерживает настройку расположения, подложки, а также взаимодействие с пользователем через клики и нажатия клавиш.

## Импорт

```tsx
import { Modal } from '@consta/uikit/Modal';
```

## Свойства

| Свойство                             | Тип или варианты значения       | По умолчанию           | Описание                                                    |
| ------------------------------------ | ------------------------------- | ---------------------- | ----------------------------------------------------------- |
| [`children?`](#содержимое)           | `React.ReactNode`               | -                      | Дочерние элементы, отображаемые внутри модального окна      |
| [`position?`](#расположение)         | `'center' \| 'top'`             | `'center'`             | Расположение модального окна на странице                    |
| [`hasOverlay?`](#подложка)           | `boolean`                       | `true`                 | Добавляет полупрозрачную подложку вокруг модального окна    |
| [`onClickOutside?`](#взаимодействие) | `(e: React.MouseEvent) => void` | -                      | Действие при клике за пределами модального окна             |
| [`onEsc?`](#взаимодействие)          | `(e: KeyboardEvent) => void`    | -                      | Действие при нажатии клавиши **Escape**                     |
| [`onOpen?`](#взаимодействие)         | `() => void`                    | -                      | Действие при открытии модального окна                       |
| [`onClose?`](#взаимодействие)        | `() => void`                    | -                      | Действие в момент начала анимации закрытия модального окна  |
| [`afterClose?`](#взаимодействие)     | `() => void`                    | -                      | Действие после завершения анимации закрытия модального окна |
| `isOpen?`                            | `boolean`                       | -                      | Открывает или закрывает модальное окно                      |
| `container?`                         | `HTMLDivElement \| undefined`   | `window.document.body` | Родительский контейнер для модального окна                  |
| `className?`                         | `string`                        | -                      | Дополнительный CSS-класс для модального окна                |
| `rootClassName?`                     | `string`                        | -                      | Дополнительный CSS-класс для корневого DOM-элемента         |

## Содержимое

### Дочерние элементы

Свойство `children` определяет содержимое модального окна. Внутри `<Modal></Modal>` можно разместить любой React-компонент или HTML-элемент, например, текст, изображения, формы или таблицы.

<MdxTabs>

<ModalExample />

```tsx
const [isModalOpen, setIsModalOpen] = React.useState(false);

return (
  <>
    <Button
      size="m"
      view="primary"
      label="Открыть модальное окно"
      width="default"
      onClick={() => setIsModalOpen(true)}
    />
    <Modal
      isOpen={isModalOpen}
      hasOverlay
      onClickOutside={() => setIsModalOpen(false)}
      onEsc={() => setIsModalOpen(false)}
    >
      <Text as="p" size="s" view="secondary" lineHeight="m">
        Это заголовок модального окна
      </Text>
      <Text as="p" size="s" view="secondary" lineHeight="m">
        Это содержимое модального окна. Здесь может быть что угодно: текст,
        изображение, форма или таблица. Всё, что хочется вынести из контекста и
        показать поверх основной страницы.
      </Text>
      <div>
        <Button
          size="m"
          view="primary"
          label="Закрыть"
          width="default"
          onClick={() => setIsModalOpen(false)}
        />
      </div>
    </Modal>
  </>
);
```

</MdxTabs>

## Внешний вид

### Расположение

Свойство `position` определяет положение модального окна на странице. Возможные значения:

- `'center'` — окно располагается в центре экрана (по умолчанию).
- `'top'` — окно располагается в верхней части экрана.

Пример с `position="top"`:

<MdxTabs>

<ModalExampleTop />

```tsx
const [isModalOpen, setIsModalOpen] = React.useState(false);

return (
  <>
    <Button
      size="m"
      view="primary"
      label="Окно сверху"
      width="default"
      onClick={() => setIsModalOpen(true)}
    />
    <Modal
      isOpen={isModalOpen}
      hasOverlay
      position="top"
      onClickOutside={() => setIsModalOpen(false)}
      onEsc={() => setIsModalOpen(false)}
    >
      <Text as="p" size="s" view="secondary" lineHeight="m">
        Я окно
      </Text>
      <Text as="p" size="s" view="secondary" lineHeight="m">
        Я выше всех!
      </Text>
      <div>
        <Button
          size="m"
          view="primary"
          label="Ясно-понятно"
          width="default"
          onClick={() => setIsModalOpen(false)}
        />
      </div>
    </Modal>
  </>
);
```

</MdxTabs>

Пример с `position="center"`:

<MdxTabs>

<ModalExampleCenter />

```tsx
const [isModalOpen, setIsModalOpen] = React.useState(false);

return (
  <>
    <Button
      size="m"
      view="primary"
      label="Окно по центру"
      width="default"
      onClick={() => setIsModalOpen(true)}
    />
    <Modal
      isOpen={isModalOpen}
      hasOverlay
      onClickOutside={() => setIsModalOpen(false)}
      onEsc={() => setIsModalOpen(false)}
    >
      <Text as="p" size="s" view="secondary" lineHeight="m">
        Я окно
      </Text>
      <Text as="p" size="s" view="secondary" lineHeight="m">
        Я в самой серединке!
      </Text>
      <div>
        <Button
          size="m"
          view="primary"
          label="И тут всё понятно"
          width="default"
          onClick={() => setIsModalOpen(false)}
        />
      </div>
    </Modal>
  </>
);
```

</MdxTabs>

### Подложка

Свойство `hasOverlay` управляет отображением полупрозрачной подложки вокруг модального окна. По умолчанию подложка включена (`hasOverlay=true`), она закрывает всю страницу, создавая акцент на содержимом модального окна.

Чтобы отключить подложку, установите `hasOverlay=false`.

Пример без подложки:

<MdxTabs>

<ModalExampleNoOverlay />

```tsx
const [isModalOpen, setIsModalOpen] = React.useState(false);

return (
  <>
    <Button
      size="m"
      view="primary"
      label="Без подложки"
      width="default"
      onClick={() => setIsModalOpen(true)}
    />
    <Modal
      isOpen={isModalOpen}
      hasOverlay={false}
      onClickOutside={() => setIsModalOpen(false)}
      onEsc={() => setIsModalOpen(false)}
    >
      <Text as="p" size="s" view="secondary" lineHeight="m">
        Я окно
      </Text>
      <Text as="p" size="s" view="secondary" lineHeight="m">
        Я без подложки. Честно-честно.
      </Text>
      <div>
        <Button
          size="m"
          view="primary"
          label="Закройся!"
          width="default"
          onClick={() => setIsModalOpen(false)}
        />
      </div>
    </Modal>
  </>
);
```

</MdxTabs>

## Поведение

### Взаимодействие

- `onClickOutside`: Вызывается при клике за пределами модального окна. Обычно используется для закрытия окна.
- `onEsc`: Вызывается при нажатии клавиши **Escape**, если окно открыто. Часто используется для закрытия окна.
- `onOpen`: Вызывается при открытии модального окна.
- `onClose`: Вызывается в момент начала анимации закрытия окна.
- `afterClose`: Вызывается после завершения анимации закрытия окна.

Эти свойства позволяют настроить интерактивное поведение модального окна. Пример их использования см. в разделе [Содержимое](#содержимое).

## zIndex и вложенные всплывающие окна

Модальное окно поддерживает вложенные компоненты с всплывающими элементами, такими как другие модальные окна или тултипы. Если задать `zIndex` через свойство `style`, все вложенные всплывающие элементы автоматически получат `zIndex + 1`, чтобы отображаться поверх родительского окна.

Пример с вложенным модальным окном и тултипом:

<MdxTabs>

<ModalExampleZIndex />

```tsx
const ButtonWithTooltip = withTooltip({ mode: 'click', content: 'Я тултип' })(
  Button,
);

const [isModalOpen, setIsModalOpen] = useFlag();
const [isModal2Open, setIsModal2Open] = useFlag();

return (
  <>
    <Button
      size="m"
      view="primary"
      label="Открыть модальное окно"
      width="default"
      onClick={setIsModalOpen.toggle}
    />
    <Modal
      className={cnMixSpace({ p: 'm' })}
      isOpen={isModalOpen}
      hasOverlay
      onClickOutside={setIsModalOpen.off}
      onEsc={setIsModalOpen.off}
      style={{ zIndex: 100 }}
    >
      <Select
        className={cnMixSpace({ mB: 'm' })}
        items={['один', 'два']}
        getItemLabel={(item) => item}
        getItemKey={(item) => item}
        onChange={({ value }) => console.log(value)}
        placeholder="Один или два"
      />
      <ButtonWithTooltip
        className={cnMixSpace({ mB: 'm', mR: '6xl' })}
        label="Нажмите, и появится тултип"
      />
      <Button
        size="m"
        view="primary"
        label="Открыть вложенное модальное окно"
        width="default"
        onClick={setIsModal2Open.toggle}
      />
      <Modal
        className={cnMixSpace({ p: 'm' })}
        isOpen={isModal2Open}
        hasOverlay
        onClickOutside={setIsModal2Open.off}
        onEsc={setIsModal2Open.off}
      >
        <Select
          className={cnMixSpace({ mB: 'm' })}
          items={['один', 'два']}
          getItemLabel={(item) => item}
          getItemKey={(item) => item}
          onChange={({ value }) => console.log(value)}
          placeholder="Один или два"
        />
        <ButtonWithTooltip
          className={cnMixSpace({ mB: 'm' })}
          label="Нажмите, и появится тултип"
        />
      </Modal>
    </>
  </>
);
```

</MdxTabs>
