import { MdxMenu, MdxTabs } from '@consta/stand';

import { ContextMenuExampleLabel } from './examples/ContextMenuExampleLabel/ContextMenuExampleLabel';
import { ContextMenuExampleSubMenu } from './examples/ContextMenuExampleSubMenu/ContextMenuExampleSubMenu';
import { ContextMenuExampleOutsideClick } from './examples/ContextMenuExampleOutsideClick/ContextMenuExampleOutsideClick';
import { ContextMenuExampleSide } from './examples/ContextMenuExampleSide/ContextMenuExampleSide';
import { ContextMenuExampleStatus } from './examples/ContextMenuExampleStatus/ContextMenuExampleStatus';
import { ContextMenuExampleGroups } from './examples/ContextMenuExampleGroups/ContextMenuExampleGroups';
import { ContextMenuExampleIcon } from './examples/ContextMenuExampleIcon/ContextMenuExampleIcon';
import { ContextMenuExampleSize } from './examples/ContextMenuExampleSize/ContextMenuExampleSize';
import { ContextMenuExampleDefault } from './examples/ContextMenuExampleDefault/ContextMenuExampleDefault';
import { ContextMenuExampleDisabled } from './examples/ContextMenuExampleDisabled/ContextMenuExampleDisabled';
import { ContextMenuExampleOnClick } from './examples/ContextMenuExampleOnClick/ContextMenuExampleOnClick';
import { ContextMenuExampleMobile } from './examples/ContextMenuExampleMobile/ContextMenuExampleMobile';

<MdxMenu>

- [Обзор](#обзор)
- [Импорт](#импорт)
- [Свойства](#свойства)
- [Содержимое](#содержимое)
  - [Текст пункта](#текст-пункта)
  - [Статус пункта меню](#статус-пункта-меню)
  - [Заблокировать пункт меню](#заблокировать-пункт-меню)
  - [Иконка](#иконка)
  - [Кастомное событие](#кастомное-событие)
  - [Дополнительные элементы](#дополнительные-элементы)
  - [Второй уровень меню](#второй-уровень-меню)
  - [Группы пунктов меню](#группы-пунктов-меню)
- [Внешний вид](#внешний-вид)
  - [Размер меню](#размер-меню)
- [Поведение](#поведение)
  - [Закрыть по клику за пределами](#закрыть-по-клику-за-пределами)
  - [Мобильный вид](#мобильный-вид)
- [Пример использования](#пример-использования)

</MdxMenu>

## Обзор

Компонент `ContextMenu` из библиотеки Consta UI Kit предназначен для создания контекстного меню, которое отображается при взаимодействии с элементом (например, по клику). Меню поддерживает настройку содержимого, внешнего вида и поведения, включая вложенные уровни, иконки, статусы и группы пунктов.

## Импорт

```tsx
import { ContextMenu } from '@consta/uikit/ContextMenu';
```

## Свойства

| Свойство                                            | Тип                                                                      | По умолчанию     | Описание                                                                                                                                                               |
| --------------------------------------------------- | ------------------------------------------------------------------------ | ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [`items`](#содержимое)                              | `ITEM[]`                                                                 | -                | Элементы меню                                                                                                                                                          |
| [`groups`](#группы-пунктов-меню)                    | `GROUP[]`                                                                | -                | Группы пунктов меню                                                                                                                                                    |
| [`size?`](#размер-меню)                             | `'xs' \| 's' \| 'm' \| 'l'`                                              | `'m'`            | Размер контекстного меню                                                                                                                                               |
| [`getItemLabel`](#текст-пункта)                     | `(item: ITEM) => string \| number`                                       | -                | Функция для получения названия пункта меню. Если не указано `getItemKey`, используется как ключ                                                                        |
| [`getItemStatus?`](#статус-пункта-меню)             | `(item: ITEM) => ContextMenuStatus \| undefined`                         | -                | Функция для получения статуса пункта меню                                                                                                                              |
| [`getItemDisabled?`](#заблокировать-пункт-меню)     | `(item: ITEM) => boolean \| undefined`                                   | -                | Функция для блокировки пункта меню. При `true` события пункта отключаются                                                                                              |
| [`getItemLeftIcon?`](#иконка)                       | `(item: ITEM) => IconComponent \| undefined`                             | -                | Функция для получения иконки слева от названия пункта меню                                                                                                             |
| [`getItemRightIcon?`](#иконка)                      | `(item: ITEM) => IconComponent \| undefined`                             | -                | Функция для получения иконки справа от названия пункта меню                                                                                                            |
| [`getItemLeftSide?`](#дополнительные-элементы)      | `(item: ITEM) => React.ReactNode \| undefined`                           | -                | Функция для рендера элементов слева от названия пункта меню                                                                                                            |
| [`getItemRightSide?`](#дополнительные-элементы)     | `(item: ITEM) => React.ReactNode \| undefined`                           | -                | Функция для рендера элементов справа от названия пункта меню                                                                                                           |
| [`getItemSubMenu?`](#второй-уровень-меню)           | `(item: ITEM) => ITEM[] \| undefined`                                    | -                | Функция для получения пунктов меню второго уровня                                                                                                                      |
| [`getItemOnClick?`](#кастомное-событие)             | `(item: ITEM) => React.MouseEventHandler \| undefined`                   | -                | Функция для обработки клика по пункту меню                                                                                                                             |
| [`getItemGroupId?`](#группы-пунктов-меню)           | `(item: ITEM) => number \| undefined`                                    | -                | Функция для получения идентификатора группы пункта меню                                                                                                                |
| [`getGroupLabel?`](#группы-пунктов-меню)            | `(group: GROUP) => string \| undefined`                                  | -                | Функция для получения заголовка группы                                                                                                                                 |
| [`getGroupId?`](#группы-пунктов-меню)               | `(group: GROUP) => number`                                               | -                | Функция для получения ключа группы                                                                                                                                     |
| [`sortGroup?`](#группы-пунктов-меню)                | `(a: string \| number, b: string \| number) => number`                   | -                | Функция сортировки групп                                                                                                                                               |
| [`subMenuDirection?`](#второй-уровень-меню)         | `'rightStartUp' \| 'rightStartDown' \| 'leftStartUp' \| 'leftStartDown'` | `'rightStartUp'` | Позиция разворачивания меню второго уровня                                                                                                                             |
| [`isMobile?`](#мобильный-вид)                       | `boolean`                                                                | -                | Включает мобильный вид                                                                                                                                                 |
| [`onClickOutside?`](#закрыть-по-клику-за-пределами) | `(event: MouseEvent) => void`                                            | -                | Действие по клику вне меню или вне элемента, привязанного к `anchorRef`                                                                                                |
| `anchorRef`                                         | `React.RefObject<HTMLElement>`                                           | -                | Элемент, относительно которого позиционируется меню, см. [Popover](##LIBS.LIB.STAND/lib:uikit/stand:components-popover-stable)                                         |
| `position`                                          | `{ x: number; y: number } \| undefined`                                  | -                | Координаты точки, к которой прикрепляется меню (обязательны, если не заполнено `anchorRef`), см. [Popover](##LIBS.LIB.STAND/lib:uikit/stand:components-popover-stable) |
| `direction?`                                        | `Direction`                                                              | -                | Основное направление разворачивания меню, см. [Popover](##LIBS.LIB.STAND/lib:uikit/stand:components-popover-stable)                                                    |
| `possibleDirections?`                               | `Direction[]`                                                            | -                | Дополнительные направления разворачивания меню, см. [Popover](##LIBS.LIB.STAND/lib:uikit/stand:components-popover-stable)                                              |
| `offset?`                                           | `PopoverPropOffset`                                                      | -                | Отступ от якоря или позиции, см. [Popover](##LIBS.LIB.STAND/lib:uikit/stand:components-popover-stable)                                                                 |
| `isOpen?`                                           | `boolean`                                                                | -                | Показывает, нужно ли раскрывать меню                                                                                                                                   |
| `onItemClick?`                                      | `ContextMenuPropOnClick`                                                 | -                | Действие по клику на пункт меню                                                                                                                                        |
| `onEsc?`                                            | `React.KeyboardEventHandler`                                             | -                | Событие по нажатию клавиши Esc                                                                                                                                         |
| `getItemKey?`                                       | `(item: ITEM) => string \| number \| undefined`                          | -                | Функция для получения уникального ключа пункта меню                                                                                                                    |
| `getItemAs?`                                        | `(item: ITEM) => AsTags \| undefined`                                    | -                | Функция для определения способа отрисовки пункта меню                                                                                                                  |
| `getItemAttributes?`                                | `(item: ITEM) => AsAttributes \| undefined`                              | -                | Функция для получения HTML-атрибутов пункта меню                                                                                                                       |
| `className?`                                        | `string`                                                                 | -                | Дополнительный CSS-класс для каждого уровня меню                                                                                                                       |

```tsx
export const contextMenuSizes = ['m', 'xs', 's', 'l'] as const;
export type ContextMenuPropSize = typeof contextMenuSizes[number];
export const contextMenuDefaultSize: ContextMenuPropSize = contextMenuSizes[0];

export const contextMenuStatus = ['alert', 'success', 'warning'] as const;
export type ContextMenuStatus = typeof contextMenuStatus[number];
export const contextMenuDefaultStatus: ContextMenuStatus = contextMenuStatus[0];

export const contextMenuForm = listPropForm;
export type ContextMenuForm = ListPropForm;
export const defaultContextMenuForm = defaultListPropForm;

export const contextMenuPropSubMenuDirections = [
  'rightStartUp',
  'rightStartDown',
  'leftStartUp',
  'leftStartDown',
] as const;
export type ContextMenuPropSubMenuDirection =
  typeof contextMenuPropSubMenuDirections[number];
export const contextMenuPropDefaultSubMenuDirection: ContextMenuPropSubMenuDirection =
  contextMenuPropSubMenuDirections[0];

export type ContextMenuPropOnClick<ITEM> = (
  item: ITEM,
  params: {
    e: React.MouseEvent;
  },
) => void;

export type ContextMenuGroupDefault = {
  label?: string;
  id: number;
};

export type ContextMenuItemDefault = {
  label: string | number;
  key?: string | number;
  rightSide?: React.ReactNode;
  rightIcon?: IconComponent;
  leftSide?: React.ReactNode;
  leftIcon?: IconComponent;
  subMenu?: ContextMenuItemDefault[];
  status?: ContextMenuStatus;
  disabled?: boolean;
  groupId?: number;
  onClick?: React.MouseEventHandler;
  as?: AsTags;
  attributes?: AsAttributes;
};

export type ContextMenuPropSortGroup = (
  a: string | number,
  b: string | number,
) => number;

export type ContextMenuPropGetItemLabel<ITEM> = (item: ITEM) => string | number;

export type ContextMenuPropGetItemRightSide<ITEM> = (
  item: ITEM,
) => React.ReactNode | undefined;

export type ContextMenuPropGetItemLeftSide<ITEM> = (
  item: ITEM,
) => React.ReactNode | undefined;

export type ContextMenuPropGetItemSubMenu<ITEM> = (
  item: ITEM,
) => ITEM[] | undefined;

export type ContextMenuPropGetItemStatus<ITEM> = (
  item: ITEM,
) => ContextMenuStatus | undefined;

export type ContextMenuPropGetItemKey<ITEM> = (
  item: ITEM,
) => string | number | undefined;

export type ContextMenuPropGetItemOnClick<ITEM> = (
  item: ITEM,
) => React.MouseEventHandler | undefined;

export type ContextMenuPropGetItemDisabled<ITEM> = (
  item: ITEM,
) => boolean | undefined;

export type ContextMenuPropGetItemAs<ITEM> = (item: ITEM) => AsTags | undefined;

export type ContextMenuPropGetItemAttributes<ITEM> = (
  item: ITEM,
) => AsAttributes | undefined;

export type ContextMenuPropGetItemGroupId<ITEM> = (
  item: ITEM,
) => number | undefined;

export type ContextMenuPropGetItemRightIcon<ITEM> = (
  item: ITEM,
) => IconComponent | undefined;

export type ContextMenuPropGetItemLeftIcon<ITEM> = (
  item: ITEM,
) => IconComponent | undefined;

export type ContextMenuPropGetGroupLabel<GROUP> = (
  group: GROUP,
) => string | undefined;
export type ContextMenuPropGetGroupId<GROUP> = (group: GROUP) => number;

type Direction =
  | 'downCenter'
  | 'upCenter'
  | 'downRight'
  | 'downLeft'
  | 'upRight'
  | 'upLeft'
  | 'leftUp'
  | 'leftCenter'
  | 'leftDown'
  | 'rightUp'
  | 'rightCenter'
  | 'rightDown'
  | 'downStartLeft'
  | 'upStartLeft'
  | 'downStartRight'
  | 'upStartRight'
  | 'leftStartUp'’
  | 'leftStartDown'
  | 'rightStartUp'
  | 'rightStartDown';
```

## Содержимое

### Текст пункта

Свойство `label` в массиве `items` задаёт текст пункта меню. Для кастомных типов используйте функцию `getItemLabel` для получения названия.

<MdxTabs>

<ContextMenuExampleLabel />

```tsx
const items = ['Пункт 1', 'Пункт 2', 'Пункт 3'];
const [isOpen, setIsOpen] = useState(false);
const ref = useRef(null);
return (
  <>
    <Button ref={ref} label="Открыть" onClick={() => setIsOpen(!isOpen)} />
    <ContextMenu
      isOpen={isOpen}
      items={items}
      getItemLabel={(item) => item}
      anchorRef={ref}
    />
  </>
);
```

</MdxTabs>

### Статус пункта меню

Свойство `status` в массиве `items` задаёт цвет текста пункта меню (`alert`, `warning`, `success`). Для кастомных типов используйте функцию `getItemStatus`.

<MdxTabs>

<ContextMenuExampleStatus />

```tsx
const items = [
  { label: 'Пункт 1', accent: 'alert' },
  { label: 'Пункт 2', accent: 'warning' },
  { label: 'Пункт 3', accent: 'success' },
];
const [isOpen, setIsOpen] = useState(false);
const ref = useRef(null);
return (
  <>
    <Button ref={ref} label="Открыть" onClick={() => setIsOpen(!isOpen)} />
    <ContextMenu
      isOpen={isOpen}
      items={items}
      getItemStatus={(item) => item.accent}
      anchorRef={ref}
      direction="downStartLeft"
    />
  </>
);
```

</MdxTabs>

### Заблокировать пункт меню

Свойство `disabled` в массиве `items` блокирует пункт меню. Для кастомных типов используйте функцию `getItemDisabled`.

<MdxTabs>

<ContextMenuExampleDisabled />

```tsx
const items = [
  { label: 'Пункт 1', active: true },
  { label: 'Пункт 2', active: true },
  { label: 'Пункт 3', active: false },
];
const [isOpen, setIsOpen] = useState(false);
const ref = useRef(null);
return (
  <>
    <Button ref={ref} label="Открыть" onClick={() => setIsOpen(!isOpen)} />
    <ContextMenu
      isOpen={isOpen}
      items={items}
      getItemDisabled={(item) => item.active}
      anchorRef={ref}
      direction="downStartLeft"
    />
  </>
);
```

</MdxTabs>

### Иконка

Свойства `leftIcon` и `rightIcon` добавляют иконки слева или справа от названия пункта. Для кастомных типов используйте функции `getItemLeftIcon` и `getItemRightIcon`.

<MdxTabs>

<ContextMenuExampleIcon />

```tsx
const items = [
  { label: 'Скрепка', imageLeft: IconAttach },
  { label: 'Две галочки', imageRight: IconAllDone },
  { label: 'Чемодан', imageLeft: IconBag },
];
const [isOpen, setIsOpen] = useState(false);
const ref = useRef(null);
return (
  <>
    <Button ref={ref} label="Открыть" onClick={() => setIsOpen(!isOpen)} />
    <ContextMenu
      isOpen={isOpen}
      items={items}
      getItemLeftIcon={(item) => item.imageLeft}
      getItemRightIcon={(item) => item.imageRight}
      anchorRef={ref}
      direction="downStartLeft"
    />
  </>
);
```

</MdxTabs>

### Кастомное событие

Свойство `onClick` в массиве `items` или функция `getItemOnClick` определяют действие при клике на пункт меню.

<MdxTabs>

<ContextMenuExampleOnClick />

```tsx
const items = [
  { label: 'Пункт 1' },
  { label: 'Пункт 2', event: () => alert('Нажатие на второй пункт') },
  { label: 'Пункт 3' },
];
const getItemOnClick = (item) => {
  if (item.event) {
    return item.event;
  }
  return () => alert(item.label);
};
const [isOpen, setIsOpen] = useState(false);
const ref = useRef(null);
return (
  <>
    <Button ref={ref} label="Открыть" onClick={() => setIsOpen(!isOpen)} />
    <ContextMenu
      isOpen={isOpen}
      items={items}
      anchorRef={ref}
      getItemOnClick={getItemOnClick}
      onClickOutside={() => setIsOpen(false)}
      direction="downStartLeft"
    />
  </>
);
```

</MdxTabs>

### Дополнительные элементы

Свойства `leftSide` и `rightSide` добавляют элементы (например, текст, переключатель) слева или справа от названия пункта. Для кастомных типов используйте функции `getItemLeftSide` и `getItemRightSide`.

<MdxTabs>

<ContextMenuExampleSide />

```tsx
const menuItems = [
  { label: 'Пункт 1', icon: IconInfo, status: 'success' },
  { label: 'Пункт 2', icon: IconInfo, status: 'warning', switch: false },
  { label: 'Пункт 3', icon: IconInfo, status: 'success', switch: true },
];
function renderLeftSide(item) {
  const Icon = item.icon;
  return <Icon size="s" />;
}
function renderRightSide(item, onChange) {
  const nodeArray = [];
  item.switch !== undefined &&
    nodeArray.push(
      <Switch
        size="m"
        checked={item.switch}
        onChange={() => onChange(item)}
        key="Switch"
      />,
    );
  nodeArray.push(<Badge status={item.status} minified key="Badge" size="s" />);
  return nodeArray;
}
const [items, setItems] = useState(menuItems);
const onChange = (switchItem) => {
  const newItems = items.map((item, index) => {
    if (switchItem.label === item.label) {
      return { ...items[index], switch: !items[index].switch };
    }
    return item;
  });
  setItems(newItems);
};
const [isOpen, setIsOpen] = useState(false);
const ref = useRef(null);
return (
  <>
    <Button ref={ref} label="Открыть" onClick={() => setIsOpen(!isOpen)} />
    <ContextMenu
      isOpen={isOpen}
      items={items}
      anchorRef={ref}
      getItemLeftSide={renderLeftSide}
      getItemRightSide={(item) => renderRightSide(item, onChange)}
    />
  </>
);
```

</MdxTabs>

### Второй уровень меню

Свойство `subMenu` в массиве `items` задаёт вложенные пункты меню. Для кастомных типов используйте функцию `getItemSubMenu`. Направление разворачивания задаётся свойством `subMenuDirection`.

<MdxTabs>

<ContextMenuExampleSubMenu />

```tsx
const items = [
  {
    label: 'Пункт 1',
    menu: [
      { label: 'Пункт 1-1' },
      { label: 'Пункт 1-2' },
      {
        label: 'Пункт 1-3',
        menu: [
          { label: 'Пункт 1-3-1' },
          { label: 'Пункт 1-3-2' },
          { label: 'Пункт 1-3-3' },
        ],
      },
    ],
  },
  { label: 'Пункт 2' },
  { label: 'Пункт 3' },
];
const [isOpen, setIsOpen] = useState(false);
const ref = useRef(null);
return (
  <>
    <Button ref={ref} label="Открыть" onClick={() => setIsOpen(!isOpen)} />
    <ContextMenu
      isOpen={isOpen}
      items={items}
      anchorRef={ref}
      getItemSubMenu={(item) => item.menu}
    />
  </>
);
```

</MdxTabs>

### Группы пунктов меню

Свойство `groups` задаёт группы пунктов меню, а `groupId` в `items` привязывает пункт к группе. Для кастомных типов используйте функции `getItemGroupId`, `getGroupId` и `getGroupLabel`. Функция `sortGroup` определяет порядок сортировки групп.

<MdxTabs>

<ContextMenuExampleGroups />

```tsx
const groups = [
  { name: 'Первая группа', key: 1 },
  { name: 'Вторая группа', key: 2 },
];
const items = [
  { label: 'Пункт 1', group: 1 },
  { label: 'Пункт 2', group: 2 },
  { label: 'Пункт 3', group: 2 },
];
const sortGroup = (a, b) => {
  if (a > b) return 1;
  if (a < b) return -1;
  return 0;
};
const [isOpen, setIsOpen] = useState(false);
const ref = useRef(null);
return (
  <>
    <Button ref={ref} label="Открыть" onClick={() => setIsOpen(!isOpen)} />
    <ContextMenu
      items={items}
      isOpen={isOpen}
      groups={groups}
      getItemGroupId={(item) => item.group}
      getGroupLabel={(group) => group.name}
      getGroupId={(group) => group.key}
      anchorRef={ref}
      sortGroup={sortGroup}
    />
  </>
);
```

</MdxTabs>

## Внешний вид

### Размер меню

Свойство `size` определяет размер меню. Возможные значения: `'xs'`, `'s'`, `'m'`, `'l'`.

<ContextMenuExampleSize />

## Поведение

### Закрыть по клику за пределами

Свойство `onClickOutside` позволяет закрывать меню при клике вне его области.

<MdxTabs>

<ContextMenuExampleOutsideClick />

```tsx
const items = [
  { label: 'Пункт 1' },
  { label: 'Пункт 2' },
  { label: 'Пункт 3' },
];
const [isOpen, setIsOpen] = useState(false);
const ref = useRef(null);
return (
  <>
    <Button ref={ref} label="Открыть" onClick={() => setIsOpen(!isOpen)} />
    <ContextMenu
      isOpen={isOpen}
      items={items}
      anchorRef={ref}
      onClickOutside={() => setIsOpen(false)}
      direction="downStartLeft"
    />
  </>
);
```

</MdxTabs>

### Мобильный вид

Свойство `isMobile` включает мобильный вид для устройств с маленьким экраном.

<MdxTabs>

<ContextMenuExampleMobile />

```tsx
const [isOpen, setIsOpen] = useFlag();
const buttonRef = useRef(null);
return;
<>
  <Button ref={buttonRef} label="Открыть" onClick={setIsOpen.toggle} />
  <ContextMenu
    isOpen={isOpen}
    items={exampleItems}
    groups={groups}
    anchorRef={buttonRef}
    onClickOutside={setIsOpen.off}
    direction="upStartLeft"
    isMobile
  />
</>;
```

</MdxTabs>

## Пример использования

<MdxTabs>

<ContextMenuExampleDefault />

```tsx
const groups = [
  { label: 'Первая группа', id: 1 },
  { label: 'Вторая группа', id: 2 },
];
const exampleItems = [
  {
    label: 'Скрепка',
    leftIcon: IconAttach,
    status: 'success',
    groupId: 1,
    subMenu: [
      { label: 'Пункт - 1', status: 'success' },
      {
        label: 'Пункт - 2',
        status: 'success',
        subMenu: [
          {
            label: 'Пункт - 3',
            leftIcon: IconSun,
            subMenu: [{ label: 'Пункт - 5' }, { label: 'Пункт - 6' }],
          },
          {
            label: 'Пункт - 4',
            leftIcon: IconSun,
            subMenu: [{ label: 'Пункт - 7' }, { label: 'Пункт - 8' }],
          },
          { label: 'Пункт - 9', leftIcon: IconSun },
        ],
      },
    ],
  },
  { label: 'Глаз', leftIcon: IconEye, groupId: 1 },
  {
    label: 'Две галочки',
    groupId: 2,
    leftIcon: IconAllDone,
    rightSide: '!',
    status: 'alert',
  },
  {
    label: 'Чемодан',
    groupId: 2,
    leftIcon: IconBag,
    rightSide: '!',
    status: 'alert',
  },
  {
    label: 'Солнце',
    groupId: 2,
    leftIcon: IconSun,
    status: 'alert',
    rightSide: '!',
    disabled: true,
  },
];
const [isOpen, setIsOpen] = useState(false);
const ref = useRef(null);
return (
  <>
    <Button ref={ref} label="Открыть" onClick={() => setIsOpen(!isOpen)} />
    <ContextMenu
      isOpen={isOpen}
      items={exampleItems}
      groups={groups}
      anchorRef={ref}
      onClickOutside={() => setIsOpen(false)}
      direction="downStartLeft"
    />
  </>
);
```

</MdxTabs>
