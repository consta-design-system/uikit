import { Preview } from '@storybook/addon-docs/dist/blocks';

# Таблица

Таблица — компонент для отображения данных, с возможностями сортировки и фильтрации контента.

## Список свойств

```ts
type Column = {
  title: React.ReactNode;
  accessor: string;
  align?: 'left';
  center;
  right;
  withoutPadding?: boolean;
  width?: number;
  sortable?: boolean;
  sortByField?: string;
  sortFn?: (a: FieldValue, b: FieldValue) => number;
  renderCell?: (row: Row) => React.ReactNode;
};

type Row = {
  [key: string]: FieldValue;
  id: string;
};

type Filter = {
  id: string;
  name: string;
  field: string;
  filterer: (value: FieldValue) => boolean;
};
```

| Свойство              | Тип или варианты значения                                             | По умолчанию   | Описание                                           |
| --------------------- | --------------------------------------------------------------------- | -------------- | -------------------------------------------------- |
| columns               | `Column[]`                                                            | -              | Колонки таблицы                                    |
| rows                  | `Row[]`                                                               | -              | Строки таблицы                                     |
| filters?              | `Filter[]`                                                            | -              | Список фильтров                                    |
| size?                 | `'s', 'm', 'l'`                                                       | 'l'            | Размер таблицы                                     |
| stickyHeader?         | `boolean`                                                             | false          | Зафиксированный заголовок                          |
| stickyColumns?        | `number`                                                              | 0              | Количество зафиксированных колонок                 |
| isResizable?          | `boolean`                                                             | false          | Возможность изменения размера колонок              |
| activeRow?            | `{ id?: string; onChange: (id?: string) => void; }`                   | -              | Активная строка                                    |
| verticalAlign?        | `'center', 'top', 'bottom'`                                           | `'top'`        | Вертикальное выравнивание                          |
| isZebraStriped?       | `boolean`                                                             | false          | Окрашивание строк зеброй                           |
| borderBetweenRows?    | `boolean`                                                             | false          | Отображение границ между строками                  |
| borderBetweenColumns? | `boolean`                                                             | false          | Отображение границ между колонками                 |
| emptyRowsPlaceholder? | `React.ReactNode`                                                     | -              | Заглушка, отображается, когда в таблице нет данных |
| className?            | `string`                                                              | -              | Дополнительный класс                               |
| lazyLoad?             | `{ maxVisibleRows?: number; scrollableEl?: HTMLDivElement / Window; }`| `210, tableRef`| Строки для отображения + элемент с onScroll listener|

## Пример использования

### Обычная таблица

```ts
import React from 'react';
import { Table } from '@consta/uikit/Table';

const columns = [
  {
    title: '№',
    accessor: 'id',
    align: 'center',
    width: 100,
    sortable: true,
  },
  {
    title: 'Имя',
    accessor: 'name',
    sortable: true,
  },
];

const rows = [
  {
    id: '1',
    name: 'Антон',
  },
  {
    id: '2',
    name: 'Василий',
  },
];

const App = () => {
  return <Table columns={columns} rows={rows} />;
};
```

### Рендер ячеек  

```ts
import React from 'react';
import { Table } from '@consta/uikit/Table';

const columns = [
  {
    title: '№',
    accessor: 'id',
  },
  {
    title: 'Имя',
    accessor: 'name',
    renderCell: (row) => <h1>{row.name}</h1>
  },
];

const rows = [
  {
    id: '1',
    name: 'Антон',
  },
  {
    id: '2',
    name: 'Василий',
  },
];

const App = () => {
  return <Table columns={columns} rows={rows} />;
};
```

### Со своим текстом, если нет данных

```ts
import React from 'react';
import { Table } from '@consta/uikit/Table';
import { Text } from '@consta/uikit/Text';

const columns = [
  {
    title: '№',
    accessor: 'id',
    align: 'center',
    width: 100,
    sortable: true,
  },
  {
    title: 'Имя',
    accessor: 'name',
    sortable: true,
  },
];

const rows = [];

const App = () => {
  return <Table columns={columns} rows={rows} emptyRowsPlaceholder={<Text>Пусто</Text>} />;
};
```

### Таблица для большого количества строк

По умолчанию scrollableEl - сама таблица. Для корректной работы не забыть указать её высоту, чтобы scroll listener отрабатывал правильно.

```ts
import React from 'react';
import { Table } from '@consta/uikit/Table';

const columns = [ ... ];
const rows = [ ... ];

const App = () => {
  return <Table columns={columns} rows={rows} lazyLoad={{ maxVisibleRows: 300, scrollableEl: window }}/>;
};
```

### Таблица с окном множественной сортировки

#### SmartSorting

```ts
const orders = ['asc', 'desc'] as const;
type Order = typeof orders[number];

type Option = {
  optionLabel: string;
  optionValue: string;
};

type OrderOption = {
  orderLabel: string;
  orderValue: Order;
};

type OrderedOption = Option & OrderOption;

const orderParametersDefault: Array<OrderOption> = [
  { orderLabel: 'По возрастанию', orderValue: 'asc' },
  { orderLabel: 'По убыванию', orderValue: 'desc' },
];
```

| Свойство              | Тип или варианты значения           | По умолчанию            | Описание                                           |
| --------------------- | ------------------------------------| ----------------------- | -------------------------------------------------- |
| isOpen                | `boolean`                           | -                       | Флаг открытого окна                                |
| options               | `Option[]`                          | -                       | Список сортируемых полей                           |
| value                 | `OrderedOption[]`                   | -                       | Список уже отсортированных полей                   |
| onChange              | `(o: Array<OrderedOption>) => void` | -                       | Изменение сортировки в окне                        |
| onClose               | `() => void`                        | -                       | Закрытие окна                                      |
| title?                | `string`                            | 'Умная сортировка'      | Заголовок окна сортировки                          |
| sortLabel?            | `string`                            | 'Сортировать по'        | Заголовок полей для сортировки                     |
| sortParametersLabel?  | `string`                            | 'Порядок'               | Заголовок параметра сортировки                     |
| orderParameters?      | `OrderOption[]`                     | `orderParametersDefault`| Список параметров сортировки                       |
| className?            | `string`                            | -                       | Дополнительный класс                               |

#### Пример использования

```ts
import React from 'react';
import { Table } from '@consta/uikit/Table';
import { OrderedOption, smartSort, SmartSorting } from '@consta/uikit/SmartSorting';

const [isSmartSortingWindowOpen, setIsSmartSortingWindowOpen] = React.useState(false);
const [orderedOptions, setOrderedOptions] = React.useState<Array<OrderedOption>>([]);

const options = tableData.columns.map((column) => ({
  optionLabel: column.title as string,
  optionValue: column.accessor as string,
}));

const sorters = orderedOptions.map((option) =>
  option.orderValue === 'asc' ? option.optionValue : `-${option.optionValue}`,
);

const columns = orderedOptions.length > 0 ? tableData.columns.map((column) => ({
  ...column,
  sortable: false,
})) : tableData.columns;

const rows = [...tableData.rows].sort(smartSorter(sorters));

const App = () => (
  <div className={cnTableStories({ flexColumn: true })}>
    <Button
      size="m"
      view="ghost"
      label="Умная сортировка"
      width="default"
      iconLeft={orderedOptions.length ? IconCheck : undefined}
      className={cnTableStories('ButtonSorting', { withBadge: orderedOptions.length > 0 })}
      onClick={() => setIsSmartSortingWindowOpen(true)}
    />
    {orderedOptions.length > 0 && (
      <Badge size="s" label={`${orderedOptions.length}`} status="system" form="round" />
    )}
    <SmartSorting
      isOpen={isSmartSortingWindowOpen}
      options={options}
      value={orderedOptions}
      onChange={setOrderedOptions}
      onClose={() => setIsSmartSortingWindowOpen(false)}
      className={cnTableStories('MySmartSortingWindow')}
    />
    <Table rows={rows} columns={columns} />
  </div>
);
```
