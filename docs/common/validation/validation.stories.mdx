import { Meta } from '@storybook/addon-docs/blocks';
import { ValidationPictures } from './components/ValidationPictures/ValidationPictures';

<Meta
  title="Документация|Правила и справочники/Валидация форм"
  id="common-validation"
  parameters={{ order: 305 }}
/>

# Валидация форм

Валидация — это проверка значений, указанных пользователем, и отображение найденных ошибок.

- [Принципы](#принципы)
- [Когда проводится валидация](#когда-срабатывает-валидация)
  - [На лету](#валидация-«на-лету»)
  - [При потере фокуса](#валидация-по-потере-фокуса)
  - [При отправке](#валидация-при-отправке-формы)
- [Сообщения об ошибках](#сообщения-об-ошибках)
  - [Тултип](#тултип)
  - [Подсказка](#подсказка)
  - [В чём ошибка](#в-чём-ошибка)
- [Валидация зависимых полей](#валидация-зависимых-полей)

## Принципы

Задача — сделать так, чтобы пользователь не совершил ошибку и валидация
не понадобилась.

### Ограничьте выбор заведомо неверных значений

Блокируйте их или не показывайте.

### Ограничьте ввод неподходящих символов

Если в поле нужно вводить только цифры, и это очевидно пользователю,
запретите вводить в это поле буквы. Тогда пользователь не сможет сделать ошибку.

Используйте маски в полях, если у значений известен формат. Например, для телефонных номеров.

### Добавьте подсказки, которые помогу заполнить форму без ошибок

Можно добавить плейсхолдеры в полях ввода или подсказки под полями.

В сложных интерфейсах, которыми часто пользуются, хорошо использовать скрытые подсказки:
добавить рядом с полем иконку или изображение и показывать подсказку по наведению на него.
Тогда человеку, который уже освоил интерфейс, подсказки не будут мешать, а новичок всегда сможет прочитать, что происходит.

## Когда срабатывает валидация

Валидация может срабатывать в разные моменты. Прямо в процессе заполнения формы — «[на лету](#валидация-на-лету)»,
[при потере фокуса](#валидация-при-потере-фокуса)
и [при отправке формы](#валидация-при-отправке-формы).

### Валидация «на лету»

Это самый быстрый способ сообщить об ошибке. Как только пользователь вводит в поле что-то не то,
мы тут же подсказываем, что нужно исправить.

Этот вариант подходит только в тех случаях, когда ошибку можно найти сразу. Например, если пользователь
перепутал раскладку (кириллица вместо латиницы) или печатает буквы там, где нужны только цифры (ИНН, КПП и др.). Такие ошибки легко предупредить, если ограничить ввод неподходящих символов.

### Валидация по потере фокуса

Пользователь заполняет поле и переходит к следующему.
В этот момент поле уходит из фокуса, и, если оно заполнено, срабатывает валидация.

Если в поле ошибка, поле выделяется — подсвечивается цветом, зарезервированным для ошибок.
Фокус в это поле автоматически не возвращается.

<ValidationPictures name="loose-focus-1" />

Текст ошибки появляется в тултипе по наведению на поле или когда поле оказывается в фокусе.

<ValidationPictures name="loose-focus-2" />

Поле с ошибкой нужно продолжать подсвечивать, если оно оказалось в фокусе,
его значение не исправляли, а затем опять ушло из фокуса.

Подсветку нужно убрать, как только пользователь начал исправлять ошибку в поле.

### Валидация при отправке формы

Используйте этот вариант, когда нельзя проверить поля при потере фокуса.
Например, для проверки заполнения обязательных полей.

Проверка происходит после того, как пользователь нажал кнопку отправки данных:
все поля с ошибками на форме подсвечиваются, страница прокручивается
к первому полю с ошибкой, фокус перемещается в это поле, курсор встаёт
в конец строки, рядом с полем появляется сообщение об ошибке.

## Сообщения об ошибках

Если в поле ошибка, его нужно подсветить: выделить цветом или как-то ещё,
чтобы пользователь явно видел, что нужно исправить. Иногда этого достаточно,
но обычно нужно рассказать об ошибке в явном виде — в [тултипе](#тултип)
или [подсказке](#подсказка) рядом с полем.

### Тултип

Тултип с сообщением об ошибке появляется в двух случаях:

- при наведении на поле с ошибкой,
- когда поле с ошибкой оказывается в фокусе.

Тултип исчезает, когда:

- курсор вышел из области поля с ошибкой,
- поле с ошибкой потеряло фокус.

Тултип можно показывать сверху или справа от контрола с ошибкой — 
так, чтобы он не перекрывал полезную информацию.

<ValidationPictures name="tooltip-1" />

### Подсказка

Подсказка с сообщением об ошибке появляется сразу, как только произошла валидация
и поле с ошибкой подсветилось.

Текст ошибки можно вывести справа от поля, если на форме есть место, а само сообщение короткое.
Так форму не придется раздвигать, чтобы показать ошибку.

<ValidationPictures name="help-1" />

Если справа от поля нет места для текста, выводите сообщение под полем.
Лучше делать это как можно реже: новая строка раздвигает форму в высоту,
это может смутить или запутать пользователя.

<ValidationPictures name="help-2" />

### В чём ошибка

Обязательно в явном виде скажите пользователю, в чём ошибка:

- в формате данных, которые он вводит в поле (не добавил @ в адрес электронной почты),
- или в самих данных (ввел пароль или логин, которых не существует).

Как не надо:

- **Неверный телефон** — непонятно, где ошибка: такого номера нет в вашем сервисе или слишком мало знаков, или плюс в начале нужен.

Как правильно:

- **Напишите телефон в формате +7 000 000 00 00** — сразу понятно, что ошибка в формате, а ещё есть подсказка, как должно быть. Можно сравнить и быстро найти ошибку.
- **Такого номера нет в списке. Проверьте, пожалуйста** — тут с форматом всё ок, человек просто перепутал номер.

Как не надо:

- **Логин не подходит** — непонятно, ошибка в формате или что-то не так с самим логином.

Как правильно:

- **Этот логин уже занят** или **Пользователя с таким логином нет** — с форматом всё в порядке, нужно искать другой логин.
- **В логине должно быть 20 цифр, три буквы и хотя бы одно тире** - а тут нужно разбираться с форматом.

### Валидация зависимых полей

Зависимые поля — это поля, значения которых зависят друг от друга. Проверять их тоже нужно вместе.

Подсветка зависимых полей пропадает, как только пользователь начал исправлять
значение в одном из этих полей.

Если пользователь что-то вводит в поле и мы понимаем, что значение не совпадает с форматом,
нужно сразу подсвечивать и подсказывать, что где-то ошибка.

Пример формы из пяти полей:

<ValidationPictures name="flow-1" />

Пользователь пропустил поле **Название организации**.

Заполнил поля **Имя** и **Фамилия**.

В поле **Электронная почта** указал адрес в неправильном формате.

Перешёл в поле **Телефон**, указал номер в неправильном формате, но
из поля пока не вышел.

Вот что он видит:

<ValidationPictures name="flow-2" />

Пользователь навёл курсор на поле с почтой. Появился тултип с сообщением об ошибке. Но данные
пока не исправлены.

Вот что он видит:

<ValidationPictures name="flow-3" />

Пользователь нажал **Отправить**.

Фокус перешёл в поле **Организация**, так как оно обязательное. Рядом с полем появился тултип
с сообщением об ошибке.

Другие поля с ошибками продолжают подсвечиваться.

<ValidationPictures name="flow-4" />

Пользователь начинает вводить текст в поле **Организация**.

Подсветка, которая показывает, что в поле ошибка, пропадает. Тултип с подсказкой остаётся.

<ValidationPictures name="flow-5" />

Пользователь заполнил поле **Организация**.

Фокус переведён на следующее неверно заполненное поле.

<ValidationPictures name="flow-6" />

Пользователь исправил поле **Электронная почта** (тултип с сообщением об ошибке исчез).

Перешёл к следующему.

<ValidationPictures name="flow-7" />

После того, как все поля заполнены в правильном формате, пользователь нажимает **Отправить**, и форма отправляется.
